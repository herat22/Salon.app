<!DOCTYPE html>
<html lang="fa" dir="rtl" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Royal Salon AF | Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø¬Ø§Ù…Ø¹ Ø¢Ø±Ø§ÛŒØ´Ú¯Ø§Ù‡ (Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†)</title>
    <meta name="description" content="Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¢Ø±Ø§ÛŒØ´Ú¯Ø§Ù‡ Ø¨Ø§ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯Ù‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†">
    
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js">
</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
 <style>
    /* ========================================= 
       1. CSS VARIABLES (THE ROYAL THEME - FROM INDEX9)
       ========================================= */
    :root {
        /* --- Main Luxury Palette (Burgundy & Gold) --- */
        --gold-primary: #D4AF37;
        --gold-light: #FEDC56;
        --gold-dark: #AA8C2C;
        --gold-gradient: linear-gradient(135deg, #BF953F, #FCF6BA, #B38728, #FBF5B7, #AA771C);
        
        --burgundy-deep: #2D0008;
        --burgundy-main: #4A0410;
        --burgundy-light: #680818;
        --burgundy-glass: rgba(74, 4, 16, 0.85);
        
        /* --- Backgrounds --- */
        --bg-body: #1a0003;
        --bg-card: rgba(40, 0, 8, 0.7);
        --bg-input: rgba(0, 0, 0, 0.4);
        --bg-sidebar: rgba(45, 0, 8, 0.95);
        
        /* --- Text Colors --- */
        --text-main: #FFFFFF;
        --text-muted: #D4AF37; /* Gold as muted text for luxury feel */
        --text-gold: #F4E298;
        --text-dim: rgba(255, 255, 255, 0.6);
        
        /* --- Borders & Effects --- */
        --border-gold: 1px solid rgba(212, 175, 55, 0.4);
        --border-glow: 0 0 10px rgba(212, 175, 55, 0.3);
        
        --shadow-luxury: 0 8px 32px 0 rgba(0, 0, 0, 0.6);
        --glass-blur: blur(12px);
        
        --radius-sm: 8px;
        --radius-md: 16px;
        --radius-lg: 24px;
        
        /* --- Status Colors --- */
        --success: #00C853;
        --danger: #FF1744;
        --warning: #FFAB00;
        --info: #00B0FF;

        /* --- Animations --- */
        --anim-fast: 0.2s ease;
        --anim-med: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        --anim-slow: 0.6s cubic-bezier(0.4, 0, 0.2, 1);
@keyframes spin { 100% { transform: rotate(360deg); } }
    }

    /* =========================================
       2. LIGHT THEME OVERRIDES (Soft & Clean)
       ========================================= */
    [data-theme="light"] {
        /* Backgrounds */
        --bg-body: #F3F4F6;
        --bg-card: #FFFFFF;
        --bg-input: #F9FAFB;
        --bg-sidebar: #FFFFFF;
        
        /* Text */
        --text-main: #1F2937;
        --text-muted: #6B7280;
        --text-gold: #B45309;
        --text-dim: #9CA3AF;
        
        /* Gold Accents (Darker for light bg) */
        --gold-primary: #D97706;
        --gold-light: #F59E0B;
        --gold-dark: #B45309;
        --gold-gradient: linear-gradient(135deg, #F59E0B, #D97706);
        
        /* Burgundy Accents */
        --burgundy-deep: #FFFFFF; /* Inverted for text readability on buttons */
        --burgundy-main: #FFFFFF;
        
        /* Borders & Effects */
        --border-gold: 1px solid #E5E7EB;
        --shadow-luxury: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --glass-blur: none;
    }
/* =========================================
       3. GLOBAL RESET & TYPOGRAPHY
       ========================================= */
    * {
        margin: 0; 
        padding: 0; 
        box-sizing: border-box;
        font-family: 'Vazirmatn', sans-serif;
        -webkit-tap-highlight-color: transparent;
    }

    /* Custom Scrollbar */
    * {
        scrollbar-width: thin;
        scrollbar-color: var(--gold-dark) var(--bg-body);
    }
    *::-webkit-scrollbar {
        width: 6px;
        height: 6px;
    }
    *::-webkit-scrollbar-track {
        background: var(--bg-body);
    }
    *::-webkit-scrollbar-thumb {
        background: var(--gold-dark);
        border-radius: 10px;
    }
    *::-webkit-scrollbar-thumb:hover {
        background: var(--gold-primary);
    }

    /* Body Structure */
    body {
        background-color: var(--bg-body);
        /* Luxurious Pattern for Dark Mode */
        background-image: radial-gradient(circle at 10% 20%, rgba(212, 175, 55, 0.05) 0%, transparent 20%);
        color: var(--text-main);
        height: 100vh; 
        overflow: hidden; 
        display: flex; 
        font-size: 14px;
        line-height: 1.6;
        transition: background-color 0.3s, color 0.3s;
    }

    [data-theme="light"] body {
        background-image: none;
    }

    /* Selection Highlighting */
    ::selection {
        background: var(--gold-primary);
        color: var(--burgundy-deep);
    }

    /* =========================================
       4. UTILITY CLASSES (GLASS & CARDS)
       ========================================= */
    .glass-panel, .card, .stat-card, .sidebar, .top-header {
        background: var(--bg-card);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border: var(--border-gold);
        box-shadow: var(--shadow-luxury);
        transition: all var(--anim-med);
    }

    .card {
        border-radius: var(--radius-md); 
        padding: 25px; 
        margin-bottom: 25px; 
        position: relative;
        overflow: hidden;
    }

    /* Golden top border accent for cards */
    .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: var(--gold-gradient);
        opacity: 0.7;
    }

    /* =========================================
       5. BUTTONS (ROYAL STYLE)
       ========================================= */
    .btn {
        padding: 10px 24px;
        border-radius: var(--radius-sm);
        border: none;
        font-size: 14px;
        font-weight: 700;
        cursor: pointer;
        transition: all var(--anim-fast);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        text-decoration: none;
        outline: none;
    }

    /* Primary Gold Button */
    .gold-btn, .btn-primary {
        background: var(--gold-gradient);
        color: var(--burgundy-deep);
        box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
    }
    
    [data-theme="light"] .gold-btn, 
    [data-theme="light"] .btn-primary {
        color: #fff; /* White text on gold button in light mode */
    }

    .gold-btn:hover, .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(212, 175, 55, 0.5);
    }

    .gold-btn:active, .btn-primary:active {
        transform: translateY(0);
    }

    /* Icon Buttons (Square/Circle) */
    .icon-btn {
        width: 40px; 
        height: 40px; 
        border-radius: 12px;
        border: 1px solid var(--gold-dark); 
        background: rgba(0,0,0,0.3);
        color: var(--gold-light); 
        display: flex; 
        align-items: center; 
        justify-content: center;
        cursor: pointer; 
        transition: 0.3s; 
        font-size: 18px;
    }
    
    [data-theme="light"] .icon-btn {
        background: #fff;
        border-color: #E5E7EB;
        color: var(--text-muted);
    }

    .icon-btn:hover {
        background: var(--gold-primary); 
        color: var(--burgundy-deep);
        border-color: var(--gold-primary);
    }
    #loginPage {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        background-color: #2D0008; /* Ù‡Ù…Ø§Ù† Ø±Ù†Ú¯ Ø²Ø±Ø´Ú©ÛŒ Ø§ØµÙ„ÛŒ */

        /* Ù‡Ù…Ø§Ù† Ù¾ØªØ±Ù† Ø·Ù„Ø§ÛŒÛŒ Ø§ØµÙ„ÛŒ */
        background-image: 
            repeating-linear-gradient(45deg, transparent 0, transparent 60px, rgba(212, 175, 55, 0.2) 60px, rgba(212, 175, 55, 0.2) 61px),
            repeating-linear-gradient(-45deg, transparent 0, transparent 60px, rgba(212, 175, 55, 0.2) 60px, rgba(212, 175, 55, 0.2) 61px),
            radial-gradient(circle at center, transparent 20%, #000000 100%);
    }

    #loginPage::before {
        content: '';
        position: absolute;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(212, 175, 55, 0.05) 1px, transparent 1px);
        background-size: 50px 50px;
        opacity: 0.5;
        animation: rotateBackground 200s linear infinite;
        pointer-events: none;
    }

    @keyframes rotateBackground {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

  .login-card {
    position: relative;
    width: 90%;
    /* ØªØºÛŒÛŒØ± Ø§Ø² 700 Ø¨Ù‡ 420 Ø¨Ø±Ø§ÛŒ ØªÙ…Ø±Ú©Ø² Ùˆ Ø²ÛŒØ¨Ø§ÛŒÛŒ Ø¨ÛŒØ´ØªØ± */
    max-width: 420px; 
    
    background: rgba(45, 0, 8, 0.75); /* Ú©Ù…ÛŒ Ø´ÙØ§Ùâ€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù‡ Ø´Ø¯Ù† Ù¾ØªØ±Ù† Ø²ÛŒØ±ÛŒÙ† */
    backdrop-filter: blur(25px);      /* Ø¨Ù„ÙˆØ± Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§ÛŒ Ø­Ø³ Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ */
    -webkit-backdrop-filter: blur(25px);
    
    border: 1px solid rgba(212, 175, 55, 0.5); /* Ø­Ø§Ø´ÛŒÙ‡ Ø¸Ø±ÛŒÙâ€ŒØªØ± */
    border-radius: 24px;
    padding: 40px 30px;
    
    /* Ø³Ø§ÛŒÙ‡ Ø¹Ù…ÛŒÙ‚â€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ø¬Ø¯Ø§ Ø´Ø¯Ù† Ø§Ø² Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ */
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8), 
                inset 0 0 0 1px rgba(255, 255, 255, 0.1); 
    
    text-align: center;
    overflow: hidden;
    animation: fadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
    z-index: 10;
}

    .login-card::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(212, 175, 55, 0.1), transparent);
        transform: rotate(45deg);
        animation: shimmer 6s infinite linear;
        pointer-events: none;
    }

    @keyframes shimmer {
        0% { transform: translateX(-100%) rotate(45deg); }
        100% { transform: translateX(100%) rotate(45deg); }
    }

    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .brand-logo {
        width: 100px;
        height: 100px;
        margin: 0 auto 20px;
        background: var(--gold-gradient);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        color: #2D0008;
        box-shadow: 0 0 25px var(--gold-dark);
        border: 3px solid #fff;
        position: relative;
        z-index: 2;
    }

    .login-title {
        font-size: 28px;
        font-weight: 900;
        margin-bottom: 5px;
        background: var(--gold-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .login-subtitle {
        font-size: 13px;
        color: var(--text-gold);
        margin-bottom: 30px;
        opacity: 0.8;
    }

    .login-input-group {
    position: relative;
    margin-bottom: 25px; /* ÙØ§ØµÙ„Ù‡ Ø¨ÛŒØ´ØªØ± Ø¨ÛŒÙ† ÙÛŒÙ„Ø¯Ù‡Ø§ */
    width: 100%;         /* Ø¹Ø±Ø¶ Ú©Ø§Ù…Ù„ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ú©Ø§Ø±Øª Ø¬Ø¯ÛŒØ¯ */
    margin-left: 0;
    margin-right: 0;
}

.login-input {
    width: 100%;
    padding: 16px 50px 16px 20px; /* ÙØ¶Ø§ÛŒ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø¢ÛŒÚ©ÙˆÙ† */
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(212, 175, 55, 0.3);
    border-radius: 12px; /* Ú¯Ø±Ø¯ÛŒ Ú©Ù…ØªØ± Ø¨Ø±Ø§ÛŒ Ø­Ø³ Ù…Ø¯Ø±Ù†â€ŒØªØ± (Ø¨Ù‡ Ø¬Ø§ÛŒ 50px) */
    color: var(--gold-light);
    font-size: 15px;
    transition: all 0.3s ease;
    outline: none;
    text-align: right; /* Ø±Ø§Ø³Øªâ€ŒÚ†ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø§ÛŒÛŒ Ø¨Ù‡ØªØ± Ø¯Ø± ÙØ§Ø±Ø³ÛŒ */
    direction: rtl;
}

.login-input:focus {
    border-color: var(--gold-primary);
    background: rgba(0, 0, 0, 0.6);
    box-shadow: 0 0 20px rgba(212, 175, 55, 0.15);
    transform: translateY(-2px);
}
    .login-input-icon {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gold-primary);
        font-size: 18px;
    }

    .btn-login {
    width: 100%; /* ØªÙ…Ø§Ù… Ø¹Ø±Ø¶ */
    padding: 16px;
    border-radius: 12px; /* Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ø¨Ø§ Ø§ÛŒÙ†Ù¾ÙˆØªâ€ŒÙ‡Ø§ */
    /* Ø¨Ù‚ÛŒÙ‡ Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¹Ø§Ù„ÛŒ Ù‡Ø³ØªÙ†Ø¯ */
    background: var(--gold-gradient);
    color: #2D0008;
    font-weight: 800;
    font-size: 16px;
    cursor: pointer;
    box-shadow: 0 10px 30px rgba(212, 175, 55, 0.2);
    transition: transform 0.2s, box-shadow 0.2s;
}
    .btn-login:hover {
        transform: scale(1.02);
        box-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
    }

    .forgot-pass {
        display: block;
        margin-top: 20px;
        color: var(--text-muted);
        font-size: 12px;
        text-decoration: none;
        transition: 0.3s;
    }
    
    #loginError {
        color: var(--danger);
        margin-top: 15px;
        font-size: 13px;
        display: none;
        animation: shake 0.3s;
    }
    /* =========================================
       7. FORMS & INPUTS (LUXURY STYLE)
       ========================================= */
    .form-group {
        margin-bottom: 20px;
        position: relative;
    }

    .form-label {
        display: block;
        margin-bottom: 8px;
        color: var(--gold-light);
        font-size: 13px;
        font-weight: 600;
        letter-spacing: 0.5px;
    }
    
    .form-label.required::after {
        content: ' *';
        color: var(--danger);
    }

    /* Standard Luxury Input */
    .form-control, .lux-input, .lux-select, .lux-textarea {
        width: 100%;
        padding: 12px 16px;
        background: var(--bg-input);
        border: 1px solid rgba(212, 175, 55, 0.3);
        border-radius: 12px;
        color: var(--text-main);
        font-size: 14px;
        transition: 0.3s;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        outline: none;
    }

    /* Input Focus State */
    .form-control:focus, .lux-input:focus, .lux-select:focus, .lux-textarea:focus {
        border-color: var(--gold-primary);
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.15);
        background: rgba(0, 0, 0, 0.6);
        transform: scale(1.01);
    }

    .form-control::placeholder {
        color: rgba(255, 255, 255, 0.3);
    }
    
    [data-theme="light"] .form-control::placeholder {
        color: rgba(0, 0, 0, 0.4);
    }

    /* Custom Select Arrow */
    select.form-control, select.lux-select {
        appearance: none;
        -webkit-appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23D4AF37' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: left 15px center; /* RTL friendly */
    }

    /* Checkbox & Radio */
    .form-check {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
        cursor: pointer;
    }

    .form-check input[type="checkbox"],
    .form-check input[type="radio"] {
        width: 18px;
        height: 18px;
        accent-color: var(--gold-primary);
        cursor: pointer;
        filter: hue-rotate(45deg); /* Slight gold tint adjust */
    }

    /* =========================================
       8. TABLES (ROYAL DATA GRID)
       ========================================= */
    .table-container {
        width: 100%;
        overflow-x: auto;
        border-radius: 16px;
        border: 1px solid rgba(212, 175, 55, 0.2);
        background: rgba(0, 0, 0, 0.2);
        margin-top: 15px;
    }
    
    [data-theme="light"] .table-container {
        background: #fff;
    }

    .lux-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 700px;
    }

    .lux-table thead th {
        background: linear-gradient(90deg, rgba(45,0,8,0.9), rgba(60,0,10,0.9));
        color: var(--gold-primary);
        padding: 18px 20px;
        text-align: right;
        font-weight: 800;
        font-size: 13px;
        border-bottom: 2px solid var(--gold-dark);
        white-space: nowrap;
    }
    
    [data-theme="light"] .lux-table thead th {
        background: #F3F4F6;
        color: var(--gold-dark);
        border-bottom: 2px solid #D1D5DB;
    }

    .lux-table tbody td {
        padding: 16px 20px;
        border-bottom: 1px solid rgba(212, 175, 55, 0.1);
        color: var(--text-main);
        font-size: 14px;
        vertical-align: middle;
    }

    .lux-table tbody tr {
        transition: 0.2s;
    }

    .lux-table tbody tr:hover {
        background: rgba(212, 175, 55, 0.08);
    }

    .lux-table tbody tr:last-child td {
        border-bottom: none;
    }

    /* =========================================
       9. BADGES & STATUS INDICATORS
       ========================================= */
    .status-badge, .badge {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 5px 12px;
        border-radius: 30px;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        line-height: 1.2;
    }

    /* Status Colors */
    .status-success, .badge-success { 
        background: rgba(0, 200, 83, 0.15); 
        color: #00E676; 
        border: 1px solid rgba(0, 200, 83, 0.3); 
    }
    
    .status-warning, .badge-warning { 
        background: rgba(255, 171, 0, 0.15); 
        color: #FFD740; 
        border: 1px solid rgba(255, 171, 0, 0.3); 
    }
    
    .status-danger, .badge-danger { 
        background: rgba(255, 23, 68, 0.15); 
        color: #FF5252; 
        border: 1px solid rgba(255, 23, 68, 0.3); 
    }
    
    .status-info, .badge-info { 
        background: rgba(0, 176, 255, 0.15); 
        color: #40C4FF; 
        border: 1px solid rgba(0, 176, 255, 0.3); 
    }
    
    .status-neutral, .badge-neutral { 
        background: rgba(255, 255, 255, 0.1); 
        color: #ccc; 
        border: 1px solid rgba(255, 255, 255, 0.2); 
    }
    
    [data-theme="light"] .status-neutral {
        background: #EEE; color: #555; border: 1px solid #CCC;
    }
</style>
<style>
    /* =========================================
       10. MAIN LAYOUT STRUCTURE
       ========================================= */
    #mainApp {
        display: none; /* Hidden by default until login */
        width: 100%;
        height: 100%;
        flex-direction: row;
        overflow: hidden;
        position: relative;
        z-index: 1;
    }

    .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        height: 100%;
        overflow: hidden;
        position: relative;
    }

    .page-container {
        flex: 1;
        overflow-y: auto;
        padding: 30px;
        scroll-behavior: smooth;
    }

    /* Page Transitions */
    .page-section {
        display: none;
        animation: fadeInPage 0.4s ease-out;
    }
    
    .page-section.active {
        display: block;
    }

    @keyframes fadeInPage {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* =========================================
       11. SIDEBAR & NAVIGATION (ROYAL THEME)
       ========================================= */
    .sidebar {
        width: 280px;
        height: 100%;
        background: var(--bg-sidebar);
        backdrop-filter: blur(15px);
        border-left: 1px solid var(--gold-dark); /* RTL Border */
        display: flex;
        flex-direction: column;
        z-index: 100;
        transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 5px 0 25px rgba(0,0,0,0.5);
        flex-shrink: 0;
        overflow-y: auto;
    }

    .sidebar.collapsed {
        width: 80px;
    }

    .sidebar-header {
        text-align: center;
        padding: 25px 10px;
        border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        background: linear-gradient(180deg, rgba(45,0,8,0.8), transparent);
    }

    .sidebar-logo {
        font-size: 28px;
        color: var(--gold-primary);
        margin-bottom: 5px;
        text-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
    }

    .sidebar-title {
        font-size: 18px;
        font-weight: 900;
        background: var(--gold-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        letter-spacing: -0.5px;
        transition: opacity 0.3s;
    }

    .sidebar.collapsed .sidebar-title,
    .sidebar.collapsed .sidebar-subtitle {
        display: none;
    }

    /* Nav Items */
    .nav-menu {
        flex: 1;
        padding: 15px;
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .nav-item {
        position: relative;
    }

    .nav-link {
        display: flex;
        align-items: center;
        padding: 14px 15px;
        border-radius: 12px;
        color: var(--text-muted);
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        border: 1px solid transparent;
    }

    .nav-link:hover {
        background: rgba(212, 175, 55, 0.1);
        color: var(--gold-light);
        border-color: rgba(212, 175, 55, 0.2);
        transform: translateX(-5px); /* RTL move left */
    }

    .nav-link.active {
        background: var(--gold-gradient);
        color: #2D0008;
        font-weight: 800;
        box-shadow: 0 5px 15px rgba(212, 175, 55, 0.2);
    }

    .nav-link i {
        width: 25px;
        text-align: center;
        font-size: 18px;
        margin-left: 10px;
    }

    .nav-link .arrow {
        margin-right: auto; /* Push to left in RTL */
        font-size: 12px;
        transition: transform 0.3s;
    }
    
    .nav-link.active .arrow {
        transform: rotate(-90deg); /* RTL Rotate */
    }

    /* Submenu */
    .submenu {
        max-height: 0;
        overflow: hidden;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 8px;
        margin-top: 2px;
        transition: max-height 0.4s ease;
    }
    
    .submenu.open {
        max-height: 500px; /* Arbitrary large height */
    }

    .submenu-item {
        display: flex;
        align-items: center;
        padding: 10px 15px 10px 45px; /* Indent for RTL */
        color: var(--text-dim);
        font-size: 13px;
        cursor: pointer;
        transition: 0.2s;
        text-decoration: none;
    }

    .submenu-item:hover {
        color: var(--gold-light);
        background: rgba(255, 255, 255, 0.05);
    }
    
    .submenu-item i {
        font-size: 10px;
        margin-left: 10px;
        opacity: 0.7;
    }

    /* Sidebar Collapse Toggle */
    .sidebar-toggle {
        padding: 15px;
        text-align: center;
        cursor: pointer;
        color: var(--gold-dark);
        border-top: 1px solid rgba(212, 175, 55, 0.1);
    }
    
    .sidebar.collapsed .nav-link span,
    .sidebar.collapsed .nav-link .arrow,
    .sidebar.collapsed .submenu {
        display: none !important;
    }

    /* =========================================
       12. TOP HEADER
       ========================================= */
    .top-header {
        height: 70px;
        background: rgba(45, 0, 8, 0.9);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(212, 175, 55, 0.3);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 30px;
        z-index: 90;
    }

    .page-title {
        font-size: 22px;
        font-weight: 900;
        color: var(--gold-primary);
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .page-title::before {
        content: '';
        display: block;
        width: 4px;
        height: 24px;
        background: var(--gold-gradient);
        border-radius: 4px;
    }

    .header-actions {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    /* =========================================
       13. MODALS (POPUPS)
       ========================================= */
    .modal-overlay {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(10, 0, 2, 0.9);
        backdrop-filter: blur(8px);
        z-index: 2000;
        display: none;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .modal-overlay.active {
        display: flex;
        opacity: 1;
    }

    .lux-modal {
        background: linear-gradient(145deg, rgba(40, 0, 8, 0.95), #1a0003);
        border: 2px solid var(--gold-dark);
        border-radius: 20px;
        width: 95%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 0 60px rgba(0,0,0,0.8), 0 0 20px rgba(212, 175, 55, 0.15);
        transform: scale(0.9);
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        display: flex;
        flex-direction: column;
    }
    
    [data-theme="light"] .lux-modal {
        background: #FFF;
        border-color: #DDD;
        box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }

    .modal-overlay.active .lux-modal {
        transform: scale(1);
    }

    .modal-header {
        padding: 20px 25px;
        border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(212, 175, 55, 0.05);
    }

    .modal-title {
        font-size: 18px;
        color: var(--gold-primary);
        font-weight: 800;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .close-modal {
        background: none;
        border: none;
        color: var(--danger);
        font-size: 24px;
        cursor: pointer;
        transition: 0.3s;
        width: 30px; 
        height: 30px;
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
    }

    .close-modal:hover {
        background: rgba(255, 23, 68, 0.1);
        transform: rotate(90deg);
    }

    .modal-body {
        padding: 25px;
        flex: 1;
        overflow-y: auto;
    }

    .modal-footer {
        padding: 20px 25px;
        border-top: 1px solid rgba(212, 175, 55, 0.2);
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        background: rgba(0, 0, 0, 0.2);
    }
</style>
<style>
    /* =========================================
       14. GRID SYSTEM
       ========================================= */
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
    .grid-4 { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; }

    /* =========================================
       15. STAT CARDS (DASHBOARD)
       ========================================= */
    .stat-card {
        padding: 25px;
        display: flex;
        align-items: center;
        gap: 20px;
        position: relative;
        overflow: hidden;
    }
    
    .stat-card::after {
        content: '';
        position: absolute;
        right: -20px; top: -20px;
        width: 100px; height: 100px;
        background: var(--gold-primary);
        filter: blur(60px);
        opacity: 0.1;
        border-radius: 50%;
    }

    .stat-icon-box {
        width: 60px; height: 60px;
        border-radius: 16px;
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(0, 0, 0, 0.4));
        border: 1px solid var(--gold-dark);
        display: flex; align-items: center; justify-content: center;
        font-size: 24px;
        color: var(--gold-light);
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        z-index: 2;
    }
    
    [data-theme="light"] .stat-icon-box {
        background: #F3F4F6;
        border-color: #E5E7EB;
        color: var(--gold-dark);
    }

    .stat-info { flex: 1; z-index: 2; }

    .stat-label {
        font-size: 13px; color: var(--text-muted);
        margin-bottom: 5px; font-weight: 500;
    }

    .stat-value {
        font-size: 24px; font-weight: 900;
        color: var(--text-main);
        letter-spacing: 0.5px;
        font-family: 'Vazirmatn', sans-serif;
    }

    /* =========================================
       16. TABS (SETTINGS PAGE)
       ========================================= */
    .tabs {
        display: flex; gap: 10px;
        border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        margin-bottom: 25px;
        overflow-x: auto;
    }

    .tab-btn {
        padding: 10px 20px;
        background: transparent;
        border: none;
        color: var(--text-muted);
        font-size: 14px; font-weight: bold;
        cursor: pointer;
        position: relative;
        white-space: nowrap;
        transition: 0.3s;
    }

    .tab-btn:hover { color: var(--gold-light); }

    .tab-btn.active {
        color: var(--gold-primary);
    }
    
    .tab-btn.active::after {
        content: '';
        position: absolute; bottom: -1px; left: 0; width: 100%; height: 3px;
        background: var(--gold-gradient);
        border-radius: 3px 3px 0 0;
    }

    .tab-content { display: none; animation: fadeIn 0.3s; }
    .tab-content.active { display: block; }

    /* =========================================
       17. TOAST NOTIFICATIONS
       ========================================= */
    .toast-container {
        position: fixed; top: 20px; left: 20px; /* LTR Position for RTL Layout */
        z-index: 10000;
        display: flex; flex-direction: column; gap: 10px;
    }
    
    html[dir="rtl"] .toast-container { left: auto; right: 20px; }

    .lux-toast {
        min-width: 300px;
        background: rgba(45, 0, 8, 0.95);
        backdrop-filter: blur(10px);
        border-right: 4px solid var(--gold-primary);
        border-radius: 8px;
        padding: 15px 20px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        display: flex; align-items: center; gap: 15px;
        animation: slideInToast 0.4s ease forwards;
        color: #fff;
    }

    .lux-toast.success { border-color: var(--success); }
    .lux-toast.error { border-color: var(--danger); }
    
    @keyframes slideInToast {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    /* =========================================
       18. RESPONSIVE MEDIA QUERIES
       ========================================= */
    @media (max-width: 900px) {
        .sidebar { position: absolute; right: -280px; height: 100%; }
        .sidebar.open { right: 0; box-shadow: -10px 0 30px rgba(0,0,0,0.8); }
        .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
        .top-header { padding: 0 15px; }
        .lux-modal { width: 95%; max-height: 85vh; }
    }
</style>
</head>
<body>

<div id="loadingOverlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#1a0003; z-index:10000; display:flex; align-items:center; justify-content:center; transition:opacity 0.5s;">
    <div class="spinner-dual" style="width:50px; height:50px; border:3px solid var(--gold-dark); border-top-color:var(--gold-light); border-radius:50%; animation:spin 1s infinite linear;"></div>
</div>


<div id="loginPage">
    <div class="login-card">
        <div class="brand-logo">
            <i class="fa-solid fa-scissors"></i>
        </div>
        <h1 class="login-title" data-i18n="appTitle">Royal Salon AF</h1>
        <p class="login-subtitle" data-i18n="appSubtitle">Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø¢Ø±Ø§ÛŒØ´Ú¯Ø§Ù‡</p>
        
        <form onsubmit="event.preventDefault(); handleLogin();">
            <div class="login-input-group">
                <i class="fa-solid fa-user login-input-icon"></i>
               <input type="text" id="loginUser" class="login-input" data-i18n="username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ" autocomplete="off">
            </div>
            
            <div class="login-input-group">
                <i class="fa-solid fa-lock login-input-icon"></i>
               <input type="password" id="loginPass" class="login-input" data-i18n="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
            </div>
       <button type="submit" class="btn-login">
    <span data-i18n="loginBtn">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…</span> 
    <i class="fa-solid fa-arrow-left" style="margin-right:8px"></i>
</button>
        </form>
        <div style="margin-bottom: 20px; text-align: center;">
    <select onchange="handleLangChange(this)" class="lux-select" style="width: 100%; text-align: center; background: rgba(0,0,0,0.5);">
        <option value="fa,AF">ğŸ‡¦ğŸ‡« Ø§ÙØºØ§Ù†Ø³ØªØ§Ù† (ÙØ§Ø±Ø³ÛŒ - AFN)</option>
        <option value="fa,IR">ğŸ‡®ğŸ‡· Ø§ÛŒØ±Ø§Ù† (ÙØ§Ø±Ø³ÛŒ - Toman)</option>
        <option value="ar,UAE">ğŸ‡¦ğŸ‡ª Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© - AED)</option>
        <option value="tr,TR">ğŸ‡¹ğŸ‡· TÃ¼rkiye (TÃ¼rkÃ§e - TRY)</option>
        <option value="en,US">ğŸ‡ºğŸ‡¸ English (International - USD)</option>
    </select>
</div>

<script>
    function handleLangChange(select) {
        const [lang, country] = select.value.split(',');
        changeSystemConfig(lang, country);
    }
</script>
        <p id="loginError">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª</p>
        
        <div style="margin-top:20px; font-size:11px; color:rgba(255,255,255,0.3);">
            Ù†Ø³Ø®Ù‡ 2.0.1 | ÙˆØ§Ø­Ø¯ Ù¾ÙˆÙ„: Ø§ÙØºØ§Ù†ÛŒ (AFN)
        </div>
    </div>
</div>
<div id="mainApp">
    
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <i class="fa-solid fa-crown fa-spin-pulse" style="--fa-animation-duration: 3s;"></i>
            </div>
            <h2 class="sidebar-title">Royal Salon AF</h2>
            <div class="sidebar-subtitle" style="font-size: 11px; color: var(--gold-dark); margin-top: 5px; opacity:0.8;">
                Ù†Ø³Ø®Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†
            </div>
        </div>

        <nav class="nav-menu">
            <div class="nav-item">
                <div class="nav-link active" onclick="navigateTo('dashboard', this)">
                    <i class="fa-solid fa-chart-pie"></i>
                    <span data-i18n="navDashboard">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ</span>
                </div>
            </div>
            
            <div class="nav-item">
                <div class="nav-link" onclick="toggleSubmenu(this)">
                    <i class="fa-solid fa-cash-register"></i>
                    <span data-i18n="navPos">ØµÙ†Ø¯ÙˆÙ‚ Ùˆ ÙØ±ÙˆØ´</span>
                    <i class="fa-solid fa-chevron-left arrow"></i>
                </div>
                <div class="submenu">
                    <div class="submenu-item" onclick="navigateTo('pos', this)">
                        <i class="fa-solid fa-cart-shopping"></i> ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´ Ø¬Ø¯ÛŒØ¯
                    </div>
                    <div class="submenu-item" onclick="openModal('modalRegister')">
                        <i class="fa-solid fa-door-open"></i> Ø¨Ø§Ø²/Ø¨Ø³ØªÙ† ØµÙ†Ø¯ÙˆÙ‚
                    </div>
                    <div class="submenu-item" onclick="navigateTo('invoices', this)">
                        <i class="fa-solid fa-receipt"></i> ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§
                    </div>
                </div>
            </div>

            <div class="nav-item">
                <div class="nav-link" onclick="toggleSubmenu(this)">
                    <i class="fa-solid fa-calendar-check"></i>
                    <span data-i18n="navAppointments">Ù†ÙˆØ¨Øªâ€ŒØ¯Ù‡ÛŒ Ùˆ Ø±Ø²Ø±Ùˆ</span>
                    <i class="fa-solid fa-chevron-left arrow"></i>
                </div>
                <div class="submenu">
                    <div class="submenu-item" onclick="navigateTo('appointments', this)">
                        <i class="fa-solid fa-list-check"></i> Ù„ÛŒØ³Øª Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§
                    </div>
                    <div class="submenu-item" onclick="openModal('modalAppointment')">
                        <i class="fa-solid fa-plus"></i> Ø«Ø¨Øª Ù†ÙˆØ¨Øª Ø¬Ø¯ÛŒØ¯
                    </div>
                </div>
            </div>

            <div class="nav-item">
                <div class="nav-link" onclick="toggleSubmenu(this)">
                    <i class="fa-solid fa-wallet"></i>
                    <span data-i18n="navAccounting">Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ùˆ Ù…Ø§Ù„ÛŒ</span>
                    <i class="fa-solid fa-chevron-left arrow"></i>
                </div>
                <div class="submenu">
                    <div class="submenu-item" onclick="navigateTo('accounting', this)">
                        <i class="fa-solid fa-money-bill-transfer"></i> Ø¯Ø±Ø¢Ù…Ø¯ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡
                    </div>
                    <div class="submenu-item" onclick="navigateTo('debts', this)">
                        <i class="fa-solid fa-hand-holding-dollar"></i> Ø¯ÙØªØ± Ø¨Ø¯Ù‡Ú©Ø§Ø±Ø§Ù†
                    </div>
                    <div class="submenu-item" onclick="navigateTo('taxes', this)">
                        <i class="fa-solid fa-scale-balanced"></i> Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù„ÛŒØ§ØªÛŒ (BRT)
                    </div>
                </div>
            </div>

            <div class="nav-item">
                <div class="nav-link" onclick="toggleSubmenu(this)">
                    <i class="fa-solid fa-boxes-stacked"></i>
                    <span data-i18n="navInventory">Ø§Ù†Ø¨Ø§Ø± Ù…Ø­ØµÙˆÙ„Ø§Øª</span>
                    <i class="fa-solid fa-chevron-left arrow"></i>
                </div>
                <div class="submenu">
                    <div class="submenu-item" onclick="navigateTo('inventory', this)">
                        <i class="fa-solid fa-list"></i> Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ù„Ø§
                    </div>
                    <div class="submenu-item" onclick="openModal('modalProduct')">
                        <i class="fa-solid fa-box-open"></i> ØªØ¹Ø±ÛŒÙ Ú©Ø§Ù„Ø§/Ù…ÙˆØ§Ø¯
                    </div>
                </div>
            </div>

            <div class="nav-item">
                <div class="nav-link" onclick="navigateTo('personnel', this)">
                    <i class="fa-solid fa-id-card-clip"></i>
                    <span data-i18n="navPersonnel">Ù¾Ø±Ø³Ù†Ù„ Ùˆ Ø­Ù‚ÙˆÙ‚</span>
                </div>
            </div>

            <div class="nav-item">
                <div class="nav-link" onclick="navigateTo('customers', this)">
                    <i class="fa-solid fa-users"></i>
                    <span data-i18n="navCustomers">Ø¨Ø§Ø´Ú¯Ø§Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†</span>
                </div>
            </div>
            
             <div class="nav-item">
                <div class="nav-link" onclick="navigateTo('services', this)">
                    <i class="fa-solid fa-scissors"></i>
                    <span data-i18n="navServices">Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø¯Ù…Ø§Øª</span>
                </div>
            </div>

            <div class="nav-item">
                <div class="nav-link" onclick="navigateTo('settings', this)">
                    <i class="fa-solid fa-gear"></i>
                    <span data-i18n="navSettings">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…</span>
                </div>
            </div>
        </nav>

        <div style="margin-top: auto; padding: 20px; border-top: 1px solid rgba(212, 175, 55, 0.2); display: flex; align-items: center; gap: 10px;">
            <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--gold-gradient); display: flex; align-items: center; justify-content: center; color: #2D0008; font-weight: bold;">
                <i class="fa-solid fa-user-tie"></i>
            </div>
            <div style="flex: 1; overflow: hidden;">
                <div id="sidebarUserName" style="font-weight: bold; color: var(--gold-light); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…</div>
                <div style="font-size: 11px; color: var(--text-muted);">Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ù…Ù„</div>
            </div>
            <div onclick="handleLogout()" style="cursor:pointer; color:var(--danger)" title="Ø®Ø±ÙˆØ¬">
                <i class="fa-solid fa-power-off"></i>
            </div>
        </div>
    </aside>
<main class="main-content">
        
        <header class="top-header">
            <div class="page-title">
                <i class="fa-solid fa-bars" onclick="toggleSidebar()" style="cursor:pointer; margin-left:10px; font-size:18px; color:var(--text-muted);"></i>
                <span id="headerTitle">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ</span>
            </div>

            <div class="header-actions">
                <div style="background: rgba(212, 175, 55, 0.1); padding: 8px 15px; border-radius: 20px; border: 1px solid var(--gold-dark); color: var(--gold-light); font-size: 13px; font-weight: bold; display:flex; align-items:center; gap:8px;">
                    <i class="fa-regular fa-calendar"></i>
                    <span id="currentDateDisplay">1403/01/01</span>
                </div>

                <div class="d-none d-md-flex" style="gap:10px;">
                    <button class="icon-btn" onclick="openModal('modalAppointment')" title="Ù†ÙˆØ¨Øª Ø¬Ø¯ÛŒØ¯">
                        <i class="fa-solid fa-calendar-plus"></i>
                    </button>
                    <button class="icon-btn" onclick="navigateTo('pos')" title="ÙØ±ÙˆØ´ Ø¬Ø¯ÛŒØ¯">
                        <i class="fa-solid fa-cash-register"></i>
                    </button>
                </div>

                <button class="icon-btn" onclick="toggleTheme()" title="ØªØºÛŒÛŒØ± ØªÙ…">
                    <i class="fa-solid fa-moon" id="themeIconBtn"></i>
                </button>

                <button class="icon-btn" onclick="showNotifications()" style="position:relative;">
                    <i class="fa-regular fa-bell"></i>
                    <span id="notifBadge" style="position:absolute; top:-2px; right:-2px; width:10px; height:10px; background:var(--danger); border-radius:50%; border:1px solid #000; display:none;"></span>
                </button>
            </div>
        </header>

        <div class="page-container">

           <div id="dashboard" class="page-section active">
    
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h3 style="color:var(--text-main); font-size:16px;">
            <i class="fa-solid fa-gauge-high" style="color:var(--gold-primary); margin-left:8px;"></i>
            <span data-i18n="dashOverview">Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ Ø±ÙˆØ²</span>
        </h3>
        <div style="display:flex; gap:10px;">
            <button class="gold-btn btn-sm" onclick="navigateTo('pos')">
                <i class="fa-solid fa-cart-plus"></i> <span data-i18n="newFactor">ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´</span>
            </button>
        </div>
    </div>

    <div class="grid-4">
        <div class="stat-card">
            <div class="stat-icon-box" style="color:#00E676; border-color:rgba(0,230,118,0.3)">
                <i class="fa-solid fa-sack-dollar"></i>
            </div>
            <div class="stat-info">
                <div class="stat-label" data-i18n="todaySales">ÙØ±ÙˆØ´ Ø§Ù…Ø±ÙˆØ²</div>
                <div class="stat-value" id="dashTodayIncome" style="direction:ltr">0 Ø‹</div>
                <div class="status-badge status-success" style="margin-top:5px;">
                    <i class="fa-solid fa-arrow-trend-up"></i> ÙØ¹Ø§Ù„
                </div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon-box" style="color:#FF5252; border-color:rgba(255,82,82,0.3)">
                <i class="fa-solid fa-money-bill-transfer"></i>
            </div>
            <div class="stat-info">
                <div class="stat-label" data-i18n="todayExpense">Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²</div>
                <div class="stat-value" id="dashTodayExpense" style="color:var(--danger); direction:ltr">0 Ø‹</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon-box" style="color:var(--info); border-color:rgba(0,176,255,0.3)">
                <i class="fa-solid fa-users-line"></i>
            </div>
            <div class="stat-info">
                <div class="stat-label" data-i18n="todayApts">Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²</div>
                <div class="stat-value" id="dashTodayApts">0</div>
                <div style="font-size:11px; color:var(--text-muted); margin-top:5px;">
                    <span id="dashPendingApts">0</span> <span data-i18n="pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</span>
                </div>
            </div>
        </div>

        <div class="stat-card" style="border-color:var(--gold-primary); background: linear-gradient(160deg, rgba(212,175,55,0.15), rgba(0,0,0,0.6));">
            <div class="stat-icon-box" style="background:var(--gold-gradient); color:#2D0008; border:none;">
                <i class="fa-solid fa-cash-register"></i>
            </div>
            <div class="stat-info">
                <div class="stat-label" style="color:var(--gold-light)" data-i18n="regStatus">ÙˆØ¶Ø¹ÛŒØª ØµÙ†Ø¯ÙˆÙ‚</div>
                <div class="stat-value" id="dashRegisterStatus" style="font-size:18px;">Ø¨Ø³ØªÙ‡ Ø§Ø³Øª</div>
                <button class="btn-sm" style="background:rgba(0,0,0,0.3); border:1px solid var(--gold-dark); color:var(--gold-light); margin-top:5px; border-radius:4px; cursor:pointer;" onclick="openModal('modalRegister')">
                    <span data-i18n="regManage">Ù…Ø¯ÛŒØ±ÛŒØª ØµÙ†Ø¯ÙˆÙ‚</span>
                </button>
            </div>
        </div>
    </div>

    <div class="grid-2" style="margin-top:25px;">
        <div class="card">
            <div class="card-header">
                <div class="card-title" style="font-weight:bold; color:var(--gold-light);">
                    <i class="fa-solid fa-chart-area" style="margin-left:8px"></i>
                    <span data-i18n="chartIncome">Ù†Ù…ÙˆØ¯Ø§Ø± Ø¯Ø±Ø¢Ù…Ø¯ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡</span>
                </div>
            </div>
            <div style="height: 300px; position: relative;">
                <canvas id="mainChart"></canvas>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title" style="font-weight:bold; color:var(--gold-light);">
                    <i class="fa-solid fa-ranking-star" style="margin-left:8px"></i>
                    <span data-i18n="chartServices">Ø®Ø¯Ù…Ø§Øª Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±</span>
                </div>
            </div>
            <div style="height: 300px; position: relative;">
                <canvas id="servicesChart"></canvas>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title" style="font-weight:bold; color:var(--gold-light);" data-i18n="recentTx">Ø¢Ø®Ø±ÛŒÙ† ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§</div>
            <button class="gold-btn btn-sm" onclick="navigateTo('accounting')" data-i18n="viewAll">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡</button>
        </div>
        <div class="table-container">
            <table class="lux-table">
                <thead>
                    <tr>
                        <th data-i18n="tblTime">Ø²Ù…Ø§Ù†</th>
                        <th data-i18n="tblDesc">Ø´Ø±Ø­ ÙØ¹Ø§Ù„ÛŒØª</th>
                        <th data-i18n="tblAmount">Ù…Ø¨Ù„Øº</th>
                        <th data-i18n="tblType">Ù†ÙˆØ¹</th>
                        <th data-i18n="tblUser">Ú©Ø§Ø±Ø¨Ø±</th>
                    </tr>
                </thead>
                <tbody id="dashRecentTxBody">
                    <tr><td colspan="5" class="text-center" data-i18n="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

            </div> 
<div id="pos" class="page-section">
                <div class="card-header" style="border:none; padding:0; margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
                    <h2 class="page-title" style="border:none; font-size:18px;">
                        <i class="fa-solid fa-cash-register" style="margin-left:10px;"></i>
                        ØµÙ†Ø¯ÙˆÙ‚ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ÛŒ
                    </h2>
                    <div style="font-size:13px; color:var(--text-muted); background:rgba(0,0,0,0.3); padding:5px 10px; border-radius:8px; border:1px solid var(--gold-dark);">
                        ÙˆØ¶Ø¹ÛŒØª ØµÙ†Ø¯ÙˆÙ‚: <span id="posRegisterStatus" style="font-weight:bold; color:var(--success)">Ø¨Ø§Ø²</span>
                    </div>
                </div>

                <div style="display: flex; gap: 20px; height: calc(100vh - 180px); flex-wrap: wrap;">
                    
                    <div style="flex: 2; display: flex; flex-direction: column; min-width: 300px;">
                        
                        <div class="glass-panel" style="padding: 15px; margin-bottom: 15px; display: flex; gap: 10px; border-radius: 12px; align-items:center;">
                            <div style="flex: 1; position: relative;">
                                <i class="fa-solid fa-search" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: var(--text-muted);"></i>
                                <input type="text" id="posSearch" class="lux-input" style="padding-right: 35px;" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ø®Ø¯Ù…Øª ÛŒØ§ Ú©Ø§Ù„Ø§..." onkeyup="renderPosItems()">
                            </div>
                            <select id="posCatFilter" class="lux-select" style="width: 150px;" onchange="renderPosItems()">
                                <option value="all">Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§</option>
                                <option value="service">Ø®Ø¯Ù…Ø§Øª</option>
                                <option value="product">Ù…Ø­ØµÙˆÙ„Ø§Øª</option>
                            </select>
                        </div>

                        <div id="posItemsGrid" style="flex: 1; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; padding-bottom: 10px;">
                            <div style="grid-column: 1/-1; text-align: center; padding: 50px; color: var(--text-muted);">
                                <i class="fa-solid fa-spinner fa-spin" style="font-size: 30px;"></i>
                                <div style="margin-top: 10px;">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø®Ø¯Ù…Ø§Øª Ùˆ Ù…Ø­ØµÙˆÙ„Ø§Øª...</div>
                            </div>
                        </div>
                    </div>

                    <div class="glass-panel" style="flex: 1; min-width: 320px; display: flex; flex-direction: column; border-radius: 16px; overflow: hidden; height: 100%; border: 1px solid var(--gold-dark);">
                        
                        <div style="padding: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.2); background: rgba(0,0,0,0.2);">
                            <label style="font-size: 12px; color: var(--text-muted); margin-bottom: 5px; display: block;">Ù…Ø´ØªØ±ÛŒ:</label>
                            <div style="display: flex; gap: 5px;">
                                <select id="posCustomer" class="lux-select" style="font-size: 13px;">
                                    <option value="guest">Ù…Ø´ØªØ±ÛŒ Ù…Ù‡Ù…Ø§Ù† (Guest)</option>
                                    </select>
                                <button class="icon-btn" onclick="openModal('modalCustomer')" title="Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯" style="width: 40px; border-radius: 8px;">
                                    <i class="fa-solid fa-user-plus"></i>
                                </button>
                            </div>
                        </div>

                        <div id="posCartItems" style="flex: 1; overflow-y: auto; padding: 10px;">
                            <div style="text-align: center; margin-top: 50px; color: var(--text-muted); opacity: 0.5;">
                                <i class="fa-solid fa-basket-shopping" style="font-size: 40px; margin-bottom: 10px;"></i>
                                <div>Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª</div>
                            </div>
                        </div>

                       <div style="padding: 15px; background: rgba(0, 0, 0, 0.4); border-top: 2px solid var(--gold-dark);">
    
    <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 13px;">
        <span style="color: var(--text-muted);">Ø¬Ù…Ø¹ Ø¬Ø²Ø¡:</span>
        <span id="posSubtotal" style="color: #fff;">0 Ø‹</span>
    </div>
    
    <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 13px;">
        <span style="color: var(--text-muted);">Ù…Ø§Ù„ÛŒØ§Øª:</span>
        <span id="posTax" style="color: var(--warning);">0 Ø‹</span>
    </div>

    <div style="height: 1px; background: rgba(255,255,255,0.1); margin: 10px 0;"></div>

    <div style="display: flex; justify-content: space-between; margin-bottom: 15px; align-items: center;">
        <span style="font-weight: bold; font-size: 16px; color: var(--gold-primary);">Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª:</span>
        <span id="posTotal" style="font-weight: 900; font-size: 24px; color: var(--gold-light); direction: ltr;" data-raw="0">0 Ø‹</span>
    </div>

    <div class="grid-2" style="margin-bottom: 15px; gap: 10px;">
        <div class="form-group" style="margin:0;">
            <label style="font-size:11px; color:var(--text-muted); display:block; margin-bottom:3px;">Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù‚Ø¯ÛŒ</label>
            <input type="number" id="payCashInput" class="lux-input" style="font-size:14px; color:var(--success); font-weight:bold; height:35px;" onkeyup="autoCalcCard()">
        </div>
        <div class="form-group" style="margin:0;">
            <label style="font-size:11px; color:var(--text-muted); display:block; margin-bottom:3px;">Ú©Ø§Ø±ØªØ®ÙˆØ§Ù†</label>
            <input type="number" id="payCardInput" class="lux-input" style="font-size:14px; color:var(--info); font-weight:bold; height:35px;" readonly>
        </div>
    </div>

    <div class="grid-2">
        <button class="btn" style="background: rgba(255, 23, 68, 0.2); color: var(--danger); border: 1px solid var(--danger);" onclick="clearCart()">
            <i class="fa-solid fa-trash"></i> Ù„ØºÙˆ
        </button>
        <button class="gold-btn" style="font-size: 16px;" onclick="processCheckout()">
            <i class="fa-solid fa-check-circle"></i> Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ
        </button>
    </div>
</div>
                    </div>
                </div>
            </div>
<div id="accounting" class="page-section">
                <div class="card-header" style="background: transparent; border:none; padding:0; margin-bottom: 20px; display:flex; justify-content:space-between; align-items:center;">
                    <h2 class="page-title" style="border:none; margin:0; font-size:18px;">
                        <i class="fa-solid fa-money-bill-transfer" style="margin-left:10px;"></i>
                        Ø§Ù…ÙˆØ± Ù…Ø§Ù„ÛŒ Ùˆ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ
                    </h2>
                    <div style="display:flex; gap:10px">
                        <button class="gold-btn btn-sm" onclick="openModal('modalNewTx', 'income')">
                            <i class="fa-solid fa-plus"></i> Ø«Ø¨Øª Ø¯Ø±Ø¢Ù…Ø¯
                        </button>
                        <button class="btn-sm" style="background: linear-gradient(135deg, #8E0E00, #1F1C18); color:#fff; border:1px solid var(--danger); cursor:pointer; border-radius:8px;" onclick="openModal('modalNewTx', 'expense')">
                            <i class="fa-solid fa-minus"></i> Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡
                        </button>
                        <button class="icon-btn" onclick="exportToExcel('accountingTable')" title="Ø®Ø±ÙˆØ¬ÛŒ Ø§Ú©Ø³Ù„">
                            <i class="fa-solid fa-file-excel"></i>
                        </button>
                    </div>
                </div>

                <div class="grid-3">
                    <div class="stat-card" style="border-right: 4px solid var(--success);">
                        <div class="stat-info">
                            <div class="stat-label">Ú©Ù„ Ø¯Ø±ÛŒØ§ÙØªÛŒâ€ŒÙ‡Ø§</div>
                            <div class="stat-value" id="accTotalIncome" style="color:var(--success); direction:ltr">0 Ø‹</div>
                        </div>
                    </div>
                    <div class="stat-card" style="border-right: 4px solid var(--danger);">
                        <div class="stat-info">
                            <div class="stat-label">Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</div>
                            <div class="stat-value" id="accTotalExpense" style="color:var(--danger); direction:ltr">0 Ø‹</div>
                        </div>
                    </div>
                    <div class="stat-card" style="border-right: 4px solid var(--gold-primary);">
                        <div class="stat-info">
                            <div class="stat-label">ØªØ±Ø§Ø² Ù…Ø§Ù„ÛŒ Ú©Ù„</div>
                            <div class="stat-value" id="accBalance" style="direction:ltr">0 Ø‹</div>
                        </div>
                    </div>
                </div>

                <div class="glass-panel" style="margin: 20px 0; padding: 15px; display:flex; flex-wrap:wrap; gap:15px; align-items:center; border-radius:12px;">
                    <i class="fa-solid fa-filter" style="color:var(--gold-primary)"></i>
                    <input type="text" class="lux-input" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø´Ø±Ø­..." id="accSearch" style="width:200px" onkeyup="filterAccounting()">
                    <select class="lux-select" id="accFilterType" onchange="filterAccounting()" style="width:150px">
                        <option value="all">Ù‡Ù…Ù‡ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</option>
                        <option value="income">Ø¯Ø±Ø¢Ù…Ø¯Ù‡Ø§</option>
                        <option value="expense">Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</option>
                    </select>
                    <input type="date" class="lux-input" id="accDateFilter" style="width:auto" onchange="filterAccounting()">
                    <button class="icon-btn" onclick="renderAccounting()" style="width:35px; height:35px;" title="Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ"><i class="fa-solid fa-rotate-right"></i></button>
                </div>

                <div class="table-container">
                    <table class="lux-table" id="accountingTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>ØªØ§Ø±ÛŒØ® & Ø²Ù…Ø§Ù†</th>
                                <th>Ù†ÙˆØ¹</th>
                                <th>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th>
                                <th>Ø´Ø±Ø­ / Ø¨Ø§Ø¨Øª</th>
                                <th>Ù…Ø¨Ù„Øº (AFN)</th>
                                <th>Ù…Ø§Ù„ÛŒØ§Øª</th>
                                <th>Ú©Ø§Ø±Ø¨Ø±</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="accountingBody">
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="taxes" class="page-section">
                <div class="card-header" style="border:none; margin-bottom:20px;">
                    <h2 class="page-title" style="font-size:18px;">
                        <i class="fa-solid fa-scale-balanced" style="margin-left:10px;"></i>
                        Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù„ÛŒØ§ØªÛŒ (BRT / VAT)
                    </h2>
                </div>

                <div class="grid-2">
                    <div class="card">
                        <h3 style="color:var(--gold-light); margin-bottom:15px; font-size:16px;">
                            <i class="fa-solid fa-sliders"></i> ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ø±Ø® Ù…Ø§Ù„ÛŒØ§Øª
                        </h3>
                        <p style="font-size:12px; color:var(--text-muted); margin-bottom:15px;">
                            Ù†Ø±Ø® Ù…Ø§Ù„ÛŒØ§Øª Ø¨Ø± Ø¹ÙˆØ§ÛŒØ¯ (BRT) ÛŒØ§ Ø§Ø±Ø²Ø´ Ø§ÙØ²ÙˆØ¯Ù‡ Ø±Ø§ Ø·Ø¨Ù‚ Ù‚Ø§Ù†ÙˆÙ† Ø¬Ø§Ø±ÛŒ Ø§ÙØºØ§Ù†Ø³ØªØ§Ù† ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯.
                        </p>
                        <div style="display:flex; gap:10px; align-items:center; background:rgba(0,0,0,0.3); padding:15px; border-radius:10px; border:1px solid var(--gold-dark);">
                            <span style="font-weight:bold;">Ù†Ø±Ø® ÙØ¹Ù„ÛŒ (%):</span>
                            <input type="number" id="taxRateDisplay" class="lux-input" style="width:80px; text-align:center; font-weight:bold;" value="4" readonly>
                            <button class="btn-sm" style="border:1px solid var(--gold-primary); background:transparent; color:var(--gold-primary); cursor:pointer;" onclick="navigateTo('settings')">ØªØºÛŒÛŒØ± Ù†Ø±Ø®</button>
                        </div>
                    </div>

                    <div class="card">
                        <h3 style="color:var(--gold-light); margin-bottom:15px; font-size:16px;">
                            <i class="fa-solid fa-print"></i> ØªÙ‡ÛŒÙ‡ Ú¯Ø²Ø§Ø±Ø´
                        </h3>
                        <div class="form-group">
                            <label class="form-label">Ø¯ÙˆØ±Ù‡ Ù…Ø§Ù„ÛŒØ§ØªÛŒ:</label>
                            <div style="display:flex; gap:10px;">
                                <select id="taxReportSeason" class="lux-select">
                                    <option value="1">Ø³Ù‡ Ù…Ø§Ù‡Ù‡ Ø§ÙˆÙ„ (Ø­Ù…Ù„ - Ø¬ÙˆØ²Ø§)</option>
                                    <option value="2">Ø³Ù‡ Ù…Ø§Ù‡Ù‡ Ø¯ÙˆÙ… (Ø³Ø±Ø·Ø§Ù† - Ø³Ù†Ø¨Ù„Ù‡)</option>
                                    <option value="3">Ø³Ù‡ Ù…Ø§Ù‡Ù‡ Ø³ÙˆÙ… (Ù…ÛŒØ²Ø§Ù† - Ù‚ÙˆØ³)</option>
                                    <option value="4">Ø³Ù‡ Ù…Ø§Ù‡Ù‡ Ú†Ù‡Ø§Ø±Ù… (Ø¬Ø¯ÛŒ - Ø­ÙˆØª)</option>
                                    <option value="year">Ú¯Ø²Ø§Ø±Ø´ Ø³Ø§Ù„Ø§Ù†Ù‡</option>
                                </select>
                                <button class="gold-btn" onclick="calculateTaxReport()">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="taxResultArea" style="display:none; animation:fadeIn 0.5s;">
                    <div class="glass-panel" style="padding:30px; border:2px solid var(--gold-primary); position:relative;">
                        <div style="position:absolute; top:20px; left:20px; opacity:0.1; font-size:100px; color:var(--gold-primary);">
                            <i class="fa-solid fa-stamp"></i>
                        </div>
                        
                        <div style="text-align:center; margin-bottom:30px;">
                            <h2 style="color:var(--gold-light);">ÙØ±Ù… Ø§Ø¸Ù‡Ø§Ø±Ù†Ø§Ù…Ù‡ Ù…Ø§Ù„ÛŒØ§ØªÛŒ</h2>
                            <p style="color:var(--text-muted); font-size:12px;" id="taxReportDateRange">Ø¯ÙˆØ±Ù‡: Ù†Ø§Ù…Ø´Ø®Øµ</p>
                        </div>

                        <table class="lux-table" style="border:1px solid var(--gold-dark);">
                            <tr>
                                <td style="width:70%;">Ù…Ø¬Ù…ÙˆØ¹ ÙØ±ÙˆØ´ Ù†Ø§Ø®Ø§Ù„Øµ (Gross Sales)</td>
                                <td style="font-weight:bold; direction:ltr;" id="taxGrossSales">0 Ø‹</td>
                            </tr>
                            <tr>
                                <td>Ú©Ø³ÙˆØ±Ø§Øª Ù…Ø¬Ø§Ø² / Ù…Ø¹Ø§ÙÛŒØªâ€ŒÙ‡Ø§</td>
                                <td style="font-weight:bold; direction:ltr;" id="taxDeductions">0 Ø‹</td>
                            </tr>
                            <tr style="background:rgba(212,175,55,0.1);">
                                <td>Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø´Ù…ÙˆÙ„ Ù…Ø§Ù„ÛŒØ§Øª (Taxable Income)</td>
                                <td style="font-weight:bold; direction:ltr; color:var(--gold-light);" id="taxableIncome">0 Ø‹</td>
                            </tr>
                            <tr style="background:rgba(255, 23, 68, 0.15); border-top:2px solid var(--danger);">
                                <td style="color:var(--danger); font-weight:bold; font-size:16px;">Ù…Ø§Ù„ÛŒØ§Øª Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª (Tax Due)</td>
                                <td style="color:var(--danger); font-weight:bold; font-size:18px; direction:ltr;" id="taxPayable">0 Ø‹</td>
                            </tr>
                        </table>

                        <div style="margin-top:20px; text-align:left;">
                            <button class="icon-btn" onclick="window.print()" title="Ú†Ø§Ù¾ Ú¯Ø²Ø§Ø±Ø´" style="display:inline-flex; width:auto; padding:0 20px; gap:10px;">
                                <i class="fa-solid fa-print"></i> Ú†Ø§Ù¾ Ø±Ø³Ù…ÛŒ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
<div id="debts" class="page-section">
                <div class="card-header" style="border:none; margin-bottom:20px; display:flex; justify-content:space-between; align-items:center;">
                    <h2 class="page-title" style="font-size:18px;">
                        <i class="fa-solid fa-hand-holding-dollar" style="margin-left:10px;"></i>
                        Ø¯ÙØªØ± Ø¨Ø¯Ù‡Ú©Ø§Ø±Ø§Ù† Ùˆ Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²
                    </h2>
                    <div style="background:rgba(255, 23, 68, 0.1); padding:5px 15px; border-radius:8px; border:1px solid var(--danger); color:var(--danger); font-size:13px;">
                        Ù…Ø¬Ù…ÙˆØ¹ Ù…Ø·Ø§Ù„Ø¨Ø§Øª: <span id="totalDebtDisplay" style="font-weight:bold; font-size:16px; direction:ltr; margin-right:5px;">0 Ø‹</span>
                    </div>
                </div>

                <div class="card">
                    <div class="glass-panel" style="padding:15px; margin-bottom:15px; display:flex; gap:10px; align-items:center; background:rgba(0,0,0,0.2);">
                        <i class="fa-solid fa-search" style="color:var(--gold-dark)"></i>
                        <input type="text" id="debtSearch" class="lux-input" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ù†Ø§Ù… Ø¨Ø¯Ù‡Ú©Ø§Ø±..." onkeyup="renderDebts()">
                    </div>

                    <div class="table-container">
                        <table class="lux-table">
                            <thead>
                                <tr>
                                    <th>Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ</th>
                                    <th>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</th>
                                    <th>Ù…Ø¨Ù„Øº Ø¨Ø¯Ù‡ÛŒ (AFN)</th>
                                    <th>Ø¢Ø®Ø±ÛŒÙ† Ø®Ø±ÛŒØ¯/ØªØ±Ø§Ú©Ù†Ø´</th>
                                    <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                    <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="debtsBody">
                                <tr><td colspan="6" class="text-center">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ø¨Ø¯Ù‡Ú©Ø§Ø±Ø§Ù†...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="appointments" class="page-section">
                <div class="card-header" style="border:none; margin-bottom:20px; display:flex; justify-content:space-between; align-items:center;">
                    <h2 class="page-title" style="font-size:18px;">
                        <i class="fa-solid fa-calendar-check" style="margin-left:10px;"></i>
                        Ù„ÛŒØ³Øª Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§ Ùˆ Ø±Ø²Ø±ÙˆÙ‡Ø§
                    </h2>
                    <button class="gold-btn" onclick="openModal('modalAppointment')">
                        <i class="fa-solid fa-plus"></i> Ù†ÙˆØ¨Øª Ø¬Ø¯ÛŒØ¯
                    </button>
                </div>

                <div class="glass-panel" style="padding:15px; margin-bottom:20px; display:flex; flex-wrap:wrap; gap:15px; align-items:center; border-radius:12px;">
                    <div style="display:flex; align-items:center; gap:5px; flex:1; min-width:200px;">
                        <span style="font-size:12px; color:var(--text-muted);">ØªØ§Ø±ÛŒØ®:</span>
                        <input type="text" id="aptDateFilter" class="lux-input" placeholder="Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ®" style="text-align:center;">
                        <button class="icon-btn" onclick="setTodayFilter()" title="Ø§Ù…Ø±ÙˆØ²" style="width:35px; height:35px;"><i class="fa-solid fa-calendar-day"></i></button>
                    </div>

                    <select id="aptStatusFilter" class="lux-select" style="width:150px;" onchange="renderAppointments()">
                        <option value="all">Ù‡Ù…Ù‡ ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§</option>
                        <option value="scheduled">Ø±Ø²Ø±Ùˆ Ø´Ø¯Ù‡</option>
                        <option value="confirmed">ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡</option>
                        <option value="completed">Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡</option>
                        <option value="canceled">Ù„ØºÙˆ Ø´Ø¯Ù‡</option>
                    </select>

                    <select id="aptStaffFilter" class="lux-select" style="width:150px;" onchange="renderAppointments()">
                        <option value="all">Ù‡Ù…Ù‡ Ù¾Ø±Ø³Ù†Ù„</option>
                        </select>
                </div>

                <div id="appointmentsList" class="grid-3">
                    <div style="grid-column:1/-1; text-align:center; padding:50px; color:var(--text-muted); border:2px dashed var(--gold-dark); border-radius:15px;">
                        <i class="fa-solid fa-calendar-xmark" style="font-size:40px; margin-bottom:15px; opacity:0.5;"></i>
                        <div>Ù‡ÛŒÚ† Ù†ÙˆØ¨ØªÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÛŒØ§ÙØª Ù†Ø´Ø¯</div>
                    </div>
                </div>
            </div>
<div id="inventory" class="page-section">
                <div class="card-header" style="border:none; margin-bottom:20px; display:flex; justify-content:space-between; align-items:center;">
                    <h2 class="page-title" style="font-size:18px;">
                        <i class="fa-solid fa-boxes-stacked" style="margin-left:10px;"></i>
                        Ø§Ù†Ø¨Ø§Ø± Ùˆ Ù…Ø­ØµÙˆÙ„Ø§Øª
                    </h2>
                    <button class="gold-btn" onclick="openModal('modalProduct')">
                        <i class="fa-solid fa-box-open"></i> Ú©Ø§Ù„Ø§ Ø¬Ø¯ÛŒØ¯
                    </button>
                </div>

                <div class="grid-3">
                    <div class="stat-card" style="padding:15px; min-height:100px;">
                        <div class="stat-icon-box" style="width:45px; height:45px; font-size:18px; color:var(--text-main);">
                            <i class="fa-solid fa-cubes"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ Ø§Ù‚Ù„Ø§Ù…</div>
                            <div class="stat-value" id="invTotalItems">0</div>
                        </div>
                    </div>
                    
                    <div class="stat-card" style="padding:15px; min-height:100px;">
                        <div class="stat-icon-box" style="width:45px; height:45px; font-size:18px; color:var(--text-main);">
                            <i class="fa-solid fa-tags"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-label">Ø§Ø±Ø²Ø´ Ú©Ù„ Ø§Ù†Ø¨Ø§Ø±</div>
                            <div class="stat-value" id="invTotalValue" style="font-size:18px; direction:ltr;">0 Ø‹</div>
                        </div>
                    </div>

                    <div class="stat-card" style="padding:15px; min-height:100px; border-color:var(--danger);">
                        <div class="stat-icon-box" style="width:45px; height:45px; font-size:18px; color:var(--danger); border-color:var(--danger);">
                            <i class="fa-solid fa-triangle-exclamation"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-label">Ù‡Ø´Ø¯Ø§Ø± Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ù…</div>
                            <div class="stat-value" id="invLowStock" style="color:var(--danger)">0</div>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top:20px;">
                    <div class="glass-panel" style="padding:15px; margin-bottom:15px; display:flex; gap:10px; align-items:center; background:rgba(0,0,0,0.2);">
                        <i class="fa-solid fa-search" style="color:var(--gold-dark)"></i>
                        <input type="text" id="invSearch" class="lux-input" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ù†Ø§Ù… Ú©Ø§Ù„Ø§ ÛŒØ§ Ø¨Ø±Ù†Ø¯..." onkeyup="renderInventory()">
                    </div>

                    <div class="table-container">
                        <table class="lux-table">
                            <thead>
                                <tr>
                                    <th>Ù†Ø§Ù… Ú©Ø§Ù„Ø§</th>
                                    <th>Ø¨Ø±Ù†Ø¯</th>
                                    <th>Ù…ÙˆØ¬ÙˆØ¯ÛŒ</th>
                                    <th>Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯</th>
                                    <th>Ù‚ÛŒÙ…Øª ÙØ±ÙˆØ´</th>
                                    <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                    <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryBody">
                                <tr><td colspan="7" class="text-center">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ù†Ø¨Ø§Ø±...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="personnel" class="page-section">
                <div class="card-header" style="border:none; margin-bottom:20px; display:flex; justify-content:space-between; align-items:center;">
                    <h2 class="page-title" style="font-size:18px;">
                        <i class="fa-solid fa-id-card-clip" style="margin-left:10px;"></i>
                        Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø³Ù†Ù„ Ùˆ Ø­Ù‚ÙˆÙ‚
                    </h2>
                    <button class="gold-btn" onclick="openModal('modalStaff')">
                        <i class="fa-solid fa-user-plus"></i> Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ø¯ÛŒØ¯
                    </button>
                </div>

                <div class="table-container" style="margin-bottom:30px;">
                    <table class="lux-table">
                        <thead>
                            <tr>
                                <th>Ù†Ø§Ù… Ù¾Ø±Ø³Ù†Ù„</th>
                                <th>Ù†Ù‚Ø´ / ØªØ®ØµØµ</th>
                                <th>Ø­Ù‚ÙˆÙ‚ Ø«Ø§Ø¨Øª (AFN)</th>
                                <th>Ø¯Ø±ØµØ¯ Ú©Ù…ÛŒØ³ÛŒÙˆÙ†</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="personnelBody">
                            </tbody>
                    </table>
                </div>

                <div class="card" style="border:1px solid var(--gold-dark);">
                    <div class="card-header">
                        <h3 style="color:var(--gold-light); font-size:16px;">
                            <i class="fa-solid fa-calculator"></i> Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ù‚ÙˆÙ‚ Ùˆ Ø¯Ø³ØªÙ…Ø²Ø¯ Ù…Ø§Ù‡Ø§Ù†Ù‡
                        </h3>
                    </div>
                    
                    <div class="grid-3" style="align-items:end;">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ø±Ø³Ù†Ù„</label>
                            <select class="lux-select" id="payrollStaffSel"></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø¯ÙˆØ±Ù‡ (Ù…Ø§Ù‡/Ø³Ø§Ù„)</label>
                            <div style="display:flex; gap:5px;">
                                <select class="lux-select" id="payrollMonth"></select>
                                <input type="number" id="payrollYear" class="lux-input" value="1403" style="width:80px; text-align:center;">
                            </div>
                        </div>
                        <div class="form-group">
                            <button class="gold-btn" style="width:100%" onclick="calculateSalary()">
                                <i class="fa-solid fa-file-invoice-dollar"></i> ØµØ¯ÙˆØ± ÙÛŒØ´ Ø­Ù‚ÙˆÙ‚ÛŒ
                            </button>
                        </div>
                    </div>

                    <div id="payrollResult" style="display:none; margin-top:20px; padding:20px; border:1px dashed var(--gold-primary); border-radius:12px; background:rgba(0,0,0,0.3);">
                        </div>
                </div>
            </div>
<div id="customers" class="page-section">
                <div class="card-header" style="border:none; margin-bottom:20px; display:flex; justify-content:space-between; align-items:center;">
                    <h2 class="page-title" style="font-size:18px;">
                        <i class="fa-solid fa-users" style="margin-left:10px;"></i>
                        Ø¨Ø§Ø´Ú¯Ø§Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†
                    </h2>
                    <button class="gold-btn" onclick="openModal('modalCustomer')">
                        <i class="fa-solid fa-user-plus"></i> Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯
                    </button>
                </div>

                <div class="grid-3">
                    <div class="stat-card">
                        <div class="stat-icon-box" style="color:var(--info); border-color:var(--info);">
                            <i class="fa-solid fa-address-book"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ù…Ø´ØªØ±ÛŒØ§Ù†</div>
                            <div class="stat-value" id="crmTotalCust">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon-box" style="color:var(--success); border-color:var(--success);">
                            <i class="fa-solid fa-user-check"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-label">Ù…Ø´ØªØ±ÛŒØ§Ù† ÙØ¹Ø§Ù„ (Ù…Ø§Ù‡ Ø¬Ø§Ø±ÛŒ)</div>
                            <div class="stat-value" id="crmActiveMonth">0</div>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top:20px;">
                    <div class="glass-panel" style="padding:15px; margin-bottom:15px; display:flex; gap:10px; align-items:center; background:rgba(0,0,0,0.2);">
                        <i class="fa-solid fa-search" style="color:var(--gold-dark)"></i>
                        <input type="text" id="crmSearch" class="lux-input" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ù†Ø§Ù… ÛŒØ§ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„..." onkeyup="renderCustomers()">
                    </div>

                    <div class="table-container">
                        <table class="lux-table" id="customersTable">
                            <thead>
                                <tr>
                                    <th>Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ</th>
                                    <th>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</th>
                                    <th>Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø²Ø¯ÛŒØ¯</th>
                                    <th>ØªØ¹Ø¯Ø§Ø¯ Ù…Ø±Ø§Ø¬Ø¹Ø§Øª</th>
                                    <th>Ø§Ù…ØªÛŒØ§Ø² ÙˆÙØ§Ø¯Ø§Ø±ÛŒ</th>
                                    <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="customersBody">
                                <tr><td colspan="6" class="text-center">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù†...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="services" class="page-section">
                <div class="card-header" style="border:none; margin-bottom:20px; display:flex; justify-content:space-between; align-items:center;">
                    <h2 class="page-title" style="font-size:18px;">
                        <i class="fa-solid fa-scissors" style="margin-left:10px;"></i>
                        Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø¯Ù…Ø§Øª Ùˆ Ù†Ø±Ø®â€ŒÙ‡Ø§
                    </h2>
                    <button class="gold-btn" onclick="openModal('modalService')">
                        <i class="fa-solid fa-plus"></i> Ø®Ø¯Ù…Øª Ø¬Ø¯ÛŒØ¯
                    </button>
                </div>

                <div class="glass-panel" style="padding:15px; margin-bottom:20px; display:flex; gap:10px; align-items:center; border-radius:12px;">
                    <input type="text" class="lux-input" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ù†Ø§Ù… Ø®Ø¯Ù…Øª..." onkeyup="renderServices(this.value)">
                </div>

                <div class="service-grid" id="servicesGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                    <div style="grid-column:1/-1; text-align:center; padding:50px; color:var(--text-muted);">
                        <i class="fa-solid fa-spinner fa-spin"></i> Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø®Ø¯Ù…Ø§Øª...
                    </div>
                </div>
            </div>
<div id="settings" class="page-section">
                <div class="card-header" style="border:none; margin-bottom:20px;">
                    <h2 class="page-title" style="font-size:18px;">
                        <i class="fa-solid fa-gear" style="margin-left:10px;"></i>
                        ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…
                    </h2>
                </div>

                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('tabGeneral', this)">Ù…Ø´Ø®ØµØ§Øª Ø³Ø§Ù„Ù†</button>
                    <button class="tab-btn" onclick="switchTab('tabFinance', this)">Ø§Ù…ÙˆØ± Ù…Ø§Ù„ÛŒ Ùˆ Ù…Ø§Ù„ÛŒØ§Øª</button>
                    <button class="tab-btn" onclick="switchTab('tabBackup', this)">Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ</button>
                    <button class="tab-btn" onclick="switchTab('tabSecurity', this)">Ø§Ù…Ù†ÛŒØª Ùˆ Ø­Ø³Ø§Ø¨</button>
                </div>

                <div id="tabGeneral" class="tab-content active">
                    <div class="card">
                        <div class="grid-2">
                            <div class="form-group">
                                <label class="form-label">Ù†Ø§Ù… Ø³Ø§Ù„Ù† / Ø¢Ø±Ø§ÛŒØ´Ú¯Ø§Ù‡</label>
                                <input type="text" id="setSalonName" class="lux-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ØªÙ„ÙÙ† ØªÙ…Ø§Ø³</label>
                                <input type="text" id="setPhone" class="lux-input">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø¢Ø¯Ø±Ø³ Ø¯Ù‚ÛŒÙ‚</label>
                            <input type="text" id="setAddress" class="lux-input">
                        </div>
                        <div style="text-align:left;">
                            <button class="gold-btn" onclick="saveGeneralSettings()">
                                <i class="fa-solid fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                            </button>
                        </div>
                    </div>
                </div>

                <div id="tabFinance" class="tab-content">
                    <div class="card">
                        <h3 style="color:var(--gold-light); margin-bottom:15px; font-size:16px;">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø§Ù„ÛŒØ§ØªÛŒ (Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†)</h3>
                        
                        <div class="grid-2">
                            <div class="form-group">
                                <label class="form-label">ÙˆØ§Ø­Ø¯ Ù¾ÙˆÙ„ Ø³ÛŒØ³ØªÙ…</label>
                                <select class="lux-select" disabled style="opacity:0.7; cursor:not-allowed;">
                                    <option selected>Ø§ÙØºØ§Ù†ÛŒ (AFN - Ø‹)</option>
                                </select>
                                <p style="font-size:11px; color:var(--text-muted); margin-top:5px;">Ø·Ø¨Ù‚ Ù‚ÙˆØ§Ù†ÛŒÙ†ØŒ ÙˆØ§Ø­Ø¯ Ù¾ÙˆÙ„ Ø±ÙˆÛŒ Ø§ÙØºØ§Ù†ÛŒ Ù‚ÙÙ„ Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Ù†ÙˆØ¹ Ù…Ø§Ù„ÛŒØ§Øª (Tax Type)</label>
                                <select id="setTaxType" class="lux-select" onchange="toggleTaxInput()">
                                    <option value="none">Ø¨Ø¯ÙˆÙ† Ù…Ø§Ù„ÛŒØ§Øª (Ù…Ø¹Ø§Ù)</option>
                                    <option value="brt">Ù…Ø§Ù„ÛŒØ§Øª Ø¨Ø± Ø¹ÙˆØ§ÛŒØ¯ (BRT - 4%)</option>
                                    <option value="vat">Ù…Ø§Ù„ÛŒØ§Øª Ø¨Ø± Ø§Ø±Ø²Ø´ Ø§ÙØ²ÙˆØ¯Ù‡ (VAT - 10%)</option>
                                    <option value="custom">Ù†Ø±Ø® Ø¯Ù„Ø®ÙˆØ§Ù‡</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group" id="taxRateGroup" style="display:none;">
                            <label class="form-label">Ø¯Ø±ØµØ¯ Ù…Ø§Ù„ÛŒØ§Øª (%)</label>
                            <input type="number" id="setTaxRate" class="lux-input" placeholder="Ù…Ø«Ù„Ø§Ù‹ 4" style="width:100px; text-align:center;">
                        </div>

                        <div style="margin-top:20px; padding:15px; background:rgba(255, 171, 0, 0.1); border:1px dashed var(--warning); border-radius:10px;">
                            <i class="fa-solid fa-circle-info" style="color:var(--warning); margin-left:5px;"></i>
                            <span style="font-size:12px; color:var(--text-main);">ØªØºÛŒÛŒØ± Ù†Ø±Ø® Ù…Ø§Ù„ÛŒØ§Øª Ø¨Ø± Ø±ÙˆÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡ ØªØ§Ø«ÛŒØ± Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ø¯ Ùˆ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ ØªØºÛŒÛŒØ± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.</span>
                        </div>

                        <div style="text-align:left; margin-top:20px;">
                            <button class="gold-btn" onclick="saveFinanceSettings()">
                                <i class="fa-solid fa-check-circle"></i> Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø§Ù„ÛŒ
                            </button>
                        </div>
                    </div>
                </div>

                <div id="tabBackup" class="tab-content">
                    <div class="grid-2">
                        <div class="card" style="text-align:center; border:1px solid var(--success);">
                            <i class="fa-solid fa-cloud-arrow-down" style="font-size:40px; color:var(--success); margin-bottom:15px;"></i>
                            <h3 style="color:#fff; margin-bottom:10px;">ØªÙ‡ÛŒÙ‡ Ù†Ø³Ø®Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†</h3>
                            <p style="color:var(--text-muted); font-size:12px; margin-bottom:20px;">
                                Ø¯Ø§Ù†Ù„ÙˆØ¯ ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª (Ù…Ø´ØªØ±ÛŒØ§Ù†ØŒ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒØŒ Ø§Ù†Ø¨Ø§Ø±) Ø¯Ø± ÛŒÚ© ÙØ§ÛŒÙ„ Ø§Ù…Ù†.
                            </p>
                            <button class="gold-btn" onclick="exportBackup()" style="width:100%;">
                                Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† (Backup)
                            </button>
                        </div>

                        <div class="card" style="text-align:center; border:1px solid var(--info);">
                            <i class="fa-solid fa-cloud-arrow-up" style="font-size:40px; color:var(--info); margin-bottom:15px;"></i>
                            <h3 style="color:#fff; margin-bottom:10px;">Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</h3>
                            <p style="color:var(--text-muted); font-size:12px; margin-bottom:20px;">
                                Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù‚Ø¨Ù„ÛŒ. (Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ¹Ù„ÛŒ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÛŒâ€ŒØ´ÙˆØ¯)
                            </p>
                            <button class="btn" style="background:#333; color:#fff; border:1px solid #555; width:100%;" onclick="document.getElementById('importFile').click()">
                                Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„ Ùˆ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ
                            </button>
                            <input type="file" id="importFile" style="display:none" accept=".json" onchange="importBackup(this)">
                        </div>
                    </div>
                    
                    <div style="margin-top:20px; text-align:center;">
                        <button class="btn" style="color:var(--danger); border:1px solid var(--danger); background:rgba(255,0,0,0.1);" onclick="factoryReset()">
                            <i class="fa-solid fa-triangle-exclamation"></i> Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ (Ø­Ø°Ù Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§)
                        </button>
                    </div>
                </div>

                <div id="tabSecurity" class="tab-content">
                    <div class="card" style="max-width:500px; margin:0 auto;">
                        <h3 style="color:var(--gold-light); margin-bottom:20px; text-align:center;">ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù…Ø¯ÛŒØ±ÛŒØª</h3>
                        
                        <div class="form-group">
                            <label class="form-label">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¬Ø¯ÛŒØ¯</label>
                            <input type="text" id="secNewUser" class="lux-input" placeholder="admin">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯</label>
                            <input type="password" id="secNewPass" class="lux-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ØªÚ©Ø±Ø§Ø± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
                            <input type="password" id="secConfirmPass" class="lux-input">
                        </div>

                        <div style="text-align:center; margin-top:20px;">
                            <button class="gold-btn" onclick="saveSecuritySettings()">
                                <i class="fa-solid fa-lock"></i> Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø´Ø®ØµØ§Øª ÙˆØ±ÙˆØ¯
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div> </main>
</div> 
<div class="modal-overlay" id="modalRegister">
    <div class="lux-modal" style="max-width:450px;">
        <div class="modal-header">
            <div class="modal-title"><i class="fa-solid fa-cash-register"></i> Ù…Ø¯ÛŒØ±ÛŒØª ØµÙ†Ø¯ÙˆÙ‚</div>
            <button class="close-modal" onclick="closeModal('modalRegister')">&times;</button>
        </div>
        <div class="modal-body">
            <div id="registerOpenForm">
                <p style="color:var(--text-muted); margin-bottom:15px; font-size:13px;">
                    Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ÙØ±ÙˆØ´ØŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ÛŒØ¯ ØµÙ†Ø¯ÙˆÙ‚ Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯ Ùˆ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§ÙˆÙ„ ÙˆÙ‚Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ù†Ù…Ø§ÛŒÛŒØ¯.
                </p>
                <div class="form-group">
                    <label class="form-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù†Ù‚Ø¯ÛŒ Ø´Ø±ÙˆØ¹ (Ø§ÙØºØ§Ù†ÛŒ)</label>
                    <input type="number" id="regStartCash" class="lux-input" style="font-size:18px; font-weight:bold; color:var(--gold-light);" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">ÛŒØ§Ø¯Ø¯Ø§Ø´Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
                    <textarea id="regOpenNote" class="lux-textarea" rows="2"></textarea>
                </div>
                <button class="gold-btn" style="width:100%;" onclick="openRegister()">
                    <i class="fa-solid fa-lock-open"></i> Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† ØµÙ†Ø¯ÙˆÙ‚
                </button>
            </div>

            <div id="registerCloseForm" style="display:none;">
                <div style="background:rgba(0,0,0,0.2); padding:15px; border-radius:10px; margin-bottom:15px; border:1px solid var(--gold-dark);">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span>Ø²Ù…Ø§Ù† Ø¨Ø§Ø²Ú¯Ø´Ø§ÛŒÛŒ:</span>
                        <span id="regStartTimeDisplay" style="color:var(--gold-light);">08:00</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span>ÙØ±ÙˆØ´ Ù†Ù‚Ø¯ÛŒ Ø§Ù…Ø±ÙˆØ²:</span>
                        <span id="regTotalCashDisplay" style="color:var(--success);">0 Ø‹</span>
                    </div>
                    <div style="display:flex; justify-content:space-between;">
                        <span>ÙØ±ÙˆØ´ Ú©Ø§Ø±ØªÛŒ/Ø¢Ù†Ù„Ø§ÛŒÙ†:</span>
                        <span id="regTotalCardDisplay" style="color:var(--info);">0 Ø‹</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù†Ù‚Ø¯ÛŒ Ø´Ù…Ø§Ø±Ø´ Ø´Ø¯Ù‡ (Ù¾Ø§ÛŒØ§Ù† Ø±ÙˆØ²)</label>
                    <input type="number" id="regEndCash" class="lux-input" style="font-size:18px; font-weight:bold; color:var(--gold-light);">
                </div>

                <div class="form-group">
                    <label class="form-label">Ø§Ø®ØªÙ„Ø§Ù ØµÙ†Ø¯ÙˆÙ‚</label>
                    <input type="text" id="regDifference" class="lux-input" readonly style="background:rgba(255,255,255,0.05);">
                </div>

                <button class="btn" style="width:100%; background:var(--danger); color:#fff; border:none;" onclick="closeRegister()">
                    <i class="fa-solid fa-lock"></i> Ø¨Ø³ØªÙ† ØµÙ†Ø¯ÙˆÙ‚ Ùˆ Ú†Ø§Ù¾ Ú¯Ø²Ø§Ø±Ø´
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="modalCustomer">
    <div class="lux-modal">
        <div class="modal-header">
            <div class="modal-title"><i class="fa-solid fa-user-plus"></i> Ø«Ø¨Øª Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯</div>
            <button class="close-modal" onclick="closeModal('modalCustomer')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label required">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
                    <input type="text" id="custName" class="lux-input">
                </div>
                <div class="form-group">
                    <label class="form-label required">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
                    <input type="tel" id="custPhone" class="lux-input" style="direction:ltr; text-align:left;">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯ (Ø¬Ù‡Øª ØªØ®ÙÛŒÙ ØªÙˆÙ„Ø¯)</label>
                <input type="date" id="custBirth" class="lux-input">
            </div>

            <div class="form-group">
                <label class="form-label">ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ÛŒ Ø®Ø§Øµ (Ø­Ø³Ø§Ø³ÛŒØªØŒ Ø³Ù„ÛŒÙ‚Ù‡ Ùˆ...)</label>
                <textarea id="custNotes" class="lux-textarea" rows="3"></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="gold-btn" onclick="saveCustomer()">
                <i class="fa-solid fa-save"></i> Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø¨Ø§Ø´Ú¯Ø§Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†
            </button>
        </div>
    </div>
</div>
<div class="modal-overlay" id="modalNewTx">
    <div class="lux-modal">
        <div class="modal-header">
            <div class="modal-title"><i class="fa-solid fa-coins"></i> <span id="modalTxTitle">Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯</span></div>
            <button class="close-modal" onclick="closeModal('modalNewTx')">&times;</button>
        </div>
        
        <div class="modal-body">
            <input type="hidden" id="txType">
            
            <div class="form-group" style="background:rgba(212,175,55,0.05); padding:10px; border-radius:8px; border:1px dashed var(--gold-dark); margin-bottom:15px;">
                <label style="display:flex; align-items:center; gap:10px; cursor:pointer; color:var(--text-main);">
                    <input type="checkbox" id="txTaxApply" style="width:18px; height:18px; accent-color:var(--gold-primary);">
                    <span>Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ú©Ø³Ø± Ù…Ø§Ù„ÛŒØ§Øª (Ø·Ø¨Ù‚ ØªÙ†Ø¸ÛŒÙ…Ø§Øª)</span>
                </label>
                <div id="taxCalcResult" style="font-size:12px; color:var(--gold-light); margin-top:5px; padding-right:28px;"></div>
            </div>

            <div class="form-group">
                <label class="form-label required">Ù…Ø¨Ù„Øº (Ø§ÙØºØ§Ù†ÛŒ)</label>
                <input type="number" id="txAmount" class="lux-input" style="font-size:20px; font-weight:bold; color:var(--gold-light); direction:ltr; text-align:left;" placeholder="0">
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
                    <select id="txCategory" class="lux-select">
                        </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø·Ø±Ù Ø­Ø³Ø§Ø¨ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
                    <select id="txRelatedUser" class="lux-select">
                        <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ --</option>
                        </select>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">ØªÙˆØ¶ÛŒØ­Ø§Øª / Ø¨Ø§Ø¨Øª</label>
                <input type="text" id="txDesc" class="lux-input" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø§Ø¨Øª Ø®Ø¯Ù…Ø§Øª...">
            </div>
        </div>
        <div class="modal-footer">
            <button class="gold-btn" onclick="submitTransaction()">
                <i class="fa-solid fa-check"></i> Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ
            </button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="modalAppointment">
    <div class="lux-modal">
        <div class="modal-header">
            <div class="modal-title"><i class="fa-regular fa-calendar-plus"></i> Ø«Ø¨Øª Ù†ÙˆØ¨Øª Ø±Ø²Ø±Ùˆ</div>
            <button class="close-modal" onclick="closeModal('modalAppointment')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label required">Ù…Ø´ØªØ±ÛŒ</label>
                <div style="display:flex; gap:5px;">
                    <select id="aptCustomer" class="lux-select">
                        <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ --</option>
                        </select>
                    <button class="icon-btn" onclick="openModal('modalCustomer')" title="Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯" style="border-radius:8px; width:45px;"><i class="fa-solid fa-plus"></i></button>
                </div>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label required">ØªØ§Ø±ÛŒØ®</label>
                    <input type="date" id="aptDateInput" class="lux-input">
                </div>
                <div class="form-group">
                    <label class="form-label required">Ø³Ø§Ø¹Øª Ø´Ø±ÙˆØ¹</label>
                    <input type="time" id="aptTimeInput" class="lux-input">
                </div>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label required">Ø®Ø¯Ù…Øª Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ</label>
                    <select id="aptService" class="lux-select">
                        <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø¯Ù…Øª --</option>
                        </select>
                </div>
                <div class="form-group">
                    <label class="form-label required">Ø¢Ø±Ø§ÛŒØ´Ú¯Ø± / Ù¾Ø±Ø³Ù†Ù„</label>
                    <select id="aptStaff" class="lux-select">
                        <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ø±Ø³Ù†Ù„ --</option>
                        </select>
                </div>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label">ÙˆØ¶Ø¹ÛŒØª</label>
                    <select id="aptStatus" class="lux-select">
                        <option value="scheduled">Ø±Ø²Ø±Ùˆ Ø´Ø¯Ù‡</option>
                        <option value="confirmed">ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡</option>
                        <option value="completed">Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯</option>
                        <option value="canceled">Ù„ØºÙˆ Ø´Ø¯</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø¨ÛŒØ¹Ø§Ù†Ù‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
                    <input type="number" id="aptDeposit" class="lux-input" placeholder="0">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</label>
                <textarea id="aptNote" class="lux-textarea" rows="2"></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="gold-btn" onclick="saveAppointment()">
                <i class="fa-solid fa-calendar-check"></i> Ø«Ø¨Øª Ù†ÙˆØ¨Øª
            </button>
        </div>
    </div>
</div>
<div class="modal-overlay" id="modalService">
    <div class="lux-modal">
        <div class="modal-header">
            <div class="modal-title"><i class="fa-solid fa-scissors"></i> ØªØ¹Ø±ÛŒÙ Ø®Ø¯Ù…Øª Ø¬Ø¯ÛŒØ¯</div>
            <button class="close-modal" onclick="closeModal('modalService')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label required">Ù†Ø§Ù… Ø®Ø¯Ù…Øª</label>
                <input type="text" id="srvName" class="lux-input" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ú©ÙˆØªØ§Ù‡ÛŒ Ù…Ùˆ Ú©Ù„Ø§Ø³ÛŒÚ©">
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
                    <select id="srvCat" class="lux-select">
                        <option value="hair">Ù…Ùˆ Ùˆ Ú©ÙˆØªØ§Ù‡ÛŒ</option>
                        <option value="color">Ø±Ù†Ú¯ Ùˆ Ù…Ø´</option>
                        <option value="skin">Ù¾ÙˆØ³Øª Ùˆ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ</option>
                        <option value="makeup">Ù…ÛŒÚ©Ø§Ù¾ Ùˆ Ú¯Ø±ÛŒÙ…</option>
                        <option value="nail">Ù†Ø§Ø®Ù†</option>
                        <option value="other">Ø³Ø§ÛŒØ±</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø²Ù…Ø§Ù† ØªÙ‚Ø±ÛŒØ¨ÛŒ (Ø¯Ù‚ÛŒÙ‚Ù‡)</label>
                    <input type="number" id="srvDuration" class="lux-input" placeholder="30">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label required">Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡ (Ø§ÙØºØ§Ù†ÛŒ)</label>
                <input type="number" id="srvPrice" class="lux-input" style="font-weight:bold; color:var(--gold-light); direction:ltr; text-align:left;">
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label">Ù…Ø´Ù…ÙˆÙ„ Ù…Ø§Ù„ÛŒØ§ØªØŸ</label>
                    <select id="srvTaxable" class="lux-select">
                        <option value="true">Ø¨Ù„Ù‡ (Ø´Ø§Ù…Ù„ Ù…Ø§Ù„ÛŒØ§Øª)</option>
                        <option value="false">Ø®ÛŒØ± (Ù…Ø¹Ø§Ù)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø¢ÛŒÚ©ÙˆÙ† (FontAwesome)</label>
                    <input type="text" id="srvIcon" class="lux-input" placeholder="fa-solid fa-scissors" dir="ltr">
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="gold-btn" onclick="saveService()">
                <i class="fa-solid fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ Ø®Ø¯Ù…Øª
            </button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="modalProduct">
    <div class="lux-modal">
        <div class="modal-header">
            <div class="modal-title"><i class="fa-solid fa-box"></i> Ú©Ø§Ù„Ø§ / Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</div>
            <button class="close-modal" onclick="closeModal('modalProduct')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label required">Ù†Ø§Ù… Ú©Ø§Ù„Ø§</label>
                <input type="text" id="prdName" class="lux-input" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø´Ø§Ù…Ù¾Ùˆ Ú©Ø±Ø§ØªÛŒÙ†">
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label">Ø¨Ø±Ù†Ø¯</label>
                    <input type="text" id="prdBrand" class="lux-input">
                </div>
                <div class="form-group">
                    <label class="form-label required">ØªØ¹Ø¯Ø§Ø¯ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§ÙˆÙ„ÛŒÙ‡</label>
                    <input type="number" id="prdStock" class="lux-input">
                </div>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label">Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯ (AFN)</label>
                    <input type="number" id="prdBuyPrice" class="lux-input" style="direction:ltr; text-align:left;">
                </div>
                <div class="form-group">
                    <label class="form-label required">Ù‚ÛŒÙ…Øª ÙØ±ÙˆØ´ (AFN)</label>
                    <input type="number" id="prdSellPrice" class="lux-input" style="color:var(--gold-light); font-weight:bold; direction:ltr; text-align:left;">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Ù†Ù‚Ø·Ù‡ Ø³ÙØ§Ø±Ø´ (Ù‡Ø´Ø¯Ø§Ø± Ú©Ù…Ø¨ÙˆØ¯)</label>
                <input type="number" id="prdLowStockAlert" class="lux-input" value="5" placeholder="Ù…Ø«Ù„Ø§Ù‹ 5 Ø¹Ø¯Ø¯">
            </div>
        </div>
        <div class="modal-footer">
            <button class="gold-btn" onclick="saveProduct()">
                <i class="fa-solid fa-check"></i> Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø§Ù†Ø¨Ø§Ø±
            </button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="modalStaff">
    <div class="lux-modal">
        <div class="modal-header">
            <div class="modal-title"><i class="fa-solid fa-id-badge"></i> Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù¾Ø±Ø³Ù†Ù„</div>
            <button class="close-modal" onclick="closeModal('modalStaff')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label required">Ù†Ø§Ù… Ù¾Ø±Ø³Ù†Ù„</label>
                <input type="text" id="stfName" class="lux-input">
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label">Ù†Ù‚Ø´ / ØªØ®ØµØµ</label>
                    <input type="text" id="stfRole" class="lux-input" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù‡ÛŒØ± Ø§Ø³ØªØ§ÛŒÙ„ÛŒØ³Øª">
                </div>
                <div class="form-group">
                    <label class="form-label required">Ù…ÙˆØ¨Ø§ÛŒÙ„</label>
                    <input type="tel" id="stfPhone" class="lux-input" dir="ltr">
                </div>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label">Ø­Ù‚ÙˆÙ‚ Ø«Ø§Ø¨Øª (AFN)</label>
                    <input type="number" id="stfBaseSalary" class="lux-input" placeholder="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Ø¯Ø±ØµØ¯ Ú©Ù…ÛŒØ³ÛŒÙˆÙ† (%)</label>
                    <input type="number" id="stfComm" class="lux-input" placeholder="Ù…Ø«Ù„Ø§Ù‹ 30">
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ Ù‡Ù…Ú©Ø§Ø±ÛŒ</label>
                <input type="date" id="stfJoinDate" class="lux-input">
            </div>
        </div>
        <div class="modal-footer">
            <button class="gold-btn" onclick="saveStaff()">
                <i class="fa-solid fa-user-plus"></i> ØªÚ©Ù…ÛŒÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù…
            </button>
        </div>
    </div>
</div>

<div class="toast-container" id="toastArea"></div>

<script>
/* PART 18 OF 20: CORE JAVASCRIPT & DATABASE LOGIC */

// =========================================
// 1. DATABASE STRUCTURE & STATE
// =========================================

let currentLang = 'fa';
let currentCountry = 'AF';
let db = {
    settings: {
        name: 'Royal Salon AF',
        phone: '',
        address: '',
        currency: 'AFN',    // Locked to Afghani
        taxType: 'brt',     // brt (4%) or vat (10%) or none
        taxRate: 4,         // Default BRT rate
        theme: 'dark',
        auth: { user: 'admin', pass: 'admin' }
    },
    services: [],
    customers: [],
    staff: [],
    inventory: [],
    appointments: [],
    transactions: [],
    invoices: [],           // For POS history
    debts: [],             // Debt tracking
    posSession: {           // Cash Register State
        isOpen: false,
        startTime: null,
        startCash: 0,
        salesCash: 0,
        salesCard: 0
    }
};

// === Ø´Ø±ÙˆØ¹ Ú©Ø¯ Ø¬Ø¯ÛŒØ¯: ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú†Ù†Ø¯ Ø²Ø¨Ø§Ù†Ù‡ Ùˆ Ú†Ù†Ø¯ Ú©Ø´ÙˆØ±ÛŒ ===

// 1. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ø´ÙˆØ±Ù‡Ø§ (Ù¾ÙˆÙ„ Ùˆ Ù…Ø§Ù„ÛŒØ§Øª)
const countryConfigs = {
    'AF': { currency: 'Ø‹', currencyCode: 'AFN', taxRate: 4, taxName: 'BRT', dir: 'rtl', font: "'Vazirmatn', sans-serif" }, // Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†
    'IR': { currency: 'ØªÙˆÙ…Ø§Ù†', currencyCode: 'IRT', taxRate: 10, taxName: 'VAT', dir: 'rtl', font: "'Vazirmatn', sans-serif" }, // Ø§ÛŒØ±Ø§Ù†
    'UAE': { currency: 'Ø¯.Ø¥', currencyCode: 'AED', taxRate: 5, taxName: 'VAT', dir: 'rtl', font: "'Vazirmatn', sans-serif" }, // Ø§Ù…Ø§Ø±Ø§Øª (Ø¹Ø±Ø¨ÛŒ)
    'TR': { currency: 'â‚º', currencyCode: 'TRY', taxRate: 20, taxName: 'KDV', dir: 'ltr', font: "sans-serif" }, // ØªØ±Ú©ÛŒÙ‡
    'US': { currency: '$', currencyCode: 'USD', taxRate: 0, taxName: 'Tax', dir: 'ltr', font: "sans-serif" } // Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ
};
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø±Ø§ Ù‚Ø¨Ù„ Ø§Ø² translations Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
function t(key) {
    const lang = currentLang || 'fa';
    if (translations[lang] && translations[lang][key]) {
        return translations[lang][key];
    }
    return key; // Ø§Ú¯Ø± ØªØ±Ø¬Ù…Ù‡ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯ØŒ Ø®ÙˆØ¯ Ú©Ù„ÛŒØ¯ Ø±Ø§ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†
}
// 2. Ø¯ÛŒÚ©Ø´Ù†Ø±ÛŒ Ú©Ù„Ù…Ø§Øª (ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§)
// Ø¯ÛŒÚ©Ø´Ù†Ø±ÛŒ Ú©Ø§Ù…Ù„ Ùˆ Ø¬Ø¯ÛŒØ¯ (Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù‚Ø¨Ù„ÛŒ Ø´ÙˆØ¯)

const translations = {
    'fa': {
        // --- Ø¹Ù…ÙˆÙ…ÛŒ ---
        appTitle: "Ø±ÙˆÛŒØ§Ù„ Ø³Ø§Ù„Ù†",
        appSubtitle: "Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯",
        username: "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ",
        password: "Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±",
        loginBtn: "ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…",
        loading: "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...",
        search: "Ø¬Ø³ØªØ¬Ùˆ...",
        viewAll: "Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡",
        // --- Ù…Ù†Ùˆ ---
        navDashboard: "Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ",
        navPos: "ØµÙ†Ø¯ÙˆÙ‚ Ùˆ ÙØ±ÙˆØ´",
        navAppointments: "Ù†ÙˆØ¨Øªâ€ŒØ¯Ù‡ÛŒ Ùˆ Ø±Ø²Ø±Ùˆ",
        navAccounting: "Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ùˆ Ù…Ø§Ù„ÛŒ",
        navInventory: "Ø§Ù†Ø¨Ø§Ø± Ù…Ø­ØµÙˆÙ„Ø§Øª",
        navPersonnel: "Ù¾Ø±Ø³Ù†Ù„ Ùˆ Ø­Ù‚ÙˆÙ‚",
        navCustomers: "Ø¨Ø§Ø´Ú¯Ø§Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†",
        navServices: "Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø¯Ù…Ø§Øª",
        navSettings: "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…",
        navLogout: "Ø®Ø±ÙˆØ¬",
        // --- Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ---
        dashOverview: "Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ Ø±ÙˆØ²",
        newFactor: "ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´",
        todaySales: "ÙØ±ÙˆØ´ Ø§Ù…Ø±ÙˆØ²",
        todayExpense: "Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²",
        todayApts: "Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²",
        pending: "Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±",
        regStatus: "ÙˆØ¶Ø¹ÛŒØª ØµÙ†Ø¯ÙˆÙ‚",
        regManage: "Ù…Ø¯ÛŒØ±ÛŒØª ØµÙ†Ø¯ÙˆÙ‚",
        chartIncome: "Ù†Ù…ÙˆØ¯Ø§Ø± Ø¯Ø±Ø¢Ù…Ø¯ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡",
        chartServices: "Ø®Ø¯Ù…Ø§Øª Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±",
        recentTx: "Ø¢Ø®Ø±ÛŒÙ† ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§",
        // --- Ø¬Ø¯ÙˆÙ„â€ŒÙ‡Ø§ ---
        tblTime: "Ø²Ù…Ø§Ù†",
        tblDesc: "Ø´Ø±Ø­ ÙØ¹Ø§Ù„ÛŒØª",
        tblAmount: "Ù…Ø¨Ù„Øº",
        tblType: "Ù†ÙˆØ¹",
        tblUser: "Ú©Ø§Ø±Ø¨Ø±",
        tblAction: "Ø¹Ù…Ù„ÛŒØ§Øª",
        // --- ØµÙ†Ø¯ÙˆÙ‚ ÙØ±ÙˆØ´ ---
        posTitle: "ØµÙ†Ø¯ÙˆÙ‚ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ÛŒ",
        posStatus: "ÙˆØ¶Ø¹ÛŒØª ØµÙ†Ø¯ÙˆÙ‚:",
        posSearchPlace: "Ø¬Ø³ØªØ¬ÙˆÛŒ Ø®Ø¯Ù…Øª ÛŒØ§ Ú©Ø§Ù„Ø§...",
        catAll: "Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§",
        catService: "Ø®Ø¯Ù…Ø§Øª",
        catProduct: "Ù…Ø­ØµÙˆÙ„Ø§Øª",
        lblCustomer: "Ù…Ø´ØªØ±ÛŒ:",
        lblGuest: "Ù…Ø´ØªØ±ÛŒ Ù…Ù‡Ù…Ø§Ù†",
        cartEmpty: "Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª",
        lblSubtotal: "Ø¬Ù…Ø¹ Ø¬Ø²Ø¡:",
        lblTax: "Ù…Ø§Ù„ÛŒØ§Øª:",
        lblTotal: "Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª:",
        lblCash: "Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù‚Ø¯ÛŒ",
        lblCard: "Ú©Ø§Ø±ØªØ®ÙˆØ§Ù†",
        btnCancel: "Ù„ØºÙˆ",
        btnSubmit: "Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ"
    },
    'en': {
        // --- General ---
        appTitle: "Royal Salon",
        appSubtitle: "Smart Management System",
        username: "Username",
        password: "Password",
        loginBtn: "Login",
        loading: "Loading...",
        search: "Search...",
        viewAll: "View All",
        // --- Menu ---
        navDashboard: "Dashboard",
        navPos: "POS & Sales",
        navAppointments: "Appointments",
        navAccounting: "Accounting",
        navInventory: "Inventory",
        navPersonnel: "Staff & HR",
        navCustomers: "Customers",
        navServices: "Services",
        navSettings: "Settings",
        navLogout: "Logout",
        // --- Dashboard ---
        dashOverview: "Daily Overview",
        newFactor: "New Sale",
        todaySales: "Today's Sales",
        todayExpense: "Today's Expenses",
        todayApts: "Today's Appointments",
        pending: "Pending",
        regStatus: "Register Status",
        regManage: "Manage Register",
        chartIncome: "Income & Expense Chart",
        chartServices: "Popular Services",
        recentTx: "Recent Activities",
        // --- Tables ---
        tblTime: "Time",
        tblDesc: "Description",
        tblAmount: "Amount",
        tblType: "Type",
        tblUser: "User",
        tblAction: "Action",
        // --- POS ---
        posTitle: "Point of Sale",
        posStatus: "Register Status:",
        posSearchPlace: "Search service or product...",
        catAll: "All Categories",
        catService: "Services",
        catProduct: "Products",
        lblCustomer: "Customer:",
        lblGuest: "Guest Customer",
        cartEmpty: "Cart is empty",
        lblSubtotal: "Subtotal:",
        lblTax: "Tax:",
        lblTotal: "Total Payable:",
        lblCash: "Cash Payment",
        lblCard: "Card Payment",
        btnCancel: "Cancel",
        btnSubmit: "Checkout"
    },
    'tr': {
        // --- Genel ---
        appTitle: "Royal Salon",
        appSubtitle: "AkÄ±llÄ± YÃ¶netim Sistemi",
        username: "KullanÄ±cÄ± AdÄ±",
        password: "Åifre",
        loginBtn: "GiriÅŸ Yap",
        loading: "YÃ¼kleniyor...",
        search: "Ara...",
        viewAll: "Hepsini GÃ¶r",
        // --- MenÃ¼ ---
        navDashboard: "GÃ¶sterge Paneli",
        navPos: "Kasa ve SatÄ±ÅŸ",
        navAppointments: "Randevular",
        navAccounting: "Muhasebe",
        navInventory: "Stok YÃ¶netimi",
        navPersonnel: "Personel",
        navCustomers: "MÃ¼ÅŸteriler",
        navServices: "Hizmetler",
        navSettings: "Ayarlar",
        navLogout: "Ã‡Ä±kÄ±ÅŸ Yap",
        // --- Dashboard ---
        dashOverview: "GÃ¼nlÃ¼k Genel BakÄ±ÅŸ",
        newFactor: "Yeni SatÄ±ÅŸ",
        todaySales: "BugÃ¼nkÃ¼ SatÄ±ÅŸlar",
        todayExpense: "BugÃ¼nkÃ¼ Giderler",
        todayApts: "BugÃ¼nkÃ¼ Randevular",
        pending: "Bekleyen",
        regStatus: "Kasa Durumu",
        regManage: "KasayÄ± YÃ¶net",
        chartIncome: "Gelir ve Gider Tablosu",
        chartServices: "PopÃ¼ler Hizmetler",
        recentTx: "Son Aktiviteler",
        // --- Tablolar ---
        tblTime: "Zaman",
        tblDesc: "AÃ§Ä±klama",
        tblAmount: "Tutar",
        tblType: "TÃ¼r",
        tblUser: "KullanÄ±cÄ±",
        tblAction: "Ä°ÅŸlem",
        // --- POS ---
        posTitle: "SatÄ±ÅŸ NoktasÄ± (POS)",
        posStatus: "Kasa Durumu:",
        posSearchPlace: "Hizmet veya Ã¼rÃ¼n ara...",
        catAll: "TÃ¼m Kategoriler",
        catService: "Hizmetler",
        catProduct: "ÃœrÃ¼nler",
        lblCustomer: "MÃ¼ÅŸteri:",
        lblGuest: "Misafir MÃ¼ÅŸteri",
        cartEmpty: "Sepet boÅŸ",
        lblSubtotal: "Ara Toplam:",
        lblTax: "Vergi:",
        lblTotal: "Ã–denecek Tutar:",
        lblCash: "Nakit Ã–deme",
        lblCard: "Kart Ã–demesi",
        btnCancel: "Ä°ptal",
        btnSubmit: "Ã–demeyi Tamamla"
    },
    'ar': {
        // --- Ø¹Ø§Ù… ---
        appTitle: "Ø±ÙˆÙŠØ§Ù„ ØµØ§Ù„ÙˆÙ†",
        appSubtitle: "Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°ÙƒÙŠ",
        username: "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
        password: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
        loginBtn: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",
        loading: "Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...",
        search: "Ø¨Ø­Ø«...",
        viewAll: "Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„",
        // --- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ---
        navDashboard: "Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©",
        navPos: "Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹",
        navAppointments: "Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",
        navAccounting: "Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©",
        navInventory: "Ø§Ù„Ù…Ø®Ø²ÙˆÙ†",
        navPersonnel: "Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†",
        navCustomers: "Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",
        navServices: "Ø§Ù„Ø®Ø¯Ù…Ø§Øª",
        navSettings: "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
        navLogout: "Ø®Ø±ÙˆØ¬",
        // --- Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ---
        dashOverview: "Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© ÙŠÙˆÙ…ÙŠØ©",
        newFactor: "Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯",
        todaySales: "Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…",
        todayExpense: "Ù†ÙÙ‚Ø§Øª Ø§Ù„ÙŠÙˆÙ…",
        todayApts: "Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…",
        pending: "Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",
        regStatus: "Ø­Ø§Ù„Ø© Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚",
        regManage: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚",
        chartIncome: "Ù…Ø®Ø·Ø· Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…ØµØ±ÙˆÙØ§Øª",
        chartServices: "Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©",
        recentTx: "Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©",
        // --- Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ---
        tblTime: "Ø§Ù„ÙˆÙ‚Øª",
        tblDesc: "Ø§Ù„ÙˆØµÙ",
        tblAmount: "Ø§Ù„Ù…Ø¨Ù„Øº",
        tblType: "Ø§Ù„Ù†ÙˆØ¹",
        tblUser: "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
        tblAction: "Ø¥Ø¬Ø±Ø§Ø¡",
        // --- POS ---
        posTitle: "Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹",
        posStatus: "Ø­Ø§Ù„Ø© Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚:",
        posSearchPlace: "Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø®Ø¯Ù…Ø© Ø£Ùˆ Ù…Ù†ØªØ¬...",
        catAll: "Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª",
        catService: "Ø®Ø¯Ù…Ø§Øª",
        catProduct: "Ù…Ù†ØªØ¬Ø§Øª",
        lblCustomer: "Ø§Ù„Ø¹Ù…ÙŠÙ„:",
        lblGuest: "Ø¹Ù…ÙŠÙ„ Ø²Ø§Ø¦Ø±",
        cartEmpty: "Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚ ÙØ§Ø±ØºØ©",
        lblSubtotal: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:",
        lblTax: "Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:",
        lblTotal: "Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚:",
        lblCash: "Ø¯ÙØ¹ Ù†Ù‚Ø¯ÙŠ",
        lblCard: "Ø¯ÙØ¹ Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©",
        btnCancel: "Ø¥Ù„ØºØ§Ø¡",
        btnSubmit: "Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹"
    }
};




function changeSystemConfig(lang, country) {
    // 1. Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ
    if (typeof currentLang !== 'undefined') currentLang = lang;
    if (typeof currentCountry !== 'undefined') currentCountry = country;

    // 2. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ø´ÙˆØ± (Ø¬Ù‡Øª Ùˆ ÙÙˆÙ†Øª)
    if (typeof countryConfigs !== 'undefined') {
        var config = countryConfigs[country] || countryConfigs['AF'];
        document.documentElement.setAttribute('dir', config.dir);
        document.documentElement.setAttribute('lang', lang);
        document.body.style.fontFamily = config.font;
    }

    // 3. ØªØ±Ø¬Ù…Ù‡ Ù…ØªÙ†â€ŒÙ‡Ø§ÛŒ ØµÙØ­Ù‡
    if (typeof translations !== 'undefined') {
        var tr = translations[lang];
        if (tr) {
            var elements = document.querySelectorAll('[data-i18n]');
            for (var i = 0; i < elements.length; i++) {
                var element = elements[i];
                var key = element.getAttribute('data-i18n');
                if (tr[key]) {
                    if (element.tagName === 'INPUT' && element.getAttribute('placeholder')) {
                        element.placeholder = tr[key];
                    } else {
                        // Ø­ÙØ¸ Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§
                        if (element.children.length > 0 && element.innerHTML.indexOf('<i') > -1) {
                            var iconMatch = element.innerHTML.match(/<i.*><\/i>/);
                            if (iconMatch) {
                                element.innerHTML = iconMatch[0] + " " + tr[key];
                            } else {
                                element.innerText = tr[key];
                            }
                        } else {
                            element.innerText = tr[key];
                        }
                    }
                }
            }
        }
    }

    // 4. Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
    if (typeof db !== 'undefined' && db.settings) {
        db.settings.language = lang;
        db.settings.country = country;
        if (typeof saveData === 'function') saveData();
    }

    // 5. Ø±ÙØ±Ø´ Ú©Ø±Ø¯Ù† ØµÙØ­Ø§Øª ÙØ¹Ø§Ù„ (Ø¨Ø±Ø§ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ø²Ø¨Ø§Ù† Ø¬Ø¯ÛŒØ¯)
    if (typeof updateDateDisplay === 'function') updateDateDisplay();

    // Ø±ÙØ±Ø´ Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø§Ú¯Ø± ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ù†Ø¯
    if (document.getElementById('dashboard') && document.getElementById('dashboard').classList.contains('active') && typeof renderDashboard === 'function') renderDashboard();
    if (document.getElementById('pos') && document.getElementById('pos').classList.contains('active') && typeof initPos === 'function') initPos();
    if (document.getElementById('accounting') && document.getElementById('accounting').classList.contains('active') && typeof renderAccounting === 'function') renderAccounting();
    if (document.getElementById('inventory') && document.getElementById('inventory').classList.contains('active') && typeof renderInventory === 'function') renderInventory();
    if (document.getElementById('debts') && document.getElementById('debts').classList.contains('active') && typeof renderDebts === 'function') renderDebts();
    if (document.getElementById('appointments') && document.getElementById('appointments').classList.contains('active') && typeof renderAppointments === 'function') renderAppointments();
    if (document.getElementById('customers') && document.getElementById('customers').classList.contains('active') && typeof renderCustomers === 'function') renderCustomers();
    if (document.getElementById('services') && document.getElementById('services').classList.contains('active') && typeof renderServices === 'function') renderServices();
    if (document.getElementById('personnel') && document.getElementById('personnel').classList.contains('active') && typeof renderPersonnel === 'function') renderPersonnel();

    // Ø¢Ù¾Ø¯ÛŒØª Ù†Ø§Ù… Ø¯Ø± Ø³Ø§ÛŒØ¯Ø¨Ø§Ø±
    var sidebarName = document.getElementById('sidebarUserName');
    if (sidebarName && typeof db !== 'undefined' && db.settings) {
        sidebarName.innerText = db.settings.name;
    }
}
// ØªØ§Ø¨Ø¹ Ø§ÛŒÙ…Ù†â€ŒØ³Ø§Ø²ÛŒ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ (Sanitization)
function escapeHTML(str) {
    if (!str) return '';
    return str.toString()
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}
// Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† ØªØ§Ø¨Ø¹ Ù‚Ø¯ÛŒÙ…ÛŒ (Ø§ÛŒÙ† Ø®Ø· ØªØ§Ø¨Ø¹ Ù‚Ø¨Ù„ÛŒ Ø±Ø§ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯)
function formatMoney(amount) { return Money.format(amount); }
// ================================
// Current Shopping Cart State (Not saved in DB permanently)
let posCart = [];
let currentCartCustomer = null;

const STORAGE_KEY = 'RoyalSalonAF_DB_V2';

// =========================================
// 2. INITIALIZATION & STORAGE
// =========================================
function initApp() {
    loadData();
    
    // UI Initializations
    updateDateDisplay();
    loadSettingsToInputs();
    
    // Check Theme
    if (db.settings.theme === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
        const icon = document.getElementById('themeIconBtn');
        if(icon) icon.className = 'fa-solid fa-sun';
    }

    // Sidebar Name
    if(document.getElementById('sidebarUserName')) {
        document.getElementById('sidebarUserName').innerText = db.settings.name;
    }

    // Render Dashboard initially
    if(document.getElementById('dashboard').classList.contains('active')) {
        renderDashboard();
    }
    
    // Hide Loading Overlay
    setTimeout(() => {
        const loader = document.getElementById('loadingOverlay');
        if(loader) loader.style.opacity = '0';
        setTimeout(() => { if(loader) loader.style.display = 'none'; }, 500);
    }, 800);
}

function loadData() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
        try {
            const parsed = JSON.parse(saved);
            // Merge with default structure to prevent errors on updates
            db = { ...db, ...parsed };
            // Ensure settings exist
            if(!db.settings) db.settings = { currency: 'AFN', taxRate: 4 };
        } catch(e) {
            console.error("Data Load Error:", e);
            seedDummyData(); // Fallback
        }
    } else {
        seedDummyData();
    }
}

function saveData() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
    // Trigger updates if needed (e.g. charts)
    if(document.getElementById('dashboard').classList.contains('active')) updateCharts();
}

function seedDummyData() {
    console.log("Seeding Dummy Data for Afghanistan Context...");
    
    // Services
    db.services = [
        { id: 1, name: 'Ø§ØµÙ„Ø§Ø­ Ù…Ùˆ (Ú©Ù„Ø§Ø³ÛŒÚ©)', category: 'hair', price: 200, duration: 30, icon: 'fa-solid fa-scissors', taxable: 'true' },
        { id: 2, name: 'ÙÛŒØ´Ø§Ù„ ØµÙˆØ±Øª VIP', category: 'skin', price: 800, duration: 60, icon: 'fa-solid fa-spa', taxable: 'true' },
        { id: 3, name: 'Ú©Ø±Ø§ØªÛŒÙ†Ù‡ Ù…Ùˆ', category: 'hair', price: 3500, duration: 120, icon: 'fa-solid fa-wand-magic-sparkles', taxable: 'true' },
        { id: 4, name: 'Ú¯Ø±ÛŒÙ… Ø¯Ø§Ù…Ø§Ø¯', category: 'makeup', price: 5000, duration: 90, icon: 'fa-solid fa-user-tie', taxable: 'true' }
    ];

    // Staff
    db.staff = [
        { id: 101, name: 'Ø§Ø­Ù…Ø¯ Ø±Ø§Ø´Ø¯ÛŒ', role: 'Ø§Ø³ØªØ§ÛŒÙ„ÛŒØ³Øª Ø§Ø±Ø´Ø¯', phone: '0799123456', baseSalary: 15000, comm: 40, joinDate: '2023-01-01' },
        { id: 102, name: 'Ø³Ù‡Ø±Ø§Ø¨ Ø§Ø­Ù…Ø¯ÛŒ', role: 'Ø¯Ø³ØªÛŒØ§Ø±', phone: '0788123456', baseSalary: 8000, comm: 10, joinDate: '2023-05-15' }
    ];

    // Customers
    db.customers = [
        { id: 'c1', name: 'Ø¬Ù…Ø´ÛŒØ¯ Ø®Ø§Ù†', phone: '0700987654', joinDate: Date.now(), notes: 'Ù…Ø´ØªØ±ÛŒ VIP' },
        { id: 'c2', name: 'ÙØ±Ù‡Ø§Ø¯ Ù†ÙˆØ±ÛŒ', phone: '0777123123', joinDate: Date.now(), notes: '' }
    ];

    // Inventory
    db.inventory = [
        { id: 501, name: 'Ú˜Ù„ Ù…Ùˆ Ù†ÛŒÙˆØ¢', brand: 'Nivea', stock: 12, buyPrice: 150, sellPrice: 250, lowStockAlert: 5 },
        { id: 502, name: 'ÙˆØ§Ú©Ø³ Ù…Ùˆ Ú¯Ø§Øªâ€ŒØªÙˆâ€ŒØ¨ÛŒ', brand: 'Got2b', stock: 4, buyPrice: 300, sellPrice: 500, lowStockAlert: 5 }
    ];

    saveData();
}

// =========================================
// 3. HELPER FUNCTIONS
// =========================================
// âœ… Ú©Ø¯ Ø¬Ø¯ÛŒØ¯ Ùˆ Ø¯Ø±Ø³Øª (Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø´ÙˆØ¯) âœ…
function formatMoney(amount) {
    if (amount === undefined || amount === null) amount = 0;
    
    // 1. Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ø´ÙˆØ± ÙØ¹Ù„ÛŒ (Ø§Ú¯Ø± Ù…ØªØºÛŒØ± currentCountry ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø¨ÙˆØ¯ØŒ AF Ø±Ø§ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ú¯ÛŒØ±)
    // Ù†Ú©ØªÙ‡: Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ù…ØªØºÛŒØ± currentCountry Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ ÙØ§ÛŒÙ„ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
    const safeCountry = (typeof currentCountry !== 'undefined') ? currentCountry : 'AF';
    const config = countryConfigs[safeCountry] || countryConfigs['AF'];
    
    // 2. ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ø¹Ø¯Ø¯ (Ø³Ù‡ Ø±Ù‚Ù… Ø³Ù‡ Ø±Ù‚Ù…)
    const formattedNumber = new Intl.NumberFormat('en-US').format(Math.round(amount));
    
    // 3. Ú†Ø³Ø¨Ø§Ù†Ø¯Ù† Ù†Ù…Ø§Ø¯ Ù¾ÙˆÙ„ Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ø¬Ù‡Øª Ø²Ø¨Ø§Ù†
    if (config.dir === 'rtl') {
        return formattedNumber + ' ' + config.currency; // Ù…Ø«Ù„Ø§: 1,000 Ø‹
    } else {
        return config.currency + formattedNumber; // Ù…Ø«Ù„Ø§: $1,000
    }
}
function generateId() {
    return Date.now().toString(36) + Math.random().toString(36).substring(2, 6);
}

// Date Helpers (Simple Jalali Mock)
function getTodayJalali() {
    // In a real production app, use 'jalaali-js' library.
    // For this single-file demo, we use native Intl with 'fa-AF' locale but force Gregorian numbers for logic
    // Or simply return a string for display.
    const d = new Date();
    return d.toLocaleDateString('fa-IR'); 
}

function updateDateDisplay() {
    const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
    document.getElementById('currentDateDisplay').innerText = new Date().toLocaleDateString('fa-IR', options);
}

// Toast Notification
function showToast(message, type = 'info') {
    const container = document.getElementById('toastArea');
    const toast = document.createElement('div');
    toast.className = `lux-toast ${type}`;
    
    let icon = 'fa-info-circle';
    if(type === 'success') icon = 'fa-check-circle';
    if(type === 'error') icon = 'fa-circle-xmark';
    
    toast.innerHTML = `
        <i class="fa-solid ${icon}" style="font-size:20px;"></i>
        <div style="flex:1;">
            <div style="font-weight:bold; font-size:13px;">${message}</div>
        </div>
        <button onclick="this.parentElement.remove()" style="background:none; border:none; color:inherit; cursor:pointer;">&times;</button>
    `;
    
    container.appendChild(toast);
    
    // Auto remove
    setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 400);
    }, 4000);
}

// Navigation Logic
function navigateTo(pageId, btnEl) {
    // Hide all pages
    document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
    
    // Show target page
    const target = document.getElementById(pageId);
    if(target) target.classList.add('active');
    
    // Update Sidebar
    if (btnEl) {
        document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
        // If clicked from submenu, activate parent
        if(btnEl.classList.contains('submenu-item')) {
            // Logic to highlight parent can be added here
        } else {
            btnEl.classList.add('active');
        }
    }

    // Update Header Title
    const titleMap = {
        'dashboard': 'Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ',
        'pos': 'ØµÙ†Ø¯ÙˆÙ‚ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ÛŒ (POS)',
        'accounting': 'Ø§Ù…ÙˆØ± Ù…Ø§Ù„ÛŒ Ùˆ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ',
        'taxes': 'Ù…Ø±Ú©Ø² Ù…Ø§Ù„ÛŒØ§ØªÛŒ (BRT)',
        'debts': 'Ø¯ÙØªØ± Ø¨Ø¯Ù‡Ú©Ø§Ø±Ø§Ù†',
        'inventory': 'Ø§Ù†Ø¨Ø§Ø± Ùˆ Ù…Ø­ØµÙˆÙ„Ø§Øª',
        'personnel': 'Ù¾Ø±Ø³Ù†Ù„ Ùˆ Ø­Ù‚ÙˆÙ‚',
        'customers': 'Ø¨Ø§Ø´Ú¯Ø§Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†',
        'services': 'Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø¯Ù…Ø§Øª',
        'settings': 'ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…'
    };
    document.getElementById('headerTitle').innerText = titleMap[pageId] || 'Royal Salon AF';

    // Refresh Data for that page
    if (pageId === 'dashboard') renderDashboard();
    if (pageId === 'pos') initPos();
    if (pageId === 'accounting') renderAccounting();
    if (pageId === 'inventory') renderInventory();
    if (pageId === 'customers') renderCustomers();
    if (pageId === 'services') renderServices();
    if (pageId === 'personnel') renderPersonnel();
    if (pageId === 'debts') renderDebts();
    if (pageId === 'appointments') renderAppointments();
    
    // Close sidebar on mobile
    if(window.innerWidth < 900) {
        document.getElementById('sidebar').classList.remove('open');
    }
}
/* PART 19 OF 20: POS LOGIC & CHECKOUT SYSTEM */

// =========================================
// 4. POS (POINT OF SALE) LOGIC
// =========================================

function initPos() {
    // Check if register is open
    const statusEl = document.getElementById('posRegisterStatus');
    const container = document.getElementById('pos');
    
    if (!db.posSession.isOpen) {
        if(statusEl) {
            statusEl.innerText = "Ø¨Ø³ØªÙ‡";
            statusEl.style.color = "var(--danger)";
        }
        // Block interaction if closed
        // (In a real app, we might show a blocker overlay here)
    } else {
        if(statusEl) {
            statusEl.innerText = "Ø¨Ø§Ø²";
            statusEl.style.color = "var(--success)";
        }
    }
    
    renderPosItems();
    populatePosCustomers();
    renderCart();
}

function renderPosItems() {
    const grid = document.getElementById('posItemsGrid');
    const search = document.getElementById('posSearch').value.toLowerCase();
    const filter = document.getElementById('posCatFilter').value;
    
    grid.innerHTML = '';
    
    let items = [];
    if (filter === 'all' || filter === 'service') db.services.forEach(s => items.push({ ...s, type: 'service' }));
    if (filter === 'all' || filter === 'product') db.inventory.forEach(p => items.push({ ...p, type: 'product', price: p.sellPrice }));
    
    items = items.filter(i => i.name.toLowerCase().includes(search));
    
    if (items.length === 0) {
        grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:30px; color:rgba(255,255,255,0.5);">Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</div>';
        return;
    }

    items.forEach(item => {
        const isProduct = item.type === 'product';
        let stockLabel = '';
        let disabledClass = '';
        
        if (isProduct) {
            if (item.stock <= 0) {
                stockLabel = '<span style="font-size:10px; color:var(--danger)">(Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯)</span>';
                disabledClass = 'opacity:0.6; cursor:not-allowed;';
            } else {
                stockLabel = `<span style="font-size:10px; color:var(--text-muted)">(${item.stock} Ù…ÙˆØ¬ÙˆØ¯)</span>`;
            }
        }

        const card = document.createElement('div');
        card.className = 'glass-panel';
        card.style = `padding:15px; cursor:pointer; transition:0.2s; position:relative; overflow:hidden; border:1px solid rgba(212,175,55,0.1); ${disabledClass}`;
        card.onclick = () => { if(!isProduct || item.stock > 0) addToCart(item); };
        
        // Ù†Ø§Ù… Ú©Ø§Ù„Ø§ Ø§ÛŒÙ…Ù† Ø´Ø¯
        card.innerHTML = `
            <div style="font-size:24px; color:var(--gold-dark); margin-bottom:10px; text-align:center;">
                <i class="${item.icon || (isProduct ? 'fa-solid fa-box' : 'fa-solid fa-scissors')}"></i>
            </div>
            <div style="font-weight:bold; font-size:13px; margin-bottom:5px; text-align:center;">${escapeHTML(item.name)}</div>
            <div style="font-size:14px; color:var(--gold-light); text-align:center; direction:ltr;">${formatMoney(item.price)}</div>
            <div style="text-align:center; margin-top:5px;">${stockLabel}</div>
        `;
        
        grid.appendChild(card);
    });
}

function addToCart(item) {
    if (!db.posSession.isOpen) {
        showToast('Ø§Ø¨ØªØ¯Ø§ ØµÙ†Ø¯ÙˆÙ‚ Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯!', 'error');
        return;
    }

    // Check existing in cart
    const existing = posCart.find(x => x.id === item.id && x.type === item.type);
    
    if (existing) {
        // Stock Check for Products
        if (item.type === 'product' && existing.qty >= item.stock) {
            showToast('Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ù†Ø¨Ø§Ø± Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª', 'error');
            return;
        }
        existing.qty++;
    } else {
        posCart.push({
            id: item.id,
            name: item.name,
            type: item.type,
            price: item.price, // Store snapshot of price
            qty: 1,
            taxable: item.taxable === 'true' || item.type === 'product', // Products usually taxable
            maxStock: item.type === 'product' ? item.stock : 999
        });
    }
    
    renderCart();
}

function removeFromCart(index) {
    posCart.splice(index, 1);
    renderCart();
}

function updateCartQty(index, change) {
    const item = posCart[index];
    const newQty = item.qty + change;
    
    if (newQty <= 0) {
        removeFromCart(index);
        return;
    }
    
    if (item.type === 'product' && newQty > item.maxStock) {
        showToast('Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª', 'error');
        return;
    }
    
    item.qty = newQty;
    renderCart();
}

function clearCart() {
    if(confirm('Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø´ÙˆØ¯ØŸ')) {
        posCart = [];
        renderCart();
    }
}
function renderCart() {
    const container = document.getElementById('posCartItems');
    container.innerHTML = '';
    
    if (posCart.length === 0) {
        container.innerHTML = `
            <div style="text-align:center; margin-top:50px; color:var(--text-muted); opacity:0.5;">
                <i class="fa-solid fa-basket-shopping" style="font-size:40px; margin-bottom:10px;"></i>
                <div>Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª</div>
            </div>`;
    }

    posCart.forEach((item, index) => {
        const div = document.createElement('div');
        div.style = 'background:rgba(255,255,255,0.05); padding:10px; margin-bottom:8px; border-radius:8px; display:flex; justify-content:space-between; align-items:center;';
        
        // Ù†Ø§Ù… Ú©Ø§Ù„Ø§ Ø¯Ø± Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø§ÛŒÙ…Ù† Ø´Ø¯
        div.innerHTML = `
            <div style="flex:1;">
                <div style="font-weight:bold; font-size:13px;">${escapeHTML(item.name)}</div>
                <div style="font-size:11px; color:var(--text-muted);">
                    ${formatMoney(item.price)} Ã— ${item.qty}
                </div>
            </div>
            <div style="display:flex; align-items:center; gap:5px;">
                <button class="btn-sm" onclick="updateCartQty(${index}, -1)" style="width:25px; height:25px; padding:0;">-</button>
                <span style="font-weight:bold; width:20px; text-align:center;">${item.qty}</span>
                <button class="btn-sm" onclick="updateCartQty(${index}, 1)" style="width:25px; height:25px; padding:0;">+</button>
            </div>
            <div style="font-weight:bold; color:var(--gold-light); margin-right:10px; direction:ltr;">
                ${formatMoney(item.price * item.qty)}
            </div>
        `;
        container.appendChild(div);
    });

    updateCartTotals();
}
function autoCalcCard() {
    const total = parseFloat(document.getElementById('posTotal').getAttribute('data-raw')) || 0;
    const cash = parseFloat(document.getElementById('payCashInput').value) || 0;
    const card = total - cash;
    document.getElementById('payCardInput').value = card > 0 ? card : 0;
}

function updateCartTotals() {
    let subtotal = 0;
    let totalTax = 0;
    const taxType = db.settings.taxType || 'brt';
    const taxRate = db.settings.taxRate || 0;

    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¬Ù…Ø¹ Ú©Ù„ Ùˆ Ù…Ø§Ù„ÛŒØ§Øª
    posCart.forEach(item => {
        const lineTotal = item.price * item.qty;
        subtotal += lineTotal;
        if (taxType !== 'none' && item.taxable) {
            totalTax += lineTotal * (taxRate / 100);
        }
    });

    // Ú¯Ø±Ø¯ Ú©Ø±Ø¯Ù† Ø§Ø¹Ø¯Ø§Ø¯
    subtotal = Math.round(subtotal);
    totalTax = Math.round(totalTax);
    const finalTotal = subtotal + totalTax;

    // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± ØµÙØ­Ù‡ (Ø¨Ø§ Ú†Ú© Ú©Ø±Ø¯Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù†Øªâ€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø®Ø·Ø§)
    const subtotalEl = document.getElementById('posSubtotal');
    if(subtotalEl) subtotalEl.innerText = formatMoney(subtotal);

    const taxEl = document.getElementById('posTax');
    if(taxEl) taxEl.innerText = formatMoney(totalTax);
    
    // Ø§Ú¯Ø± Ø§Ù„Ù…Ù†Øª ØªØ®ÙÛŒÙ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªØŒ Ú©Ø¯ Ù…ØªÙˆÙ‚Ù Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯
    const discountEl = document.getElementById('posDiscount');
    if(discountEl) discountEl.innerText = formatMoney(0);
    
    // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª
    const totalEl = document.getElementById('posTotal');
    if(totalEl) {
        totalEl.innerText = formatMoney(finalTotal);
        totalEl.setAttribute('data-raw', finalTotal);
    }

    // Ù¾Ø± Ú©Ø±Ø¯Ù† Ø®ÙˆØ¯Ú©Ø§Ø± ÙÛŒÙ„Ø¯ Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù‚Ø¯ÛŒ
    const cashInput = document.getElementById('payCashInput');
    const cardInput = document.getElementById('payCardInput');
    if(cashInput) cashInput.value = finalTotal;
    if(cardInput) cardInput.value = 0;
}

// === Ø´Ø±ÙˆØ¹ Ú©Ø¯ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† (ØªØ§Ø¨Ø¹ Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù‡Ø§ÛŒÛŒ) ===
function processCheckout() {
    // 1. Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø§Ø² Ø¨ÙˆØ¯Ù† ØµÙ†Ø¯ÙˆÙ‚ Ùˆ Ù¾Ø± Ø¨ÙˆØ¯Ù† Ø³Ø¨Ø¯
    if (!db.posSession.isOpen) return showToast('ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ø³ØªÙ‡ Ø§Ø³Øª!', 'error');
    if (posCart.length === 0) return showToast('Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª', 'error');

    // 2. Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ù‚ÛŒÙ‚ Ù…Ø¨Ù„Øº Ø§Ø² Ø±ÙˆÛŒ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø³Ø¨Ø¯ (Ø§Ù…Ù†â€ŒØªØ±ÛŒÙ† Ø±ÙˆØ´)
    let calcSubtotal = 0;
    let calcTax = 0;
    const taxRate = db.settings.taxRate || 0;
    const taxType = db.settings.taxType || 'none';

    posCart.forEach(item => {
        const lineTotal = item.price * item.qty;
        calcSubtotal += lineTotal;
        
        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø§Ù„ÛŒØ§Øª Ø§Ú¯Ø± Ø¢ÛŒØªÙ… Ù…Ø´Ù…ÙˆÙ„ Ø¨Ø§Ø´Ø¯
        if (taxType !== 'none' && item.taxable) {
            calcTax += lineTotal * (taxRate / 100);
        }
    });

    // Ú¯Ø±Ø¯ Ú©Ø±Ø¯Ù† Ù…Ø¨Ø§Ù„Øº Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ø§Ø¹Ø´Ø§Ø± Ø·ÙˆÙ„Ø§Ù†ÛŒ
    calcSubtotal = Math.round(calcSubtotal);
    calcTax = Math.round(calcTax);
    const finalTotal = calcSubtotal + calcTax;

    // 3. Ø¯Ø±ÛŒØ§ÙØª Ù…Ø¨Ø§Ù„Øº Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ ÙˆØ±ÙˆØ¯ÛŒ
    const cashPay = parseFloat(document.getElementById('payCashInput').value) || 0;
    const cardPay = parseFloat(document.getElementById('payCardInput').value) || 0;

    // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø®ØªÙ„Ø§Ù Ø­Ø³Ø§Ø¨ (Ø¨Ø§ ØªØ®ÙÛŒÙ Ø®Ø·Ø§ÛŒ 5 Ø§ÙØºØ§Ù†ÛŒ)
    if (Math.abs((cashPay + cardPay) - finalTotal) > 5) { 
        return showToast('Ù…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ (Ù†Ù‚Ø¯ + Ú©Ø§Ø±Øª) Ø¨Ø§ Ù…Ø¨Ù„Øº Ú©Ù„ Ø¨Ø±Ø§Ø¨Ø± Ù†ÛŒØ³Øª', 'error');
    }

    const customerId = document.getElementById('posCustomer').value;
    const customerName = document.getElementById('posCustomer').selectedOptions[0].text;

    // 4. Ø³Ø§Ø®Øª ÙØ§Ú©ØªÙˆØ± Ù†Ù‡Ø§ÛŒÛŒ
    const invoice = {
        id: generateId(),
        no: 'INV-' + Date.now().toString().slice(-6),
        date: Date.now(),
        customer: customerName,
        customerId: customerId,
        items: [...posCart],
        // Ù…Ù‚Ø§Ø¯ÛŒØ± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ…:
        total: finalTotal,      
        subtotal: calcSubtotal,
        tax: calcTax,
        payCash: cashPay,
        payCard: cardPay,
        user: db.settings.auth.user
    };

    // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
    if(!db.invoices) db.invoices = [];
    db.invoices.push(invoice);

    // Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´ Ù…Ø§Ù„ÛŒ
    if(cashPay > 0) {
        db.transactions.push({
            id: generateId(), date: Date.now(), type: 'income',
            category: 'ÙØ±ÙˆØ´ (POS) - Ù†Ù‚Ø¯', desc: `ÙØ§Ú©ØªÙˆØ± ${invoice.no}`,
            amount: cashPay, user: db.settings.auth.user
        });
        db.posSession.salesCash += cashPay;
    }
    
    if(cardPay > 0) {
        db.transactions.push({
            id: generateId(), date: Date.now(), type: 'income',
            category: 'ÙØ±ÙˆØ´ (POS) - Ú©Ø§Ø±Øª', desc: `ÙØ§Ú©ØªÙˆØ± ${invoice.no}`,
            amount: cardPay, user: db.settings.auth.user
        });
        db.posSession.salesCard += cardPay;
    }

    // Ú©Ø³Ø± Ø§Ø² Ø§Ù†Ø¨Ø§Ø±
    posCart.forEach(item => {
        if (item.type === 'product') {
            const product = db.inventory.find(p => p.id === item.id);
            if (product) product.stock -= item.qty;
        }
    });

    // 5. Ú†Ø§Ù¾ ÙØ§Ú©ØªÙˆØ±
    // Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ Ú†Ø§Ù¾ Ù…ÛŒâ€ŒØ±ÙˆØ¯ (Ø§Ú¯Ø± ØªØ§ÛŒÛŒØ¯ÛŒÙ‡ Ù†Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø®Ø· Ø²ÛŒØ± Ø±Ø§ Ø³Ø§Ø¯Ù‡ Ú©Ù†ÛŒØ¯)
    printInvoice(invoice); 

    // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
    posCart = [];
    saveData();
    renderCart();
    renderInventory();
    renderDashboard();
    showToast('ÙØ§Ú©ØªÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯', 'success');
}
function populatePosCustomers() {
    const select = document.getElementById('posCustomer');
    if(!select) return;
    
    // Keep 'Guest' option
    select.innerHTML = '<option value="guest">Ù…Ø´ØªØ±ÛŒ Ù…Ù‡Ù…Ø§Ù†</option>';
    
    db.customers.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c.id;
        opt.innerText = c.name + (c.phone ? ` (${c.phone})` : '');
        select.appendChild(opt);
    });
}
/* PART 20 OF 20: RENDERING, ACTIONS & FINAL INIT */

// =========================================
// 6. PAGE RENDERING FUNCTIONS
// =========================================

function renderDashboard() {
    // 1. Income & Expense
    let todayIncome = 0;
    let todayExpense = 0;
    
    const now = new Date();
    const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
    
    db.transactions.forEach(tx => {
        if (tx.date >= startOfDay) {
            if (tx.type === 'income') todayIncome += tx.amount;
            if (tx.type === 'expense') todayExpense += tx.amount;
        }
    });

    document.getElementById('dashTodayIncome').innerText = formatMoney(todayIncome);
    document.getElementById('dashTodayExpense').innerText = formatMoney(todayExpense);

    // 2. Appointments
    const todayApts = db.appointments.filter(a => a.date === getTodayJalali());
    document.getElementById('dashTodayApts').innerText = todayApts.length;
    document.getElementById('dashPendingApts').innerText = todayApts.filter(a => a.status === 'scheduled').length;

    // 3. Register Status
    document.getElementById('dashRegisterStatus').innerText = db.posSession.isOpen ? 'Ø¨Ø§Ø² Ø§Ø³Øª' : 'Ø¨Ø³ØªÙ‡ Ø§Ø³Øª';

    // 4. Recent Transactions Table (Ø§ÛŒÙ…Ù† Ø³Ø§Ø²ÛŒ Ø´Ø¯Ù‡)
    const tbody = document.getElementById('dashRecentTxBody');
    tbody.innerHTML = '';
    
    const recentTx = [...db.transactions].sort((a,b) => b.date - a.date).slice(0, 5);
    
    if(recentTx.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; color:var(--text-muted)">ØªØ±Ø§Ú©Ù†Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</td></tr>';
    } else {
        recentTx.forEach(tx => {
            const dateStr = new Date(tx.date).toLocaleTimeString('fa-IR', {hour:'2-digit', minute:'2-digit'});
            let typeColor = tx.type === 'income' ? 'var(--success)' : 'var(--danger)';
            let typeIcon = tx.type === 'income' ? 'arrow-up' : 'arrow-down';
            
            // ØªØºÛŒÛŒØ±Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯ (escapeHTML)
            tbody.innerHTML += `
                <tr>
                    <td style="color:var(--text-muted)">${dateStr}</td>
                    <td>${escapeHTML(tx.category)} - <span style="font-size:12px; opacity:0.7">${escapeHTML(tx.desc)}</span></td>
                    <td style="color:${typeColor}; direction:ltr; font-weight:bold;">
                        ${formatMoney(tx.amount)}
                    </td>
                    <td><div class="status-badge" style="color:${typeColor}; border-color:${typeColor}20; background:${typeColor}10">
                        <i class="fa-solid fa-${typeIcon}"></i> ${tx.type === 'income' ? 'Ø¯Ø±Ø¢Ù…Ø¯' : 'Ù‡Ø²ÛŒÙ†Ù‡'}
                    </div></td>
                    <td style="font-size:12px;">${escapeHTML(tx.user)}</td>
                </tr>
            `;
        });
    }

    renderCharts(); 
}
function renderAccounting() {
    const tbody = document.getElementById('accountingBody');
    const filterType = document.getElementById('accFilterType').value;
    const search = document.getElementById('accSearch').value.toLowerCase();
    
    tbody.innerHTML = '';

    let list = db.transactions.sort((a,b) => b.date - a.date);
    
    if (filterType !== 'all') list = list.filter(t => t.type === filterType);
    if (search) list = list.filter(t => t.desc.toLowerCase().includes(search) || t.category.includes(search));

    list.forEach((tx, index) => {
        const dateStr = new Date(tx.date).toLocaleDateString('fa-IR') + ' ' + new Date(tx.date).toLocaleTimeString('fa-IR', {hour:'2-digit', minute:'2-digit'});
        const color = tx.type === 'income' ? 'var(--success)' : 'var(--danger)';
        
        // Ø§ÛŒÙ…Ù†â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒØŒ ØªÙˆØ¶ÛŒØ­Ø§Øª Ùˆ Ú©Ø§Ø±Ø¨Ø±
        tbody.innerHTML += `
            <tr>
                <td>${index + 1}</td>
                <td>${dateStr}</td>
                <td><span style="color:${color}">${tx.type === 'income' ? 'Ø¯Ø±Ø¢Ù…Ø¯' : 'Ù‡Ø²ÛŒÙ†Ù‡'}</span></td>
                <td>${escapeHTML(tx.category)}</td>
                <td>${escapeHTML(tx.desc)}</td>
                <td style="font-weight:bold; color:${color}; direction:ltr">${formatMoney(tx.amount)}</td>
                <td style="font-size:11px; color:var(--text-muted)">${tx.tax > 0 ? formatMoney(tx.tax) : '-'}</td>
                <td>${escapeHTML(tx.user)}</td>
                <td>
                    <button class="btn-sm" onclick="deleteItem('transactions', '${tx.id}')" style="color:var(--danger)"><i class="fa-solid fa-trash"></i></button>
                </td>
            </tr>
        `;
    });

    const totalInc = list.filter(t=>t.type==='income').reduce((s,t)=>s+t.amount,0);
    const totalExp = list.filter(t=>t.type==='expense').reduce((s,t)=>s+t.amount,0);
    
    document.getElementById('accTotalIncome').innerText = formatMoney(totalInc);
    document.getElementById('accTotalExpense').innerText = formatMoney(totalExp);
    document.getElementById('accBalance').innerText = formatMoney(totalInc - totalExp);
}
function renderDebts() {
    const tbody = document.getElementById('debtsBody');
    tbody.innerHTML = '';
    
    if(!db.debts) db.debts = [];
    let totalDebt = 0;

    if(db.debts.length === 0) {
         tbody.innerHTML = '<tr><td colspan="6" class="text-center">Ù‡ÛŒÚ† Ø¨Ø¯Ù‡Ú©Ø§Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</td></tr>';
    } else {
        db.debts.forEach(d => {
            totalDebt += d.amount;
            // Ø§ÛŒÙ…Ù†â€ŒØ³Ø§Ø²ÛŒ Ù†Ø§Ù… Ùˆ ØªÙ„ÙÙ†
            tbody.innerHTML += `
                <tr>
                    <td>${escapeHTML(d.name)}</td>
                    <td>${escapeHTML(d.phone)}</td>
                    <td style="color:var(--danger); font-weight:bold; direction:ltr">${formatMoney(d.amount)}</td>
                    <td>${d.lastDate}</td>
                    <td><span class="status-badge status-danger">Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø´Ø¯Ù‡</span></td>
                    <td>
                        <button class="gold-btn btn-sm" onclick="settleDebt('${d.id}')">ØªØ³ÙˆÛŒÙ‡</button>
                    </td>
                </tr>
            `;
        });
    }
    document.getElementById('totalDebtDisplay').innerText = formatMoney(totalDebt);
}

function renderInventory() {
    const tbody = document.getElementById('inventoryBody');
    tbody.innerHTML = '';
    
    let totalValue = 0;
    let lowStock = 0;

    db.inventory.forEach(item => {
        totalValue += item.stock * item.buyPrice;
        if(item.stock <= item.lowStockAlert) lowStock++;
        
        let status = item.stock > 0 ? '<span class="status-badge status-success">Ù…ÙˆØ¬ÙˆØ¯</span>' : '<span class="status-badge status-danger">Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯</span>';
        if(item.stock > 0 && item.stock <= item.lowStockAlert) status = '<span class="status-badge status-warning">Ø±Ùˆ Ø¨Ù‡ Ø§ØªÙ…Ø§Ù…</span>';

        // Ø§ÛŒÙ…Ù†â€ŒØ³Ø§Ø²ÛŒ Ù†Ø§Ù… Ú©Ø§Ù„Ø§ Ùˆ Ø¨Ø±Ù†Ø¯
        tbody.innerHTML += `
            <tr>
                <td><strong>${escapeHTML(item.name)}</strong></td>
                <td>${escapeHTML(item.brand || '-')}</td>
                <td style="font-weight:bold; ${item.stock <= item.lowStockAlert ? 'color:var(--danger)' : ''}">${item.stock}</td>
                <td style="direction:ltr">${formatMoney(item.buyPrice)}</td>
                <td style="direction:ltr; color:var(--gold-light)">${formatMoney(item.sellPrice)}</td>
                <td>${status}</td>
                <td>
                    <button class="icon-btn" onclick="deleteItem('inventory', ${item.id})" style="width:30px; height:30px;"><i class="fa-solid fa-trash"></i></button>
                </td>
            </tr>
        `;
    });

    document.getElementById('invTotalItems').innerText = db.inventory.length;
    document.getElementById('invTotalValue').innerText = formatMoney(totalValue);
    document.getElementById('invLowStock').innerText = lowStock;
}
function renderCustomers() {
    const tbody = document.getElementById('customersBody');
    tbody.innerHTML = '';
    db.customers.forEach(c => {
        // Ø§ÛŒÙ…Ù†â€ŒØ³Ø§Ø²ÛŒ Ù†Ø§Ù… Ùˆ ØªÙ„ÙÙ†
        tbody.innerHTML += `
            <tr>
                <td>${escapeHTML(c.name)}</td>
                <td>${escapeHTML(c.phone)}</td>
                <td>-</td>
                <td>0</td>
                <td>0</td>
                <td><button class="btn-sm"><i class="fa-solid fa-pen"></i></button></td>
            </tr>`;
    });
    document.getElementById('crmTotalCust').innerText = db.customers.length;
}
function renderServices() {
    const grid = document.getElementById('servicesGrid');
    grid.innerHTML = '';
    db.services.forEach(s => {
        // Ø§ÛŒÙ…Ù†â€ŒØ³Ø§Ø²ÛŒ Ù†Ø§Ù… Ø®Ø¯Ù…Øª
        grid.innerHTML += `
            <div class="card" style="margin:0; padding:20px; text-align:center;">
                <div style="font-size:30px; color:var(--gold-dark); margin-bottom:10px;"><i class="${s.icon}"></i></div>
                <h4 style="color:var(--text-main);">${escapeHTML(s.name)}</h4>
                <div style="color:var(--gold-light); font-weight:bold; margin:10px 0; direction:ltr;">${formatMoney(s.price)}</div>
                <div style="font-size:12px; color:var(--text-muted);">Ø²Ù…Ø§Ù†: ${s.duration} Ø¯Ù‚ÛŒÙ‚Ù‡</div>
            </div>`;
    });
}
function handleLogin() {
    // 1. Ø¯Ø±ÛŒØ§ÙØª ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§
    const u = document.getElementById('loginUser').value;
    const p = document.getElementById('loginPass').value;
    
    // 2. Ø¨Ø±Ø±Ø³ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± (Ø±ÙˆÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ÙØ¹Ù„ÛŒ)
    // Ù†Ú©ØªÙ‡: Ø§Ú¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù„ÙˆØ¯ Ù†Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ø¨Ø§ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ú†Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯
    if (u === db.settings.auth.user && p === db.settings.auth.pass) {
        
        // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§ØµÙ„ÛŒ
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('mainApp').style.display = 'flex';
        
        // 3. Ø§ÙˆÙ„ Ø³ÛŒØ³ØªÙ… Ø±Ø§ Ø±Ø§Ù‡ Ø§Ù†Ø¯Ø§Ø²ÛŒ Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø§ Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯
        initApp(); 

        // 4. Ø­Ø§Ù„Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø²Ø¨Ø§Ù† Ø±Ø§ Ø§Ø¹Ù…Ø§Ù„ Ú©Ù†ÛŒØ¯ (Ø¯Ø§Ø®Ù„ try-catch ØªØ§ Ø§Ú¯Ø± Ø®Ø·Ø§ Ø¯Ø§Ø¯ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†Ù¾Ø±Ø¯)
        try {
            const langSelect = document.querySelector('select[onchange="handleLangChange(this)"]');
            let selectedLang = 'fa';
            let selectedCountry = 'AF';

            if (langSelect && langSelect.value) {
                const parts = langSelect.value.split(',');
                if (parts.length === 2) {
                    selectedLang = parts[0];
                    selectedCountry = parts[1];
                }
            }
            
            // ØªØºÛŒÛŒØ± Ú©Ø§Ù†ÙÛŒÚ¯ Ø¨Ø¹Ø¯ Ø§Ø² Ù„ÙˆØ¯ Ø´Ø¯Ù† Ú©Ø§Ù…Ù„ Ø¯ÛŒØªØ§
            changeSystemConfig(selectedLang, selectedCountry);
            
        } catch (error) {
            console.error("Error in language config:", error);
            // Ø­ØªÛŒ Ø§Ú¯Ø± ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù† Ø®Ø·Ø§ Ø¯Ø§Ø¯ØŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ø§Ø² Ø´ÙˆØ¯
        }

        // Ø±ÙØ±Ø´ Ù†Ù‡Ø§ÛŒÛŒ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
        if(typeof renderDashboard === 'function') renderDashboard();
        
    } else {
        // Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§
        const err = document.getElementById('loginError');
        err.style.display = 'block';
        err.innerText = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª";
        setTimeout(() => err.style.display = 'none', 2000);
    }
}
function openRegister() {
    const cash = parseFloat(document.getElementById('regStartCash').value) || 0;
    db.posSession = {
        isOpen: true,
        startTime: Date.now(),
        startCash: cash,
        salesCash: 0,
        salesCard: 0
    };
    saveData();
    closeModal('modalRegister');
    initPos(); // Refresh UI
    showToast('ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø² Ø´Ø¯', 'success');
}

function closeRegister() {
    if(confirm('Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø³ØªÙ† ØµÙ†Ø¯ÙˆÙ‚ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
        db.posSession.isOpen = false;
        saveData();
        closeModal('modalRegister');
        initPos();
        showToast('ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ø³ØªÙ‡ Ø´Ø¯. Ú¯Ø²Ø§Ø±Ø´ Ú†Ø§Ù¾ Ø´Ø¯.', 'info');
    }
}

// Transaction Actions
function submitTransaction() {
    const amount = parseFloat(document.getElementById('txAmount').value);
    if (!amount) return showToast('Ù…Ø¨Ù„Øº Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
    
    const type = document.getElementById('txType').value || 'expense'; // Default to expense if triggered from expense button
    const cat = document.getElementById('txCategory').value || 'Ø³Ø§ÛŒØ±';
    const desc = document.getElementById('txDesc').value;
    
    // Tax Logic
    let tax = 0;
    if (document.getElementById('txTaxApply').checked) {
        tax = amount * (db.settings.taxRate / 100);
    }

    db.transactions.push({
        id: generateId(),
        date: Date.now(),
        type: type,
        category: cat,
        desc: desc,
        amount: amount,
        tax: tax,
        user: db.settings.auth.user
    });

    saveData();
    closeModal('modalNewTx');
    renderAccounting();
    renderDashboard();
    showToast('ØªØ±Ø§Ú©Ù†Ø´ Ø«Ø¨Øª Ø´Ø¯', 'success');
}

// Save Functions
function saveCustomer() {
    const name = document.getElementById('custName').value;
    const phone = document.getElementById('custPhone').value;
    if(!name || !phone) return showToast('Ù†Ø§Ù… Ùˆ Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª', 'error');
    
    db.customers.push({ id: generateId(), name, phone, joinDate: Date.now() });
    saveData();
    closeModal('modalCustomer');
    renderCustomers();
    populatePosCustomers(); // Refresh dropdown
    showToast('Ù…Ø´ØªØ±ÛŒ Ø«Ø¨Øª Ø´Ø¯', 'success');
}

function saveService() {
    const name = document.getElementById('srvName').value;
    const price = parseFloat(document.getElementById('srvPrice').value);
    if(!name || !price) return showToast('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ø§Ù‚Øµ Ø§Ø³Øª', 'error');

    db.services.push({
        id: generateId(),
        name,
        price,
        icon: document.getElementById('srvIcon').value || 'fa-solid fa-scissors',
        duration: document.getElementById('srvDuration').value,
        category: document.getElementById('srvCat').value,
        taxable: document.getElementById('srvTaxable').value
    });
    saveData();
    closeModal('modalService');
    renderServices();
    showToast('Ø®Ø¯Ù…Øª Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯', 'success');
}

function saveProduct() {
    // Similar to saveService, get values from modalProduct inputs
    // Push to db.inventory
    // saveData(); closeModal...
    // Included in full code for brevity in split
    const name = document.getElementById('prdName').value;
    const sellPrice = parseFloat(document.getElementById('prdSellPrice').value);
    const stock = parseInt(document.getElementById('prdStock').value);
    
    if(!name || !sellPrice) return showToast('Ù†Ø§Ù… Ùˆ Ù‚ÛŒÙ…Øª ÙØ±ÙˆØ´ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª', 'error');

    db.inventory.push({
        id: generateId(),
        name,
        brand: document.getElementById('prdBrand').value,
        stock: stock || 0,
        buyPrice: parseFloat(document.getElementById('prdBuyPrice').value) || 0,
        sellPrice,
        lowStockAlert: parseInt(document.getElementById('prdLowStockAlert').value) || 5
    });
    saveData();
    closeModal('modalProduct');
    renderInventory();
    showToast('Ú©Ø§Ù„Ø§ Ø¨Ù‡ Ø§Ù†Ø¨Ø§Ø± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯', 'success');
}

// Modal Helpers
function openModal(id, type) {
    document.getElementById(id).classList.add('active');
    
    // Specific logic for modals
    if (id === 'modalNewTx') {
        const title = type === 'income' ? 'Ø«Ø¨Øª Ø¯Ø±Ø¢Ù…Ø¯ Ø¬Ø¯ÛŒØ¯' : 'Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡ Ø¬Ø¯ÛŒØ¯';
        document.getElementById('modalTxTitle').innerText = title;
        document.getElementById('txType').value = type;
        
        // Populate Categories
        const catSelect = document.getElementById('txCategory');
        catSelect.innerHTML = '';
        const cats = type === 'income' ? ['ÙØ±ÙˆØ´ Ù…ØªÙØ±Ù‚Ù‡', 'Ø¨ÛŒØ¹Ø§Ù†Ù‡', 'Ø³Ø§ÛŒØ±'] : ['Ø®Ø±ÛŒØ¯ Ù…ÙˆØ§Ø¯', 'Ø§Ø¬Ø§Ø±Ù‡', 'Ù‚Ø¨Ø¶ Ø¨Ø±Ù‚/Ø¢Ø¨', 'Ø­Ù‚ÙˆÙ‚', 'ØªØ¹Ù…ÛŒØ±Ø§Øª', 'Ø³Ø§ÛŒØ±'];
        cats.forEach(c => catSelect.innerHTML += `<option>${c}</option>`);
    }

    if (id === 'modalRegister') {
        // Toggle Open/Close forms based on state
        if (db.posSession.isOpen) {
            document.getElementById('registerOpenForm').style.display = 'none';
            document.getElementById('registerCloseForm').style.display = 'block';
            
            // Fill Info
            document.getElementById('regStartTimeDisplay').innerText = new Date(db.posSession.startTime).toLocaleTimeString('fa-IR');
            document.getElementById('regTotalCashDisplay').innerText = formatMoney(db.posSession.salesCash);
        } else {
            document.getElementById('registerOpenForm').style.display = 'block';
            document.getElementById('registerCloseForm').style.display = 'none';
        }
    }
}

function closeModal(id) {
    document.getElementById(id).classList.remove('active');
}

// =========================================
// 8. TAX REPORT & PRINTING
// =========================================

function calculateTaxReport() {
    const period = document.getElementById('taxReportSeason').value;
    // Real app: filter db.invoices by date based on period
    // Demo: Sum all
    
    let grossSales = 0;
    let taxableIncome = 0;
    
    db.invoices.forEach(inv => {
        grossSales += inv.subtotal;
        if(inv.tax > 0) taxableIncome += inv.subtotal;
    });

    const taxRate = db.settings.taxRate;
    const taxPayable = taxableIncome * (taxRate / 100);

    document.getElementById('taxGrossSales').innerText = formatMoney(grossSales);
    document.getElementById('taxableIncome').innerText = formatMoney(taxableIncome);
    document.getElementById('taxPayable').innerText = formatMoney(taxPayable);
    
    document.getElementById('taxResultArea').style.display = 'block';
}

function printInvoice(invoice) {
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <html dir="rtl" lang="fa">
        <head>
            <title>Faktor #${invoice.no}</title>
            <style>
                @page { size: 80mm auto; margin: 0; } /* ØªÙ†Ø¸ÛŒÙ… Ø³Ø§ÛŒØ² Ú©Ø§ØºØ° Ø¨Ø±Ø§ÛŒ ÙÛŒØ´ Ù¾Ø±ÛŒÙ†ØªØ± */
                body {
                    font-family: 'Tahoma', sans-serif;
                    width: 72mm; /* Ø¹Ø±Ø¶ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ú†Ø§Ù¾ */
                    margin: 0 auto;
                    padding: 5px;
                    font-size: 12px;
                    color: #000;
                }
                .header { text-align: center; margin-bottom: 10px; border-bottom: 1px dashed #000; padding-bottom: 5px; }
                .logo { font-size: 20px; font-weight: bold; margin-bottom: 5px; }
                .info { font-size: 10px; margin-bottom: 5px; }
                
                table { width: 100%; border-collapse: collapse; margin-top: 5px; }
                th { text-align: right; border-bottom: 1px dashed #000; font-size: 11px; padding: 2px 0; }
                td { padding: 4px 0; border-bottom: 1px dotted #ccc; }
                
                .footer { margin-top: 10px; border-top: 1px dashed #000; padding-top: 5px; text-align: center; font-size: 10px; }
                .total-row { display: flex; justify-content: space-between; font-weight: bold; font-size: 14px; margin-top: 5px; }
                
                /* Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¢Ø¯Ø±Ø³ Ùˆ ØªØ§Ø±ÛŒØ® Ø¯Ø± Ú†Ø§Ù¾ Ø§Ú¯Ø± Ø®ÛŒÙ„ÛŒ Ø·ÙˆÙ„Ø§Ù†ÛŒ Ø´ÙˆØ¯ */
                .no-print { display: none; }
            </style>
        </head>
        <body>
            <div class="header">
                <div class="logo">âœ‚ï¸ ${db.settings.name}</div>
                <div class="info">ØªØ§Ø±ÛŒØ®: ${new Date(invoice.date).toLocaleDateString('fa-IR')}</div>
                <div class="info">ØµÙ†Ø¯ÙˆÙ‚â€ŒØ¯Ø§Ø±: ${invoice.user} | ÙØ§Ú©ØªÙˆØ±: ${invoice.no}</div>
                <div class="info">Ù…Ø´ØªØ±ÛŒ: ${invoice.customer}</div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Ø´Ø±Ø­</th>
                        <th style="width:30px; text-align:center;">ØªØ¹Ø¯Ø§Ø¯</th>
                        <th style="text-align:left;">Ù‚ÛŒÙ…Øª</th>
                    </tr>
                </thead>
                <tbody>
                    ${invoice.items.map(i => `
                    <tr>
                        <td>${i.name}</td>
                        <td style="text-align:center;">${i.qty}</td>
                        <td style="text-align:left;">${(i.price * i.qty).toLocaleString()}</td>
                    </tr>`).join('')}
                </tbody>
            </table>

            <div class="footer">
                <div style="display:flex; justify-content:space-between; font-size:11px;">
                    <span>Ø¬Ù…Ø¹ Ú©Ù„:</span>
                    <span>${formatMoney(invoice.subtotal)}</span>
                </div>
                ${invoice.tax > 0 ? `
                <div style="display:flex; justify-content:space-between; font-size:11px;">
                    <span>Ù…Ø§Ù„ÛŒØ§Øª:</span>
                    <span>${formatMoney(invoice.tax)}</span>
                </div>` : ''}
                
                <div class="total-row">
                    <span>Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª:</span>
                    <span>${formatMoney(invoice.total)}</span>
                </div>
                
                <div style="margin-top:15px; font-size:9px;">
                    Ø§Ø² Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø³Ù¾Ø§Ø³Ú¯Ø²Ø§Ø±ÛŒÙ…<br>
                    Ù„Ø·ÙØ§Ù‹ ÙØ§Ú©ØªÙˆØ± Ø±Ø§ Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯
                </div>
                <br>
                <div style="background:#000; height:5px; width:100%;"></div>
                <div style="background:#000; height:5px; width:80%; margin:2px auto;"></div>
            </div>
            
            <script>
                window.onload = function() { window.print(); window.close(); }
            <\/script>
        </body>
        </html>
    `);
    printWindow.document.close();
}
// ØªØ¹Ø±ÛŒÙ Ù…ØªØºÛŒØ± Ø¨ÛŒØ±ÙˆÙ† Ø§Ø² ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù†Ù…ÙˆØ¯Ø§Ø±
let myChartInstance = null;

function renderCharts() {
    const ctx = document.getElementById('mainChart');
    
    // Ø§Ú¯Ø± Ù†Ù…ÙˆØ¯Ø§Ø± Ù‚Ø¨Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ØŒ Ø¢Ù† Ø±Ø§ Ù†Ø§Ø¨ÙˆØ¯ Ú©Ù† ØªØ§ Ø­Ø§ÙØ¸Ù‡ Ø®Ø§Ù„ÛŒ Ø´ÙˆØ¯
    if (myChartInstance) {
        myChartInstance.destroy();
    }

    if(ctx && window.Chart) {
        myChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Ø´Ù†Ø¨Ù‡', 'ÛŒÚ©Ø´Ù†Ø¨Ù‡', 'Ø¯ÙˆØ´Ù†Ø¨Ù‡', 'Ø³Ù‡ Ø´Ù†Ø¨Ù‡', 'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', 'Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡', 'Ø¬Ù…Ø¹Ù‡'],
                datasets: [{
                    label: 'Ø¯Ø±Ø¢Ù…Ø¯ (AFN)',
                    data: [12000, 19000, 3000, 5000, 2000, 30000, 45000], 
                    borderColor: '#D4AF37',
                    backgroundColor: 'rgba(212, 175, 55, 0.2)',
                    fill: true,
                    tension: 0.4 // Ù†Ø±Ù… Ú©Ø±Ø¯Ù† Ø®Ø· Ù†Ù…ÙˆØ¯Ø§Ø±
                }]
            },
            options: { 
                responsive: true, 
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { color: '#D4AF37' } // Ø±Ù†Ú¯ Ù…ØªÙ† Ø±Ø§Ù‡Ù†Ù…Ø§
                    }
                },
                scales: {
                    y: { ticks: { color: '#rgba(255,255,255,0.7)' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                    x: { ticks: { color: '#rgba(255,255,255,0.7)' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                }
            }
        });
    }
}
// =========================================
// LOGOUT FUNCTION - Ø®Ø±ÙˆØ¬ Ø§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡
// =========================================
function handleLogout() {
    if(confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ø² Ø³ÛŒØ³ØªÙ… Ø®Ø§Ø±Ø¬ Ø´ÙˆÛŒØ¯ØŸ')) {
        // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯
        document.getElementById('mainApp').style.display = 'none';
        document.getElementById('loginPage').style.display = 'flex';
        
        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯
        document.getElementById('loginUser').value = '';
        document.getElementById('loginPass').value = '';
        
        showToast('Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø§Ø±Ø¬ Ø´Ø¯ÛŒØ¯', 'info');
    }
}
function toggleTheme() {
    const html = document.documentElement;
    const current = html.getAttribute('data-theme');
    const newVal = current === 'dark' ? 'light' : 'dark';
    html.setAttribute('data-theme', newVal);
    db.settings.theme = newVal;
    saveData();
    
    // Icon update
    const icon = document.getElementById('themeIconBtn');
    if(icon) icon.className = newVal === 'dark' ? 'fa-solid fa-moon' : 'fa-solid fa-sun';
}

// =========================================
// 9. MISSING UI & HELPER FUNCTIONS (FIXED)
// =========================================

function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('open');
}

function switchTab(tabId, btn) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    
    // Show target
    document.getElementById(tabId).classList.add('active');
    btn.classList.add('active');
}

function deleteItem(collection, id) {
    if(!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ù…ÙˆØ±Ø¯ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª.')) return;
    
    // Filter out the item
    db[collection] = db[collection].filter(item => item.id != id);
    saveData();
    
    // Refresh Views
    if(collection === 'inventory') renderInventory();
    if(collection === 'transactions') { renderAccounting(); renderDashboard(); }
    if(collection === 'customers') renderCustomers();
    if(collection === 'services') renderServices();
    if(collection === 'staff') renderPersonnel();
    
    showToast('Ø¢ÛŒØªÙ… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯', 'info');
}

function filterAccounting() {
    renderAccounting(); // The logic is already inside renderAccounting, just re-trigger it
}

function setTodayFilter() {
    // Helper to set inputs to today's date (Simple String Match for now)
    const today = getTodayJalali(); 
    // Since we don't have a real date picker sync, we just alert or clear for demo
    document.getElementById('accDateFilter').valueAsDate = new Date();
    renderAccounting();
}

function loadSettingsToInputs() {
    if(!db.settings) return;
    document.getElementById('setSalonName').value = db.settings.name || '';
    document.getElementById('setPhone').value = db.settings.phone || '';
    document.getElementById('setAddress').value = db.settings.address || '';
    
    document.getElementById('setTaxType').value = db.settings.taxType || 'brt';
    document.getElementById('setTaxRate').value = db.settings.taxRate || 4;
    toggleTaxInput();
}

function toggleTaxInput() {
    const type = document.getElementById('setTaxType').value;
    const group = document.getElementById('taxRateGroup');
    if(type === 'custom') {
        group.style.display = 'block';
    } else {
        group.style.display = 'none';
        // Auto set rate
        if(type === 'brt') db.settings.taxRate = 4;
        if(type === 'vat') db.settings.taxRate = 10;
        if(type === 'none') db.settings.taxRate = 0;
    }
}

function toggleSubmenu(element) {
    element.classList.toggle('active');
    const submenu = element.nextElementSibling;
    if (submenu) {
        submenu.classList.toggle('open');
    }
}

function renderPersonnel() {
    const tbody = document.getElementById('personnelBody');
    const select = document.getElementById('payrollStaffSel');
    const aptSelect = document.getElementById('aptStaff'); 

    if(tbody) tbody.innerHTML = '';
    
    if(select) select.innerHTML = '<option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ø±Ø³Ù†Ù„ --</option>';
    if(aptSelect) aptSelect.innerHTML = '<option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ --</option>';

    db.staff.forEach(s => {
        if(tbody) {
            // Ø§ÛŒÙ…Ù†â€ŒØ³Ø§Ø²ÛŒ Ù†Ø§Ù… Ùˆ Ù†Ù‚Ø´ Ù¾Ø±Ø³Ù†Ù„
            tbody.innerHTML += `
                <tr>
                    <td><strong>${escapeHTML(s.name)}</strong></td>
                    <td>${escapeHTML(s.role)}</td>
                    <td style="direction:ltr">${formatMoney(s.baseSalary)}</td>
                    <td>${s.comm}%</td>
                    <td><span class="status-badge status-success">ÙØ¹Ø§Ù„</span></td>
                    <td>
                        <button class="icon-btn" onclick="deleteItem('staff', ${s.id})" style="width:30px; height:30px;"><i class="fa-solid fa-trash"></i></button>
                    </td>
                </tr>
            `;
        }
        if(select) select.innerHTML += `<option value="${s.id}">${escapeHTML(s.name)}</option>`;
        if(aptSelect) aptSelect.innerHTML += `<option value="${s.id}">${escapeHTML(s.name)}</option>`;
    });
}
function saveStaff() {
    const name = document.getElementById('stfName').value;
    const phone = document.getElementById('stfPhone').value;
    if(!name || !phone) return showToast('Ù†Ø§Ù… Ùˆ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª', 'error');

    db.staff.push({
        id: generateId(),
        name,
        role: document.getElementById('stfRole').value,
        phone,
        baseSalary: parseFloat(document.getElementById('stfBaseSalary').value) || 0,
        comm: parseFloat(document.getElementById('stfComm').value) || 0,
        joinDate: document.getElementById('stfJoinDate').value || getTodayJalali()
    });

    saveData();
    closeModal('modalStaff');
    renderPersonnel();
    showToast('Ù¾Ø±Ø³Ù†Ù„ Ø¬Ø¯ÛŒØ¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø´Ø¯', 'success');
}

function calculateSalary() {
    const staffId = document.getElementById('payrollStaffSel').value;
    if(!staffId) return showToast('Ù„Ø·ÙØ§ Ù¾Ø±Ø³Ù†Ù„ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');

    const staff = db.staff.find(s => s.id == staffId);
    if(!staff) return;

    // Simple Payroll Calculation
    const total = staff.baseSalary; // In future, add commission calc here

    const resDiv = document.getElementById('payrollResult');
    resDiv.style.display = 'block';
    resDiv.innerHTML = `
        <h4 style="color:var(--gold-light); border-bottom:1px solid var(--gold-dark); padding-bottom:5px; margin-bottom:10px;">
            ÙÛŒØ´ Ø­Ù‚ÙˆÙ‚ÛŒ: ${staff.name}
        </h4>
        <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
            <span>Ø­Ù‚ÙˆÙ‚ Ù¾Ø§ÛŒÙ‡:</span>
            <span>${formatMoney(staff.baseSalary)}</span>
        </div>
        <div style="display:flex; justify-content:space-between; margin-top:10px; padding-top:10px; border-top:1px dashed rgba(255,255,255,0.2); font-weight:bold; color:var(--success);">
            <span>Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª:</span>
            <span>${formatMoney(total)}</span>
        </div>
    `;
}
function renderAppointments() {
    const container = document.getElementById('appointmentsList');
    const filterStatus = document.getElementById('aptStatusFilter').value;
    const staffFilter = document.getElementById('aptStaffFilter').value; // Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ù¾Ø±Ø³Ù†Ù„
    
    container.innerHTML = '';

    if(db.appointments.length === 0) {
        container.innerHTML = `
            <div style="grid-column:1/-1; text-align:center; padding:50px; color:var(--text-muted); border:2px dashed var(--gold-dark); border-radius:15px; background:rgba(0,0,0,0.2);">
                <i class="fa-solid fa-calendar-xmark" style="font-size:40px; margin-bottom:15px; opacity:0.5;"></i>
                <div>Ù‡ÛŒÚ† Ù†ÙˆØ¨ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</div>
            </div>`;
        return;
    }

    // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ® Ùˆ Ø³Ø§Ø¹Øª
    let list = db.appointments.sort((a,b) => (a.date + a.time).localeCompare(b.date + b.time));
    
    // Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ±Ù‡Ø§
    if(filterStatus !== 'all') list = list.filter(a => a.status === filterStatus);
    if(staffFilter && staffFilter !== 'all') list = list.filter(a => a.staffId == staffFilter);

    if(list.length === 0) {
         container.innerHTML = `
            <div style="grid-column:1/-1; text-align:center; padding:30px; color:var(--text-muted);">
                Ù†ÙˆØ¨ØªÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù…Ø´Ø®ØµØ§Øª ÛŒØ§ÙØª Ù†Ø´Ø¯.
            </div>`;
        return;
    }

    list.forEach(apt => {
        let statusColor = 'var(--info)';
        let statusText = 'Ø±Ø²Ø±Ùˆ Ø´Ø¯Ù‡';
        let statusIcon = 'fa-clock';
        let statusBg = 'rgba(0, 176, 255, 0.1)';

        if(apt.status === 'confirmed') { 
            statusColor = 'var(--success)'; statusText = 'ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡'; statusIcon = 'fa-check-circle'; statusBg = 'rgba(0, 200, 83, 0.1)';
        }
        if(apt.status === 'canceled') { 
            statusColor = 'var(--danger)'; statusText = 'Ù„ØºÙˆ Ø´Ø¯Ù‡'; statusIcon = 'fa-circle-xmark'; statusBg = 'rgba(255, 23, 68, 0.1)';
        }
        if(apt.status === 'completed') { 
            statusColor = 'var(--gold-dark)'; statusText = 'Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯'; statusIcon = 'fa-clipboard-check'; statusBg = 'rgba(212, 175, 55, 0.1)';
        }

        const srv = db.services.find(s => s.id == apt.serviceId) || {name: 'Ø®Ø¯Ù…Øª Ø­Ø°Ù Ø´Ø¯Ù‡'};
        const stf = db.staff.find(s => s.id == apt.staffId) || {name: 'Ù†Ø§Ù…Ø´Ø®Øµ'};
        const cust = db.customers.find(c => c.id == apt.customerId) || {name: 'Ù…Ø´ØªØ±ÛŒ Ø­Ø°Ù Ø´Ø¯Ù‡'};

        // Ø·Ø±Ø§Ø­ÛŒ Ø¬Ø¯ÛŒØ¯ Ú©Ø§Ø±Øª Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¨Ù‡ Ù‡Ù… Ø±ÛŒØ®ØªÚ¯ÛŒ
        container.innerHTML += `
            <div class="card" style="margin:0; padding:0; border:1px solid rgba(212,175,55,0.2); overflow:hidden; display:flex; flex-direction:column;">
                
                <div style="padding:15px; background:rgba(0,0,0,0.2); border-bottom:1px solid rgba(255,255,255,0.05); display:flex; justify-content:space-between; align-items:center;">
                    <div style="font-weight:bold; font-size:15px; color:var(--gold-light);">
                        <i class="fa-regular fa-user" style="margin-left:5px; opacity:0.7;"></i> ${escapeHTML(cust.name)}
                    </div>
                    <div style="font-size:11px; padding:4px 8px; border-radius:15px; background:${statusBg}; color:${statusColor}; border:1px solid ${statusColor}; white-space:nowrap;">
                        <i class="fa-solid ${statusIcon}"></i> ${statusText}
                    </div>
                </div>

                <div style="padding:15px; flex:1;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:12px;">
                        <span style="color:var(--text-muted); font-size:12px;"><i class="fa-solid fa-scissors" style="width:20px; text-align:center;"></i> Ø®Ø¯Ù…Øª:</span>
                        <span style="font-weight:bold;">${escapeHTML(srv.name)}</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:12px;">
                        <span style="color:var(--text-muted); font-size:12px;"><i class="fa-solid fa-user-tie" style="width:20px; text-align:center;"></i> Ù…ØªØ®ØµØµ:</span>
                        <span>${escapeHTML(stf.name)}</span>
                    </div>
                    <div style="background:rgba(212,175,55,0.05); padding:8px; border-radius:8px; display:flex; justify-content:space-between; align-items:center; font-size:13px;">
                        <span style="color:var(--gold-primary);"><i class="fa-regular fa-calendar-days"></i> ${apt.date}</span>
                        <span style="color:var(--text-main); font-weight:bold;"><i class="fa-regular fa-clock"></i> ${apt.time}</span>
                    </div>
                    ${apt.note ? `<div style="margin-top:10px; font-size:11px; color:var(--text-muted); border-top:1px dashed rgba(255,255,255,0.1); padding-top:5px;">
                        <i class="fa-regular fa-note-sticky"></i> ${escapeHTML(apt.note)}
                    </div>` : ''}
                </div>

                <div style="padding:10px 15px; background:rgba(0,0,0,0.3); border-top:1px solid rgba(212,175,55,0.1); text-align:left;">
                    <button class="icon-btn" onclick="deleteItem('appointments', '${apt.id}')" style="width:32px; height:32px; background:rgba(255,23,68,0.1); color:var(--danger); border-color:var(--danger);" title="Ø­Ø°Ù Ù†ÙˆØ¨Øª">
                        <i class="fa-solid fa-trash" style="font-size:14px;"></i>
                    </button>
                </div>
            </div>
        `;
    });
}
function saveAppointment() {
    const custId = document.getElementById('aptCustomer').value;
    const date = document.getElementById('aptDateInput').value;
    const time = document.getElementById('aptTimeInput').value;
    const srvId = document.getElementById('aptService').value;
    const stfId = document.getElementById('aptStaff').value;
    
    if(!custId || !date || !time || !srvId) return showToast('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ø§Ù‚Øµ Ø§Ø³Øª', 'error');

    // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø²Ù…Ø§Ù† Ø³Ø±ÙˆÛŒØ³
    const service = db.services.find(s => s.id == srvId);
    const duration = service ? parseInt(service.duration) : 30;

    // ØªØ¨Ø¯ÛŒÙ„ Ø²Ù…Ø§Ù† Ø¨Ù‡ Ø¯Ù‚ÛŒÙ‚Ù‡
    const [h, m] = time.split(':').map(Number);
    const newStart = h * 60 + m;
    const newEnd = newStart + duration;

    // Ø¨Ø±Ø±Ø³ÛŒ ØªØ¯Ø§Ø®Ù„
    const hasConflict = db.appointments.some(apt => {
        if (apt.date !== date || apt.staffId != stfId || apt.status === 'canceled') return false;
        
        const [ah, am] = apt.time.split(':').map(Number);
        const aptStart = ah * 60 + am;
        const aptDuration = apt.duration || 30; 
        const aptEnd = aptStart + aptDuration;

        return (newStart < aptEnd && newEnd > aptStart);
    });

    if (hasConflict) {
        return showToast('âŒ ØªØ¯Ø§Ø®Ù„ Ø²Ù…Ø§Ù†ÛŒ! Ù¾Ø±Ø³Ù†Ù„ Ø¯Ø± Ø§ÛŒÙ† Ø³Ø§Ø¹Øª Ù…Ø´ØºÙˆÙ„ Ø§Ø³Øª.', 'error');
    }

    db.appointments.push({
        id: generateId(),
        customerId: custId,
        date, time, duration,
        serviceId: srvId, staffId: stfId,
        status: document.getElementById('aptStatus').value,
        note: document.getElementById('aptNote').value
    });

    saveData();
    closeModal('modalAppointment');
    renderAppointments();
    renderDashboard();
    showToast('Ù†ÙˆØ¨Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯', 'success');
}

function updateDropdowns() {
    // Fill Service Selects
    const srvSel = document.getElementById('aptService');
    const txCat = document.getElementById('txCategory'); // Optional
    
    if(srvSel) {
        srvSel.innerHTML = '<option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø¯Ù…Øª --</option>';
        db.services.forEach(s => srvSel.innerHTML += `<option value="${s.id}">${s.name}</option>`);
    }

    // Fill Customer Selects
    const custSel = document.getElementById('aptCustomer');
    if(custSel) {
        custSel.innerHTML = '<option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ --</option>';
        db.customers.forEach(c => custSel.innerHTML += `<option value="${c.id}">${c.name}</option>`);
    }
}
// =========================================
// 11. SETTINGS & BACKUP (FINAL ADDITIONS)
// =========================================

function saveGeneralSettings() {
    db.settings.name = document.getElementById('setSalonName').value;
    db.settings.phone = document.getElementById('setPhone').value;
    db.settings.address = document.getElementById('setAddress').value;
    
    saveData();
    // Update Sidebar Name immediately
    if(document.getElementById('sidebarUserName')) {
        document.getElementById('sidebarUserName').innerText = db.settings.name;
    }
    showToast('Ù…Ø´Ø®ØµØ§Øª Ø³Ø§Ù„Ù† Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
}

function saveFinanceSettings() {
    db.settings.taxType = document.getElementById('setTaxType').value;
    
    const rateInput = parseFloat(document.getElementById('setTaxRate').value);
    if (db.settings.taxType === 'custom' && isNaN(rateInput)) {
        return showToast('Ù„Ø·ÙØ§Ù‹ Ù†Ø±Ø® Ù…Ø§Ù„ÛŒØ§Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
    }
    
    // Logic inside toggleTaxInput handles default rates (4/10/0), here we capture custom
    if(db.settings.taxType === 'custom') db.settings.taxRate = rateInput;
    
    // Re-apply logic to ensure defaults are saved if switched back from custom
    if(db.settings.taxType === 'brt') db.settings.taxRate = 4;
    if(db.settings.taxType === 'vat') db.settings.taxRate = 10;
    if(db.settings.taxType === 'none') db.settings.taxRate = 0;

    saveData();
    showToast('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø§Ù„ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯', 'success');
}

function saveSecuritySettings() {
    const newUser = document.getElementById('secNewUser').value;
    const newPass = document.getElementById('secNewPass').value;
    const confirmPass = document.getElementById('secConfirmPass').value;
    
    if(!newUser || !newPass) return showToast('Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ù†Ø¯', 'error');
    if(newPass !== confirmPass) return showToast('ØªÚ©Ø±Ø§Ø± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù…Ø·Ø§Ø¨Ù‚Øª Ù†Ø¯Ø§Ø±Ø¯', 'error');
    
    db.settings.auth.user = newUser;
    db.settings.auth.pass = newPass;
    
    saveData();
    showToast('Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.', 'success');
    setTimeout(() => location.reload(), 2000);
}

function exportBackup() {
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(db));
    const downloadAnchorNode = document.createElement('a');
    downloadAnchorNode.setAttribute("href", dataStr);
    downloadAnchorNode.setAttribute("download", "RoyalSalon_Backup_" + new Date().toISOString().slice(0,10) + ".json");
    document.body.appendChild(downloadAnchorNode);
    downloadAnchorNode.click();
    downloadAnchorNode.remove();
}

function importBackup(input) {
    const file = input.files[0];
    if(!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const json = JSON.parse(e.target.result);
            if(!json.settings || !json.customers) throw new Error("Invalid Format");
            
            if(confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ¹Ù„ÛŒ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.')) {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(json));
                alert('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯.');
                location.reload();
            }
        } catch(err) {
            alert('ÙØ§ÛŒÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª ÛŒØ§ Ø®Ø±Ø§Ø¨ Ø§Ø³Øª.');
        }
    };
    reader.readAsText(file);
}

function factoryReset() {
    if(confirm('Ù‡Ø´Ø¯Ø§Ø±: ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø§Ú© Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯ Ùˆ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª. Ø§Ø¯Ø§Ù…Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯ØŸ')) {
        localStorage.removeItem(STORAGE_KEY);
        location.reload();
    }
}

// =========================================
// 12. FINAL INITIALIZATION & EXECUTION
// =========================================

// This closes the functionality and starts the app properly
// =========================================
// 14. NOTIFICATIONS SYSTEM (FINAL LOGIC)
// =========================================

function showNotifications() {
    const lowStock = db.inventory.filter(i => i.stock <= i.lowStockAlert);
    const pendingApts = db.appointments.filter(a => a.status === 'scheduled');
    
    // Ø§Ú¯Ø± Ù‡ÛŒÚ† Ù‡Ø´Ø¯Ø§Ø±ÛŒ Ù†Ø¨ÙˆØ¯
    if(lowStock.length === 0 && pendingApts.length === 0) {
        return showToast('Ù‡ÛŒÚ† Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', 'success');
    }

    // Ø³Ø§Ø®Øª Ù¾ÛŒØ§Ù… Ù‡Ø´Ø¯Ø§Ø±
    let msg = 'ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ…:\n\n';
    
    if(lowStock.length > 0) {
        msg += `âš ï¸ ØªÙˆØ¬Ù‡: ${lowStock.length} Ú©Ø§Ù„Ø§ Ø¯Ø± Ø§Ù†Ø¨Ø§Ø± Ø±Ùˆ Ø¨Ù‡ Ø§ØªÙ…Ø§Ù… Ø§Ø³Øª.\n`;
        // Ù†Ù…Ø§ÛŒØ´ Ù†Ø§Ù… Ú†Ù†Ø¯ Ú©Ø§Ù„Ø§ÛŒ Ø§ÙˆÙ„
        lowStock.slice(0, 3).forEach(i => msg += `   - ${i.name} (Ù…ÙˆØ¬ÙˆØ¯ÛŒ: ${i.stock})\n`);
        if(lowStock.length > 3) msg += '   Ùˆ ...\n';
        msg += '\n';
    }
    
    if(pendingApts.length > 0) {
        msg += `ğŸ“… ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ: ${pendingApts.length} Ù†ÙˆØ¨Øª Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯ Ø¯Ø§Ø±ÛŒØ¯.\n`;
    }

    // Ù†Ù…Ø§ÛŒØ´ Ø¢Ù„Ø±Øª (Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø¹Ø¯Ø§Ù‹ Ø¨Ù‡ Ù…ÙˆØ¯Ø§Ù„ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯)
    alert(msg); 
}

function updateNotificationBadge() {
    const badge = document.getElementById('notifBadge');
    if(!badge) return;

    // Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ù…
    const lowStockCount = db.inventory ? db.inventory.filter(i => i.stock <= i.lowStockAlert).length : 0;
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±
    const pendingCount = db.appointments ? db.appointments.filter(a => a.status === 'scheduled').length : 0;
    
    const total = lowStockCount + pendingCount;

    if (total > 0) {
        badge.style.display = 'block';
        badge.innerText = total > 9 ? '+9' : total; // Ø§Ú¯Ø± Ø¹Ø¯Ø¯ Ø¨Ø²Ø±Ú¯ Ø¨ÙˆØ¯
        badge.style.fontSize = '8px';
        badge.style.display = 'flex';
        badge.style.alignItems = 'center';
        badge.style.justifyContent = 'center';
        badge.style.color = '#fff';
    } else {
        badge.style.display = 'none';
    }
}

// Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø³Ø§Ø²ÛŒ ØªØ§Ø¨Ø¹ Ø°Ø®ÛŒØ±Ù‡
// Ø§ÛŒÙ† Ú©Ø§Ø± Ø¨Ø§Ø¹Ø« Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ù‡Ø± ÙˆÙ‚Øª Ú†ÛŒØ²ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ØŒ Ø¨Ø¬ Ùˆ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ Ø¢Ù¾Ø¯ÛŒØª Ø´ÙˆÙ†Ø¯
const _originalSaveData = saveData; // Ø°Ø®ÛŒØ±Ù‡ ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ
saveData = function() {
    _originalSaveData(); // Ø§Ø¬Ø±Ø§ÛŒ ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ
    updateNotificationBadge(); // Ø¢Ù¾Ø¯ÛŒØª Ø¨Ø¬
    
    // Ø§Ú¯Ø± Ø¯Ø± ØµÙØ­Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù‡Ø³ØªÛŒÙ…ØŒ Ù†Ù…ÙˆØ¯Ø§Ø± Ø±Ø§ Ù‡Ù… Ø¢Ù¾Ø¯ÛŒØª Ú©Ù†
    if(document.getElementById('dashboard').classList.contains('active')) {
        renderDashboard();
    }
};

// =========================================
// 15. FINAL BOOTSTRAP (REPLACES OLD LISTENER)
// =========================================

// Ø­Ø°Ù Ù„ÛŒØ³Ù†Ø±Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ (Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù†Ø¯) Ùˆ Ø§Ø¬Ø±Ø§ÛŒ Ù†Ù‡Ø§ÛŒÛŒ
window.addEventListener('DOMContentLoaded', () => {
    console.log("System Booting...");
    
    // 1. Ø±Ø§Ù‡ Ø§Ù†Ø¯Ø§Ø²ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ùˆ Ø¸Ø§Ù‡Ø±
    initApp();
    
    // 2. Ù¾Ø± Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ø´ÙˆÛŒÛŒ
    if(typeof updateDropdowns === 'function') updateDropdowns();
    
    // 3. Ø¨Ø±Ø±Ø³ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø§Ø¹Ù„Ø§Ù†Ø§Øª
    updateNotificationBadge();
    
    // 4. ØªÙ†Ø¸ÛŒÙ… ØªØ§ÛŒÙ…Ø± Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¹Øª Ùˆ ØªØ§Ø±ÛŒØ®
    setInterval(() => {
        if(document.getElementById('currentDateDisplay')) updateDateDisplay();
    }, 60000);

    console.log("Royal Salon AF Loaded Successfully.");
});
// =========================================
// 16. FINAL POLISH: SHORTCUTS & PRINT STYLES
// =========================================

// 1. Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØµÙˆØµ Ú†Ø§Ù¾ (Ù¾Ø±ÛŒÙ†ØªØ±)
// Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø¨Ø§Ø¹Ø« Ù…ÛŒâ€ŒØ´ÙˆØ¯ ÙˆÙ‚ØªÛŒ Ø¯Ú©Ù…Ù‡ Ù¾Ø±ÛŒÙ†Øª Ø±Ø§ Ù…ÛŒâ€ŒØ²Ù†ÛŒØ¯ØŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³ÛŒØ§Ù‡ Ø­Ø°Ù Ø´ÙˆØ¯ Ùˆ Ø¯Ø± Ù…ØµØ±Ù Ø¬ÙˆÙ‡Ø± ØµØ±ÙÙ‡â€ŒØ¬ÙˆÛŒÛŒ Ø´ÙˆØ¯
const printStyle = document.createElement('style');
printStyle.innerHTML = `
    @media print {
        @page { size: auto; margin: 10mm; }
        body, .main-content, .page-container, .glass-panel, .card, .lux-modal {
            background: #ffffff !important;
            color: #000000 !important;
            box-shadow: none !important;
            border: none !important;
            overflow: visible !important;
            height: auto !important;
        }
        /* Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¹Ù†Ø§ØµØ± Ø§Ø¶Ø§ÙÛŒ Ø¯Ø± Ú†Ø§Ù¾ */
        .sidebar, .top-header, .btn, .gold-btn, .icon-btn, .tabs, .toast-container, 
        .card-header button, .nav-menu, #loadingOverlay, .close-modal { 
            display: none !important; 
        }
        /* ØªÙ†Ø¸ÛŒÙ… Ø¬Ø¯Ø§ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù¾ */
        .lux-table th { background: #eee !important; color: #000 !important; border: 1px solid #000 !important; }
        .lux-table td { border: 1px solid #ccc !important; color: #000 !important; }
        .stat-card { border: 1px solid #ccc !important; page-break-inside: avoid; }
        .stat-value { color: #000 !important; }
        
        /* Ù†Ù…Ø§ÛŒØ´ ÙÙ‚Ø· Ø¨Ø®Ø´ ÙØ¹Ø§Ù„ */
        .page-section { display: none !important; }
        .page-section.active { display: block !important; }
        
        /* Ø§Ú¯Ø± Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§Ø² Ø§Ø³ØªØŒ ÙÙ‚Ø· Ù…ÙˆØ¯Ø§Ù„ Ú†Ø§Ù¾ Ø´ÙˆØ¯ */
        .modal-overlay.active {
            position: absolute; top: 0; left: 0; width: 100%; height: auto;
            background: #fff !important; z-index: 99999;
        }
        .modal-overlay.active .lux-modal {
            transform: none !important; width: 100% !important; max-width: 100% !important;
            border: none !important;
        }
    }
`;
document.head.appendChild(printStyle);

// 2. Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ù…ÛŒØ§Ù†Ø¨Ø± Ú©ÛŒØ¨ÙˆØ±Ø¯ (Keyboard Shortcuts)
// =========================================
//  FIX: KEYBOARD SHORTCUTS (F1-F12 & ESC)
// =========================================
document.addEventListener('keydown', function(e) {
    // 1. Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ú©Ù…Ù‡ ESC Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† ØªÙ…Ø§Ù… Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§
    if (e.key === 'Escape') {
        const activeModals = document.querySelectorAll('.modal-overlay.active');
        if (activeModals.length > 0) {
            activeModals.forEach(m => m.classList.remove('active'));
            showToast('Ù¾Ù†Ø¬Ø±Ù‡ Ø¨Ø³ØªÙ‡ Ø´Ø¯', 'info');
        }
        // Ø¨Ø³ØªÙ† Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„
        document.getElementById('sidebar').classList.remove('open');
        return;
    }

    // Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø­Ø§Ù„ ØªØ§ÛŒÙ¾ Ø¯Ø± ÙˆØ±ÙˆØ¯ÛŒ Ù…ØªÙ†ÛŒ Ø§Ø³ØªØŒ Ø´ÙˆØ±Øªâ€ŒÚ©Ø§Øªâ€ŒÙ‡Ø§ (Ø¨Ù‡ Ø¬Ø² FÙ‡Ø§) ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´ÙˆÙ†Ø¯
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
        return; 
    }

    // Ù„ÛŒØ³Øª Ù…ÛŒØ§Ù†Ø¨Ø±Ù‡Ø§
    switch(e.key) {
        case 'F1':
            e.preventDefault();
            navigateTo('dashboard');
            showToast('F1: Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯', 'info');
            break;
        case 'F2':
            e.preventDefault();
            navigateTo('pos');
            showToast('F2: ØµÙ†Ø¯ÙˆÙ‚ ÙØ±ÙˆØ´', 'info');
            break;
        case 'F3':
            e.preventDefault();
            navigateTo('appointments');
            showToast('F3: Ù†ÙˆØ¨Øªâ€ŒØ¯Ù‡ÛŒ', 'info');
            break;
        case 'F4':
            e.preventDefault();
            // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…ÙˆØ¯Ø§Ù„ Ù†ÙˆØ¨Øª Ø¬Ø¯ÛŒØ¯ (Ø§Ú¯Ø± Ø¯Ø± ØµÙØ­Ù‡ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¨Ø§Ø´ÛŒÙ… Ù‡Ù… Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯)
            openModal('modalAppointment');
            showToast('F4: Ø«Ø¨Øª Ù†ÙˆØ¨Øª Ø¬Ø¯ÛŒØ¯', 'info');
            break;
        case 'F5':
             // Ø±ÙØ±Ø´ Ú©Ø±Ø¯Ù† ØµÙØ­Ù‡ (Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù…Ø±ÙˆØ±Ú¯Ø±) Ø±Ø§ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
            break;
        case 'F6':
            e.preventDefault();
            navigateTo('personnel');
            showToast('F6: Ù¾Ø±Ø³Ù†Ù„', 'info');
            break;
        case 'F7':
            e.preventDefault();
            navigateTo('inventory');
            showToast('F7: Ø§Ù†Ø¨Ø§Ø±', 'info');
            break;
        case 'F8':
            e.preventDefault();
            navigateTo('accounting');
            showToast('F8: Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ', 'info');
            break;
        case 'F9':
            e.preventDefault();
            navigateTo('settings');
            showToast('F9: ØªÙ†Ø¸ÛŒÙ…Ø§Øª', 'info');
            break;
        case 'F10':
            e.preventDefault();
            toggleTheme(); // ØªØºÛŒÛŒØ± ØªÙ…
            break;
    }
});
// 3. Ø¨Ø³ØªÙ† Ù…Ù†Ùˆ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø¨ÛŒØ±ÙˆÙ†
document.addEventListener('click', function(e) {
    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.querySelector('.fa-bars');
    
    // Ø§Ú¯Ø± Ù…Ù†Ùˆ Ø¨Ø§Ø² Ø§Ø³Øª Ùˆ Ú©Ø§Ø±Ø¨Ø± Ø¨ÛŒØ±ÙˆÙ† Ø¢Ù† Ú©Ù„ÛŒÚ© Ú©Ø±Ø¯
    if(sidebar.classList.contains('open') && !sidebar.contains(e.target) && e.target !== toggleBtn) {
        sidebar.classList.remove('open');
    }
});

// 4. Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ (Ù‚Ø±Ù…Ø² Ø´Ø¯Ù† Ú©Ø§Ø¯Ø±Ù‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ)
document.addEventListener('focusout', function(e) {
    if(e.target.classList.contains('lux-input') && e.target.hasAttribute('required')) {
        if(!e.target.value) {
            e.target.style.borderColor = 'var(--danger)';
        } else {
            e.target.style.borderColor = 'rgba(212, 175, 55, 0.3)';
        }
    }
});
function consumeProduct(id) {
    const item = db.inventory.find(i => i.id == id);
    if (!item) return;

    const qtyStr = prompt(`Ù…ØµØ±Ù Ø¯Ø§Ø®Ù„ÛŒ "${item.name}"\n\nØªØ¹Ø¯Ø§Ø¯ Ù…ØµØ±ÙÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:`, "1");
    if (!qtyStr) return;
    
    const qty = parseInt(qtyStr);
    if (isNaN(qty) || qty <= 0) return showToast('ØªØ¹Ø¯Ø§Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª', 'error');
    if (qty > item.stock) return showToast('Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª', 'error');

    item.stock -= qty;
    const totalCost = item.buyPrice * qty;

    db.transactions.push({
        id: generateId(), date: Date.now(), type: 'expense',
        category: 'Ù…ØµØ±Ù Ù…ÙˆØ§Ø¯ (Backbar)',
        desc: `Ù…ØµØ±Ù Ø¯Ø§Ø®Ù„ÛŒ ${qty} Ø¹Ø¯Ø¯ ${item.name}`,
        amount: totalCost, user: db.settings.auth.user
    });

    saveData();
    renderInventory();
    renderDashboard();
    showToast('Ø«Ø¨Øª Ø´Ø¯', 'success');
}
// =========================================
//  FIX: EXPORT TO EXCEL FUNCTION
// =========================================
function exportToExcel(tableId) {
    var originalTable = document.getElementById(tableId);
    if (!originalTable) {
        showToast('Ø¬Ø¯ÙˆÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø±ÙØªÙ† ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
        return;
    }

    // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù„ÙˆØ¯ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
    if (typeof XLSX === 'undefined') {
        showToast('Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø§Ú©Ø³Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø§ÛŒÙ†ØªØ±Ù†Øª Ø±Ø§ Ú†Ú© Ú©Ù†ÛŒØ¯.', 'error');
        return;
    }

    // 1. ÛŒÚ© Ú©Ù¾ÛŒ Ø§Ø² Ø¬Ø¯ÙˆÙ„ Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒÙ… ØªØ§ Ø¬Ø¯ÙˆÙ„ Ø§ØµÙ„ÛŒ ØªØºÛŒÛŒØ± Ù†Ú©Ù†Ø¯
    var tableClone = originalTable.cloneNode(true);

    // 2. Ø­Ø°Ù Ø³ØªÙˆÙ† Ø¢Ø®Ø± (Ø¹Ù…Ù„ÛŒØ§Øª/Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§) Ø§Ø² Ú©Ù¾ÛŒ Ø¬Ø¯ÙˆÙ„ ØªØ§ Ø¯Ø± Ø§Ú©Ø³Ù„ Ù†ÛŒØ§ÛŒØ¯
    var rows = tableClone.querySelectorAll('tr');
    rows.forEach(function(row) {
        if (row.cells.length > 0) {
            row.deleteCell(-1); // Ø­Ø°Ù Ø¢Ø®Ø±ÛŒÙ† Ø³Ù„ÙˆÙ„ Ù‡Ø± Ø±Ø¯ÛŒÙ
        }
    });

    // 3. ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø§Ú©Ø³Ù„
    var wb = XLSX.utils.table_to_book(tableClone, {sheet: "Sheet1", rtl: true});
    
    // 4. Ù†Ø§Ù… ÙØ§ÛŒÙ„ Ø¨Ø§ ØªØ§Ø±ÛŒØ® Ùˆ Ø³Ø§Ø¹Øª
    var now = new Date();
    var dateStr = now.getFullYear() + "-" + (now.getMonth()+1) + "-" + now.getDate();
    var fileName = 'RoyalSalon_Report_' + dateStr + '.xlsx';
    
    // 5. Ø¯Ø§Ù†Ù„ÙˆØ¯
    XLSX.writeFile(wb, fileName);
    showToast('ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„ Ø¢Ù…Ø§Ø¯Ù‡ Ùˆ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯', 'success');
}
</script>
</body>
</html>
